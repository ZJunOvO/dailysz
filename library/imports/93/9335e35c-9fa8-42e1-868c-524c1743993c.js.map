{"version":3,"sources":["assets\\scripts\\skinMgr.js"],"names":["Object","defineProperty","exports","value","SkinUnlockType","SkinIdEnum","SkinState","r","_evts","require","_idx","_res","_uData","_global","_pInfo","t","none","unlock","lock","using","bg","role","nameFrame","headFrame","video","coin","d","defaultConfig","skinId","itemData","ref","name","unlockType","unlockValue","desc","skinConfig","get","_ins","enumerable","configurable","prototype","init","cc","resources","load","JsonAsset","e","o","json","isUsingSkin","ins","getUsingSkin","isHasSkin","getMySkin","includes","getSkinConfig","getSkinData","n","length","addSkin","addMySkin","platform","reportEvent","ERepEvt","buySkin","opE","emit","action","SKIN_CHG","data","isUse","_setLocalAndCloudData","usingSkin","setUsingSkin","useSkin","updateHeadFrame","i","a","s","Math","min","OssConfig","skinUrl","assetManager","loadRemote","Texture2D","isValid","SpriteFrame","spriteFrame","lSF","updateBg","updateNameFrame","updateRole","l","u","curRoleNode","curRoleRef","Promise","all","_remoteAtlas","_remoteImg","_remoteJson","then","__awaiter","__generator","label","sp","SkeletonData","skeletonJson","atlasText","text","textures","textureNames","lPre","sent","instantiate","getComponent","Skeleton","skeletonData","position","Vec3","ZERO","animation","addChild","console","error","removeAllChildren","p"],"mappings":"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","sourceRoot":"/","sourcesContent":["Object.defineProperty(exports, \"__esModule\", { value: !0 });\nexports.SkinUnlockType = exports.SkinIdEnum = exports.SkinState = void 0;\nvar r;\nvar _evts = require(\"evts\");\nvar _idx = require(\"idx\");\nvar _res = require(\"res\");\nvar _uData = require(\"uData\");\nvar _global = require(\"global\");\nvar _pInfo = require(\"pInfo\");\n(function(t) {\n    (t[(t.none = 0)] = \"none\"),\n    (t[(t.unlock = 1)] = \"unlock\"),\n    (t[(t.lock = 2)] = \"lock\"),\n    (t[(t.using = 3)] = \"using\");\n})(exports.SkinState || (exports.SkinState = {}));\n(function(t) {\n    (t.bg = \"bg\"), (t.role = \"role\"), (t.nameFrame = \"nameFrame\"), (t.headFrame = \"headFrame\");\n})((r = exports.SkinIdEnum || (exports.SkinIdEnum = {})));\n(function(t) {\n    t[(t.none = 0)] = \"none\";\n    t[(t.video = 1)] = \"video\";\n    t[(t.coin = 2)] = \"coin\";\n})(exports.SkinUnlockType || (exports.SkinUnlockType = {}));\nvar d = (function() {\n    function t() {\n        this.defaultConfig = {\n            bg: {\n                skinId: \"bg\",\n                itemData: [\n                    { ref: 1, name: \"默认背景\", unlockType: 0, unlockValue: 0, desc: \"\" },\n                    { ref: 2, name: \"夜色降临\", unlockType: 1, unlockValue: 20, desc: \"\" }\n                ]\n            },\n            role: {\n                skinId: \"role\",\n                itemData: [\n                    { ref: 1, name: \"默认角色\", unlockType: 0, unlockValue: 0, desc: \"\" },\n                    { ref: 2, name: \"流连忘返\", unlockType: 1, unlockValue: 20, desc: \"\" }\n                ]\n            },\n            nameFrame: {\n                skinId: \"nameFrame\",\n                itemData: [\n                    { ref: 1, name: \"默认名字框\", unlockType: 0, unlockValue: 0, desc: \"\" },\n                    { ref: 2, name: \"心旷神怡\", unlockType: 2, unlockValue: 1e4, desc: \"\" },\n                    { ref: 3, name: \"海誓山盟\", unlockType: 2, unlockValue: 1e4, desc: \"\" },\n                    { ref: 4, name: \"旖旎风光\", unlockType: 2, unlockValue: 2e4, desc: \"\" },\n                    { ref: 5, name: \"柳暗花遮\", unlockType: 2, unlockValue: 2e4, desc: \"\" },\n                    { ref: 6, name: \"姹紫嫣红\", unlockType: 2, unlockValue: 2e4, desc: \"\" }\n                ]\n            },\n            headFrame: {\n                skinId: \"headFrame\",\n                itemData: [\n                    { ref: 1, name: \"默认头像框\", unlockType: 0, unlockValue: 0, desc: \"\" },\n                    { ref: 2, name: \"秀色可餐\", unlockType: 2, unlockValue: 2e4, desc: \"\" },\n                    { ref: 3, name: \"火树银花\", unlockType: 2, unlockValue: 2e4, desc: \"\" },\n                    { ref: 4, name: \"湖光山色\", unlockType: 2, unlockValue: 2e3, desc: \"\" },\n                    { ref: 5, name: \"鸟语花香\", unlockType: 1, unlockValue: 10, desc: \"\" },\n                    { ref: 6, name: \"江山如画\", unlockType: 1, unlockValue: 10, desc: \"\" }\n                ]\n            }\n        };\n        this.skinConfig = this.defaultConfig;\n    }\n    Object.defineProperty(t, \"ins\", {\n        get: function() {\n            return this._ins || (this._ins = new t());\n        },\n        enumerable: !1,\n        configurable: !0\n    });\n    t.prototype.init = function() {\n        var t = this;\n        cc.resources.load(\"config\", cc.JsonAsset, function(e, o) {\n            !e && o && o.json ? (t.skinConfig = o.json) : (t.skinConfig = t.defaultConfig);\n        });\n    };\n    t.prototype.isUsingSkin = function(t, e) {\n        return _pInfo.default.ins.getUsingSkin()[t] === e;\n    };\n    t.prototype.isHasSkin = function(t, e) {\n        var o = _pInfo.default.ins.getMySkin();\n        return o[t] && o[t].includes(e);\n    };\n    t.prototype.getSkinConfig = function(t) {\n        return this.skinConfig[t];\n    };\n    t.prototype.getSkinData = function(t, e) {\n        for (var o = this.getSkinConfig(t).itemData, n = 0; n < o.length; n++)\n            if (o[n].ref === e) return o[n];\n        return null;\n    };\n    t.prototype.addSkin = function(t, e) {\n        _pInfo.default.ins.addMySkin(t, e);\n        _idx.platform.reportEvent(_idx.ERepEvt.buySkin, { skinId: t, ref: e });\n        _evts.default.opE.emit({ action: _evts.default.SKIN_CHG, data: { skinId: t, ref: e, isUse: !1 } });\n        _uData.default.ins._setLocalAndCloudData();\n    };\n    t.prototype.usingSkin = function(t, e) {\n        var o;\n        _pInfo.default.ins.setUsingSkin((((o = {})[t] = e), o));\n        _idx.platform.reportEvent(_idx.ERepEvt.useSkin, { skinId: t, ref: e });\n        _evts.default.opE.emit({ action: _evts.default.SKIN_CHG, data: { skinId: t, ref: e, isUse: !0 } });\n    };\n    t.prototype.updateHeadFrame = function(t, e, o) {\n        var n;\n        var i;\n        if ((void 0 === o && (o = !1), e)) {\n            t || (t = 1);\n            var a;\n            var s =\n                (null === (i = null === (n = this.getSkinConfig(r.headFrame)) || void 0 === n ? void 0 : n.itemData) ||\n                    void 0 === i ?\n                    void 0 :\n                    i.length) || 1;\n            (t = Math.min(t, s)) > 6\n                ?\n                ((a = _global.OssConfig.skinUrl + \"headFrame/head\" + t + \".png\"),\n                    cc.assetManager.loadRemote(a, cc.Texture2D, function(t, n) {\n                        if (!t && n && e.isValid) {\n                            var i = new cc.SpriteFrame(n);\n                            e.spriteFrame = i;\n                        } else o ? ((a = \"game/skin/headFrame/head1\"), _res.default.ins.lSF(a, e)) : (e.spriteFrame = null);\n                    })) :\n                ((a = \"game/skin/headFrame/head\" + t), _res.default.ins.lSF(a, e));\n        }\n    };\n    t.prototype.updateBg = function(t, e, o) {\n        var n;\n        var i;\n        if ((void 0 === o && (o = !1), e)) {\n            t || (t = 1);\n            var a;\n            var s =\n                (null === (i = null === (n = this.getSkinConfig(r.bg)) || void 0 === n ? void 0 : n.itemData) ||\n                    void 0 === i ?\n                    void 0 :\n                    i.length) || 1;\n            (t = Math.min(t, s)) > 2\n                ?\n                ((a = _global.OssConfig.skinUrl + \"bg/top\" + t + \".jpg\"),\n                    cc.assetManager.loadRemote(a, cc.Texture2D, function(t, n) {\n                        if (!t && n && e.isValid) {\n                            var i = new cc.SpriteFrame(n);\n                            e.spriteFrame = i;\n                        } else o ? ((a = \"game/normal/top1\"), _res.default.ins.lSF(a, e)) : (e.spriteFrame = null);\n                    })) :\n                ((a = \"game/normal/top\" + t), _res.default.ins.lSF(a, e));\n        }\n    };\n    t.prototype.updateNameFrame = function(t, e, o) {\n        var n;\n        var i;\n        if ((void 0 === o && (o = !1), e)) {\n            t || (t = 1);\n            var a;\n            var s =\n                (null === (i = null === (n = this.getSkinConfig(r.nameFrame)) || void 0 === n ? void 0 : n.itemData) ||\n                    void 0 === i ?\n                    void 0 :\n                    i.length) || 1;\n            (t = Math.min(t, s)) > 6\n                ?\n                ((a = _global.OssConfig.skinUrl + \"nameFrame/name\" + t + \".png\"),\n                    cc.assetManager.loadRemote(a, cc.Texture2D, function(t, n) {\n                        if (!t && n && e.isValid) {\n                            var i = new cc.SpriteFrame(n);\n                            e.spriteFrame = i;\n                        } else o ? ((a = \"game/skin/nameFrame/name1\"), _res.default.ins.lSF(a, e)) : (e.spriteFrame = null);\n                    })) :\n                ((a = \"game/skin/nameFrame/name\" + t), _res.default.ins.lSF(a, e));\n        }\n    };\n    t.prototype.updateRole = function(t, e, o) {\n        var a;\n        var s;\n        var l = this;\n        if ((void 0 === o && (o = !1), e)) {\n            t || (t = 1);\n            var u =\n                (null === (s = null === (a = this.getSkinConfig(r.role)) || void 0 === a ? void 0 : a.itemData) ||\n                    void 0 === s ?\n                    void 0 :\n                    s.length) || 1;\n            if ((t = Math.min(t, u)) > 2)\n                (this.curRoleNode = e),\n                (this.curRoleRef = t),\n                Promise.all([this._remoteAtlas(), this._remoteImg(), this._remoteJson()])\n                .then(function(t) {\n                    var o = t[0];\n                    var r = t[1];\n                    var a = t[2];\n                    return __awaiter(l, void 0, void 0, function() {\n                        var t;\n                        var n;\n                        var s;\n                        var l;\n                        return __generator(this, function(i) {\n                            switch (i.label) {\n                                case 0:\n                                    return (\n                                        ((t = new sp.SkeletonData()).skeletonJson = a.json),\n                                        (t.atlasText = o.text),\n                                        (t.textures = [r]),\n                                        (t.textureNames = [\"1.png\"]), [4, _res.default.ins.lPre(\"skin/girl1\")]\n                                    );\n                                case 1:\n                                    return (\n                                        (n = i.sent()),\n                                        (s = cc.instantiate(n)),\n                                        (l = s.getComponent(sp.Skeleton)) ?\n                                        ((l.skeletonData = t),\n                                            (s.position = cc.Vec3.ZERO),\n                                            (l.animation = \"idle\"),\n                                            e.addChild(s), [2]) : [2]\n                                    );\n                            }\n                        });\n                    });\n                })\n                .catch(function(t) {\n                    if ((console.error(t), e.removeAllChildren(), o)) {\n                        if (!e) return;\n                        _res.default.ins.lPre(\"skin/girl1\").then(function(t) {\n                            var o = cc.instantiate(t);\n                            o.position = cc.Vec3.ZERO;\n                            e.addChild(o);\n                        });\n                    }\n                });\n            else {\n                var p = \"skin/girl\" + t;\n                e.removeAllChildren();\n                _res.default.ins.lPre(p).then(function(t) {\n                    var o = cc.instantiate(t);\n                    o.position = cc.Vec3.ZERO;\n                    e.addChild(o);\n                });\n            }\n        }\n    };\n    t.prototype._remoteAtlas = function() {\n        var t = this;\n        var e = _global.OssConfig.skinUrl + \"role/\" + this.curRoleRef + \"/1.atlas\";\n        return new Promise(function(o, n) {\n            cc.assetManager.loadRemote(e, function(e, i) {\n                e && n(e);\n                t.curRoleNode.isValid || n(\"this.curRoleNode.isValid === false\");\n                i || n(\"atlasText is null\");\n                o(i);\n            });\n        });\n    };\n    t.prototype._remoteImg = function() {\n        var t = this;\n        var e = _global.OssConfig.skinUrl + \"role/\" + this.curRoleRef + \"/1.png\";\n        return new Promise(function(o, n) {\n            cc.assetManager.loadRemote(e, function(e, i) {\n                e && n(e);\n                t.curRoleNode.isValid || n(\"this.curRoleNode.isValid === false\");\n                i || n(\"texture is null\");\n                o(i);\n            });\n        });\n    };\n    t.prototype._remoteJson = function() {\n        var t = this;\n        var e = _global.OssConfig.skinUrl + \"role/\" + this.curRoleRef + \"/1.json\";\n        return new Promise(function(o, r) {\n            cc.assetManager.loadRemote(e, function(e, a) {\n                return __awaiter(t, void 0, void 0, function() {\n                    return __generator(this, function() {\n                        e && r(e);\n                        this.curRoleNode.isValid || r(\"this.curRoleNode.isValid === false\");\n                        a || r(\"skeletonJson is null\");\n                        o(a);\n                        return [2];\n                    });\n                });\n            });\n        });\n    };\n    return t;\n})();\nexports.default = d;"]}