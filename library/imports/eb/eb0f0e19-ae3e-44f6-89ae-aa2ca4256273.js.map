{"version":3,"sources":["assets\\scripts\\veBtn.js"],"names":["n","Object","defineProperty","exports","value","_adC","require","_com","_evts","_idx","_pConst","_request","_res","_sound","_lang","_tipMgr","_pInfo","m","cc","_decorator","v","ccclass","_","property","b","t","e","apply","arguments","videoSource","videoDuration","VEnum2","MEDIUM","onWatchEndEvent","adSp","cb","eCb","__extends","prototype","onLoad","platform","preloadVideo","VEnum","node","getChildByName","getComponent","Sprite","setShareIcon","onEnable","on","onClick","onOperTap","bind","opE","onDisable","off","action","AD_MAX","interactable","o","ins","a","isMaxShareCount","i","isMaxAdCount","showTip","lang","share","then","Component","EventHandler","emitEvents","addShareCount","console","error","r","adDotData","customEventData","doWatchAD","sequenceInfo","playBGM","addAdCount","adDot","VideoFailCode","NO_AD","CANCELED","setBeforeWatchCheckHandler","$isShare","lSF","__decorate","String"],"mappings":"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","sourceRoot":"/","sourcesContent":["var n;\nObject.defineProperty(exports, \"__esModule\", {value: !0});\nvar _adC = require(\"adC\");\nvar _com = require(\"com\");\nvar _evts = require(\"evts\");\nvar _idx = require(\"idx\");\nvar _pConst = require(\"pConst\");\nvar _request = require(\"request\");\nvar _res = require(\"res\");\nvar _sound = require(\"sound\");\nvar _lang = require(\"lang\");\nvar _tipMgr = require(\"tipMgr\");\nvar _pInfo = require(\"pInfo\");\nvar m = cc._decorator;\nvar v = m.ccclass;\nvar _ = m.property;\nvar b = (function (t) {\n    function e() {\n        var e = (null !== t && t.apply(this, arguments)) || this;\n        e.videoSource = \"\";\n        e.videoDuration = _adC.VEnum2.MEDIUM;\n        e.onWatchEndEvent = null;\n        e.adSp = null;\n        e.cb = null;\n        e.eCb = null;\n        return e;\n    }\n    __extends(e, t);\n    e.prototype.onLoad = function () {\n        _idx.platform.preloadVideo(_adC.VEnum[this.videoDuration]);\n        this.adSp || (this.adSp = this.node.getChildByName(\"bg\").getChildByName(\"img_gk_ds\").getComponent(cc.Sprite));\n        this.setShareIcon();\n    };\n    e.prototype.onEnable = function () {\n        this.node.on(\"click\", this.onClick, this);\n        this.eCb = this.onOperTap.bind(this);\n        _evts.default.opE.on(this.eCb);\n    };\n    e.prototype.onDisable = function () {\n        this.node.off(\"click\", this.onClick, this);\n        _evts.default.opE.off(this.eCb);\n        this.eCb = null;\n    };\n    e.prototype.onOperTap = function (t) {\n        switch (t.action) {\n            case _evts.default.AD_MAX:\n                this.setShareIcon();\n        }\n    };\n    e.prototype.onClick = function (t) {\n        var e = this;\n        if ((!t || t.interactable) && null != this.onWatchEndEvent && (null == this.cb || this.cb())) {\n            var o = _com.default.ins.a(this.node, 1);\n            var n = _pInfo.default.ins.isMaxShareCount();\n            var i = _pInfo.default.ins.isMaxAdCount();\n            if (n && i) return void _tipMgr.default.ins.showTip(_lang.lang[10009]);\n            if (i)\n                return void _idx.platform\n                    .share()\n                    .then(function (n) {\n                        n &&\n                            (o(),\n                            e.onWatchEndEvent && cc.Component.EventHandler.emitEvents([e.onWatchEndEvent], t),\n                            _pInfo.default.ins.addShareCount());\n                    })\n                    .catch(function (t) {\n                        console.error(t);\n                    });\n            var r = this.node.adDotData || e.onWatchEndEvent.customEventData;\n            _idx.platform\n                .doWatchAD({videoSource: this.videoSource, videoDuration: this.videoDuration, sequenceInfo: null})\n                .then(function () {\n                    _sound.default.ins.playBGM();\n                    o();\n                    e.onWatchEndEvent && cc.Component.EventHandler.emitEvents([e.onWatchEndEvent], t);\n                    _pInfo.default.ins.addAdCount();\n                    _request.default.ins.adDot(r, 1);\n                })\n                .catch(function (t) {\n                    switch ((_sound.default.ins.playBGM(), o(), t)) {\n                        case _pConst.VideoFailCode.NO_AD:\n                            _tipMgr.default.ins.showTip(_lang.lang[1e4]), _request.default.ins.adDot(r, 0);\n                            break;\n                        case _pConst.VideoFailCode.CANCELED:\n                            _request.default.ins.adDot(r, 2);\n                    }\n                });\n        }\n    };\n    e.prototype.setBeforeWatchCheckHandler = function (t) {\n        this.cb = t;\n    };\n    e.prototype.setShareIcon = function () {\n        this.adSp &&\n            _pInfo.default.ins.isMaxAdCount() &&\n            (this.adSp.node.$isShare ||\n                (_res.default.ins.lSF(\"common/lupin_2\", this.adSp), (this.adSp.node.$isShare = !0)));\n    };\n    __decorate([_(cc.String)], e.prototype, \"videoSource\", void 0);\n    __decorate([_(cc.Component.EventHandler)], e.prototype, \"onWatchEndEvent\", void 0);\n    __decorate([_(cc.Sprite)], e.prototype, \"adSp\", void 0);\n    return __decorate([v], e);\n})(cc.Component);\nexports.default = b;\n"]}