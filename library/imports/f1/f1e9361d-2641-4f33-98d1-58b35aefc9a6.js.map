{"version":3,"sources":["assets\\scripts\\rewardMgr.js"],"names":["Object","defineProperty","exports","value","_evts","require","_time","_uData","_pInfo","_tipMgr","_panelMgr","RewardMgr","isInit","prototype","instance","getInstance","init","localData","needUpdate","ins","getLocalDataByKey","cashBalance","winStreak","totalCashEarned","lastRewardTime","setLocalData","console","log","getCash","getCashDisplay","cashInCents","cashInYuan","toFixed","addCash","amountInCents","currentCash","newCash","totalEarned","opE","emit","action","onPuzzleComplete","difficulty","isSuccess","isManualTest","resetWinStreak","currentTime","Date","now","Math","random","rewardAmount","calculateReward","incrementWinStreak","updateLastRewardTime","showRewardTip","saveLastRewardInfo","showCashRewardUI","rewardRanges","min","max","difficultyMap","mappedDifficulty","range","baseReward","floor","streakMultiplier","getStreakMultiplier","specialDayMultiplier","getSpecialDayMultiplier","finalReward","maxReward","today","month","getMonth","day","getDate","currentStreak","amountInYuan","messages","randomMessage","length","window","alert","showTip","error","showLoveSupportMessage","supportMessages","rewardInfo","amount","timestamp","isNew","dataToSave","getLastRewardInfo","hasPendingCashReward","clearCashRewardFlag","open","gold","MaskNoHide","rewardMgr","testCashReward","hasReward","getCashBalance","testAllFeatures","setTimeout"],"mappings":"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","sourceRoot":"/","sourcesContent":["Object.defineProperty(exports, \"__esModule\", { value: !0 });\n\nvar _evts = require(\"evts\");\nvar _time = require(\"time\");\nvar _uData = require(\"uData\");\nvar _pInfo = require(\"pInfo\");\nvar _tipMgr = require(\"tipMgr\");\nvar _panelMgr = require(\"panelMgr\");\n\nvar RewardMgr = (function() {\n    function RewardMgr() {\n        this.isInit = false;\n    }\n\n    var prototype = RewardMgr.prototype;\n    var instance = null;\n\n    // 获取单例\n    RewardMgr.getInstance = function() {\n        if (!instance) {\n            instance = new RewardMgr();\n        }\n        return instance;\n    };\n\n    // 初始化现金数据\n    prototype.init = function() {\n        if (this.isInit) return;\n        \n        // 确保现金相关数据存在\n        var localData = {};\n        var needUpdate = false;\n        \n        if (_uData.default.ins.getLocalDataByKey('cashBalance') === null) {\n            localData.cashBalance = 0;\n            needUpdate = true;\n        }\n        if (_uData.default.ins.getLocalDataByKey('winStreak') === null) {\n            localData.winStreak = 0;\n            needUpdate = true;\n        }\n        if (_uData.default.ins.getLocalDataByKey('totalCashEarned') === null) {\n            localData.totalCashEarned = 0;\n            needUpdate = true;\n        }\n        if (_uData.default.ins.getLocalDataByKey('lastRewardTime') === null) {\n            localData.lastRewardTime = 0;\n            needUpdate = true;\n        }\n        \n        if (needUpdate) {\n            _uData.default.ins.setLocalData(localData);\n        }\n\n        this.isInit = true;\n        console.log(\"💝 卷宝专属现金奖励系统初始化完成\");\n    };\n\n    // 获取现金余额(以分为单位存储，显示时转换为元)\n    prototype.getCash = function() {\n        this.init();\n        return _uData.default.ins.getLocalDataByKey('cashBalance') || 0;\n    };\n\n    // 获取现金余额显示文本\n    prototype.getCashDisplay = function() {\n        var cashInCents = this.getCash();\n        var cashInYuan = (cashInCents / 100).toFixed(2);\n        return cashInYuan;\n    };\n\n    // 添加现金(金额以分为单位)\n    prototype.addCash = function(amountInCents) {\n        this.init();\n        var currentCash = this.getCash();\n        var newCash = currentCash + amountInCents;\n        \n        // 更新总获得现金\n        var totalEarned = _uData.default.ins.getLocalDataByKey('totalCashEarned') || 0;\n        \n        _uData.default.ins.setLocalData({\n            cashBalance: newCash,\n            totalCashEarned: totalEarned + amountInCents\n        });\n        \n        // 触发现金更新事件\n        _evts.default.opE.emit({ action: 'CASH_CHG' });\n        \n        console.log(\"💰 卷宝获得现金奖励: ¥\" + (amountInCents / 100).toFixed(2));\n        return newCash;\n    };\n\n    // 游戏完成时的奖励判断\n    prototype.onPuzzleComplete = function(difficulty, isSuccess, isManualTest) {\n        if (!isSuccess) {\n            // 失败时重置连胜\n            this.resetWinStreak();\n            return false;\n        }\n\n        // 防止短时间内重复奖励（5秒内）\n        var lastRewardTime = _uData.default.ins.getLocalDataByKey('lastRewardTime') || 0;\n        var currentTime = Date.now();\n        if (currentTime - lastRewardTime < 5000) {\n            console.log(\"⏰ 距离上次奖励不足5秒，跳过本次奖励\");\n            return false;\n        }\n\n        // 90%概率触发现金奖励（测试阶段）\n        if (Math.random() > 0.1) {\n            console.log(\"🎯 现金奖励概率触发成功\");\n        } else {\n            console.log(\"🎯 现金奖励概率未触发\");\n            return false;\n        }\n\n        // 计算奖励金额\n        var rewardAmount = this.calculateReward(difficulty);\n        \n        if (rewardAmount > 0) {\n            this.incrementWinStreak();\n            this.updateLastRewardTime();\n            \n            // 💝 统一逻辑：立即添加现金并更新UI（和手动测试一样）\n            this.addCash(rewardAmount);\n            this.showRewardTip(rewardAmount);\n            console.log(\"💰 现金奖励已立即添加并更新UI: ¥\" + (rewardAmount / 100).toFixed(2));\n            \n            if (!isManualTest) {\n                // 正常游戏：还要弹窗让用户确认领取（可选的额外奖励界面）\n                this.saveLastRewardInfo(rewardAmount);\n                this.showCashRewardUI();\n                console.log(\"💰 现金奖励确认界面已显示\");\n            }\n            \n            return true;\n        }\n        \n        return false;\n    };\n\n    // 💝 重新设计的奖励金额计算(返回分为单位，控制总成本200-1000元)\n    prototype.calculateReward = function(difficulty) {\n        // 根据真实难度设定基础奖励范围（分为单位）\n        var rewardRanges = {\n            'basic': {min: 2, max: 8},      // ¥0.02-0.08 平均¥0.05\n            'simple': {min: 5, max: 15},    // ¥0.05-0.15 平均¥0.10  \n            'normal': {min: 8, max: 25},    // ¥0.08-0.25 平均¥0.15\n            'hard': {min: 12, max: 35},     // ¥0.12-0.35 平均¥0.20\n            'expert': {min: 20, max: 50},   // ¥0.20-0.50 平均¥0.30\n            'master': {min: 30, max: 80}    // ¥0.30-0.80 平均¥0.50\n        };\n        \n        // 兼容旧难度名称\n        var difficultyMap = {\n            'beginner': 'basic',\n            'easy': 'simple', \n            'medium': 'normal'\n        };\n        \n        var mappedDifficulty = difficultyMap[difficulty] || difficulty;\n        var range = rewardRanges[mappedDifficulty] || rewardRanges['basic'];\n        \n        // 计算基础奖励\n        var baseReward = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;\n        \n        // 连胜加成（降低倍数，避免过高）\n        var streakMultiplier = this.getStreakMultiplier();\n        \n        // 特殊日期检查（降低倍数）\n        var specialDayMultiplier = this.getSpecialDayMultiplier();\n        \n        // 应用乘数（控制最终金额）\n        var finalReward = Math.floor(baseReward * streakMultiplier * specialDayMultiplier);\n        \n        // 设置上限，避免异常高额奖励\n        var maxReward = 200; // 最高¥2.00\n        return Math.min(finalReward, maxReward);\n    };\n\n\n    // 💝 调整后的连胜乘数（降低倍数控制成本）\n    prototype.getStreakMultiplier = function() {\n        var winStreak = _uData.default.ins.getLocalDataByKey('winStreak') || 0;\n        \n        if (winStreak >= 10) return 1.5;      // 连胜10关: +50%\n        if (winStreak >= 7) return 1.3;       // 连胜7关: +30%\n        if (winStreak >= 5) return 1.2;       // 连胜5关: +20%\n        if (winStreak >= 3) return 1.1;       // 连胜3关: +10%\n        \n        return 1.0;\n    };\n\n    // 💝 调整后的特殊日期乘数（降低倍数控制成本）\n    prototype.getSpecialDayMultiplier = function() {\n        var today = new Date();\n        var month = today.getMonth() + 1;\n        var day = today.getDate();\n        \n        // 生日和纪念日特殊奖励（降低倍数）\n        if ((month === 4 && day === 22) ||   // 生日1: 04-22\n            (month === 12 && day === 28) ||  // 生日2: 12-28  \n            (month === 9 && day === 16)) {   // 纪念日: 09-16\n            return 1.5; // 改为1.5倍而不是2倍\n        }\n        \n        return 1.0;\n    };\n\n    // 增加连胜次数\n    prototype.incrementWinStreak = function() {\n        var currentStreak = _uData.default.ins.getLocalDataByKey('winStreak') || 0;\n        _uData.default.ins.setLocalData({ winStreak: currentStreak + 1 });\n    };\n\n    // 重置连胜次数\n    prototype.resetWinStreak = function() {\n        _uData.default.ins.setLocalData({ winStreak: 0 });\n    };\n\n    // 更新最后奖励时间\n    prototype.updateLastRewardTime = function() {\n        _uData.default.ins.setLocalData({ lastRewardTime: Date.now() });\n    };\n\n    // 显示奖励提示\n    prototype.showRewardTip = function(amountInCents) {\n        var amountInYuan = (amountInCents / 100).toFixed(2);\n        var winStreak = _uData.default.ins.getLocalDataByKey('winStreak') || 0;\n        \n        // 💝 中文情绪价值满满的奖励提示\n        var messages = [\n            \"卷卷获得了￥\" + amountInYuan + \"现金奖励！好棒！\",\n            \"恭喜卷卷！￥\" + amountInYuan + \"奖励到账！\", \n            \"卷卷真厉害！赚到￥\" + amountInYuan + \"！\",\n            \"哇！卷卷又获得￥\" + amountInYuan + \"奖励！\",\n            \"卷卷好聪明！￥\" + amountInYuan + \"现金奖励！\"\n        ];\n        \n        // 特殊日期文案\n        var today = new Date();\n        var month = today.getMonth() + 1;\n        var day = today.getDate();\n        \n        if ((month === 4 && day === 22) || (month === 12 && day === 28)) {\n            messages = [\"🎂 生日快乐卷卷！特别奖励￥\" + amountInYuan + \"！\"];\n        } else if (month === 9 && day === 16) {\n            messages = [\"💕 纪念日快乐！卷卷获得特殊奖励￥\" + amountInYuan + \"！\"];\n        }\n        \n        // 连胜特殊文案\n        if (winStreak >= 10) {\n            messages = [\"🔥 卷卷连胜\" + winStreak + \"关！超级奖励￥\" + amountInYuan + \"！\"];\n        } else if (winStreak >= 5) {\n            messages = [\"⭐ 卷卷连胜\" + winStreak + \"关！连击奖励￥\" + amountInYuan + \"！\"];\n        }\n        \n        var randomMessage = messages[Math.floor(Math.random() * messages.length)];\n        \n        console.log(\"🎉 \" + randomMessage);\n        \n        try {\n            // 💝 改用alert显示中文奖励提示\n            if (typeof window !== 'undefined' && window.alert) {\n                window.alert(randomMessage);\n                console.log(\"💰 现金奖励提示(alert)已显示:\", randomMessage);\n            } else {\n                // 备用方案\n                _tipMgr.default.ins.showTip(\"卷卷获得￥\" + amountInYuan + \"奖励！\", false);\n                console.log(\"💰 现金奖励提示(tip备用)已显示\");\n            }\n        } catch (error) {\n            console.log(\"❌ 显示现金奖励提示失败:\", error);\n            console.log(\"💰 现金奖励:\", randomMessage);\n        }\n    };\n\n\n    // 💝 显示菌子情绪价值支持提示（满满的爱意）\n    prototype.showLoveSupportMessage = function() {\n        var supportMessages = [\n            \"💕 卷卷真的好棒！菌子好爱你！\",\n            \"🌟 卷卷好聪明！是菌子心中最亮的星星！\", \n            \"🔥 卷卷太厉害了！菌子为你骄傲！\",\n            \"💖 卷卷加油！菌子永远支持你！\",\n            \"👑 卷卷做得很好！你就是菌子的女王！\",\n            \"💝 爱你爱你卷卷！最喜欢卷卷了！\",\n            \"🎉 卷卷超级棒！菌子给你比心心！\",\n            \"✨ 卷卷是天才！菌子被你迷住了！\",\n            \"🏆 卷卷太优秀了！菌子要给你颁奖！\",\n            \"🌈 卷卷让菌子的世界变得colorful！\",\n            \"🍀 遇到卷卷是菌子最大的幸运！\",\n            \"🌸 卷卷美美的！菌子的小公主！\"\n        ];\n        \n        var randomMessage = supportMessages[Math.floor(Math.random() * supportMessages.length)];\n        \n        try {\n            // 💝 用alert显示满满爱意的鼓励消息\n            if (typeof window !== 'undefined' && window.alert) {\n                window.alert(randomMessage);\n                console.log(\"💕 菌子情绪价值支持消息(alert)已显示:\", randomMessage);\n            } else {\n                // 备用方案：继续使用原tip系统\n                _tipMgr.default.ins.showTip(\"卷卷真棒！菌子爱你！\", false);\n                console.log(\"💕 菌子支持消息(tip备用)已显示\");\n            }\n        } catch (error) {\n            console.log(\"❌ 显示菌子支持消息失败:\", error);\n            console.log(\"💕 菌子消息:\", randomMessage);\n        }\n    };\n\n    // 💝 保存最近奖励信息供结算界面使用\n    prototype.saveLastRewardInfo = function(amountInCents) {\n        var amountInYuan = (amountInCents / 100).toFixed(2);\n        var rewardInfo = {\n            amount: amountInYuan,\n            timestamp: Date.now(),\n            isNew: true\n        };\n        // 使用正确的setLocalData方法\n        var dataToSave = {};\n        dataToSave['lastRewardInfo'] = rewardInfo;\n        // 💝 设置标记，表示本次游戏完成有现金奖励处理\n        dataToSave['hasPendingCashReward'] = true;\n        _uData.default.ins.setLocalData(dataToSave);\n    };\n\n    // 💝 获取最近奖励信息\n    prototype.getLastRewardInfo = function() {\n        var rewardInfo = _uData.default.ins.getLocalDataByKey('lastRewardInfo');\n        console.log(\"🔍 getLastRewardInfo原始数据:\", rewardInfo);\n        \n        if (rewardInfo && rewardInfo.isNew) {\n            console.log(\"✅ 发现新奖励信息，返回但不立即标记已读\");\n            // 💝 重要修复：不在这里标记为已读，而是在用户真正领取后才清除\n            return rewardInfo;\n        } else if (rewardInfo) {\n            console.log(\"⚠️ 奖励信息存在但isNew=false，已被消费，返回null\");\n        } else {\n            console.log(\"ℹ️ 无奖励信息\");\n        }\n        return null;\n    };\n\n    // 💝 检查是否有待处理的现金奖励\n    prototype.hasPendingCashReward = function() {\n        return _uData.default.ins.getLocalDataByKey('hasPendingCashReward') || false;\n    };\n\n    // 💝 清除现金奖励标记和奖励信息\n    prototype.clearCashRewardFlag = function() {\n        var dataToSave = {};\n        dataToSave['hasPendingCashReward'] = false;\n        dataToSave['lastRewardInfo'] = null; // 💝 同时清除奖励信息，确保不能重复领取\n        _uData.default.ins.setLocalData(dataToSave);\n        console.log(\"🚫 现金奖励标记和奖励信息已清除\");\n    };\n\n    // 💝 主动弹出现金奖励结算界面\n    prototype.showCashRewardUI = function() {\n        try {\n            var _panelMgr = require(\"panelMgr\");\n            console.log(\"🎉 主动打开现金奖励结算界面\");\n            \n            // 打开ui_getReward弹窗，传入假的gold参数（会被现金奖励覆盖）\n            _panelMgr.default.ins.open(\n                \"ui/ui_getReward\",\n                {gold: 100}, // 假参数，会被setupCashReward覆盖\n                {MaskNoHide: true}\n            );\n        } catch (error) {\n            console.log(\"❌ 打开现金奖励界面失败:\", error);\n        }\n    };\n\n    return RewardMgr;\n})();\n\n// 导出单例\nvar rewardMgr = {\n    default: RewardMgr.getInstance()\n};\n\n// 💝 全局测试方法\nif (typeof window !== 'undefined') {\n    window.testCashReward = function() {\n        try {\n            console.log(\"🧪 全局现金奖励测试开始...\");\n            console.log(\"当前现金余额:\", rewardMgr.default.getCashDisplay());\n            \n            var hasReward = rewardMgr.default.onPuzzleComplete('easy', true, true);\n            \n            if (hasReward) {\n                console.log(\"✅ 获得现金奖励！\");\n                console.log(\"新的现金余额:\", rewardMgr.default.getCashDisplay());\n            } else {\n                console.log(\"⭕ 本次没有触发现金奖励（随机概率60%）\");\n                console.log(\"可以再次调用 testCashReward() 测试\");\n            }\n        } catch (error) {\n            console.log(\"❌ 测试失败:\", error);\n        }\n    };\n    \n    window.getCashBalance = function() {\n        console.log(\"💰 当前现金余额: ¥\" + rewardMgr.default.getCashDisplay());\n        return rewardMgr.default.getCashDisplay();\n    };\n    \n    // 💝 全功能测试方法\n    window.testAllFeatures = function() {\n        console.log(\"🎮 开始全功能测试...\");\n        \n        // 1. 测试现金奖励\n        console.log(\"1️⃣ 测试现金奖励系统\");\n        rewardMgr.default.onPuzzleComplete('expert', true);\n        \n        // 2. 测试菌子支持消息\n        console.log(\"2️⃣ 测试菌子支持消息\");\n        setTimeout(function() {\n            rewardMgr.default.showLoveSupportMessage();\n        }, 1000);\n        \n        // 3. 显示当前状态\n        setTimeout(function() {\n            console.log(\"3️⃣ 当前现金余额: ¥\" + rewardMgr.default.getCashDisplay());\n            console.log(\"✅ 全功能测试完成！\");\n        }, 2000);\n    };\n}\n\nexports.default = rewardMgr.default;"]}