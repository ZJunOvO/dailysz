
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/baseUI.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '7d5a9qK3IdB0LQLFV0VPhWU', 'baseUI');
// scripts/baseUI.js

"use strict";

var n;
Object.defineProperty(exports, "__esModule", {
  value: !0
});
exports.HIERARCHY = void 0;
var a;

var _com = require("com");

var _idx = require("idx");

var l = cc._decorator;
var u = l.ccclass;
var p = l.property;

(function (t) {
  t[t.None = 0] = "None";
  t[t.Left = 1] = "Left";
  t[t.Right = 2] = "Right";
  t[t.Down = 3] = "Down";
})(a = exports.HIERARCHY || (exports.HIERARCHY = {}));

var d = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.ctx = null;
    e.closeBtn = null;
    e.sAni = !0;
    e.hAni = !0;
    e.panelHierachy = a.Down;
    e.a = 0.5;
    e.cb = null;
    e.b = null;
    e.c = null;
    return e;
  }

  __extends(e, t);

  e.prototype.onLoad = function () {
    this.closeBtn && this.closeBtn.node.on("click", this.hideThis, this);
  };

  e.prototype.hideThis = function () {};

  e.prototype.show = function (t, e) {
    void 0 === e && (e = this.a);
    this.c = t;
    this.init(this.c);
    this.uD(this.c);
    this.aUI();
    this.checkShow(e);
  };

  e.prototype.hide = function (t) {
    if (!this.isHideing) {
      this.isHideing = !0;
      var e = this;

      _com["default"].ins.a(t, 1);

      _com["default"].ins.b(this.node, !0);

      var o = this.node;
      var n = this.getK(e, o);
      return n ? new Promise(function (t) {
        n.call(function () {
          t(1);
        }).start();
      }) : new Promise(function (t) {
        o.active = !1;
        e.onHide && e.onHide();

        _com["default"].ins.b(e.node, !1);

        e.cb && e.cb(o, e.b);
        t(1);
      });
    }
  };

  e.prototype.getK = function (t, e) {
    switch (this.panelHierachy) {
      case a.Down:
        return cc.tween(this.ctx).to(0.1, {
          y: 60
        }).to(0.2, {
          y: -(cc.winSize.height + e.height) / 2
        }).call(function () {
          e.active = !1;
          t.onHide && t.onHide();

          _com["default"].ins.b(t.node, !1);

          t.cb && t.cb(e, t.b);
        });

      case a.Left:
        return this.moveHideAni(t, e, -cc.view.getVisibleSize().width);

      case a.Right:
        return this.moveHideAni(t, e, cc.view.getVisibleSize().width);

      default:
        return null;
    }
  };

  e.prototype.moveHideAni = function (t, e, o) {
    return cc.tween(this.ctx).to(0.25, {
      x: o
    }, {
      easing: this.customEaseInOut
    }).call(function () {
      e.active = !1;
      t.onHide && t.onHide();

      _com["default"].ins.b(t.node, !1);

      t.cb && t.cb(e, t.b);
    });
  };

  e.prototype.init = function () {
    for (var t = [], e = 0; e < arguments.length; e++) {
      t[e] = arguments[e];
    }
  };

  e.prototype.aUI = function () {
    if (_idx.platform.canShowBanner()) {
      var t = _idx.platform.getBannerSize().height / _idx.platform.getSystemData().windowHeight * cc.view.getVisibleSize().height;

      if (null != this.ctx) {
        var e = (cc.view.getVisibleSize().height - cc.view.getDesignResolutionSize().height) / 2;
        e < t && (this.ctx.y += t - e);
      }
    }

    var o = this.ctx.getComponent(cc.Widget);
    o && (o.enabled = !0, o.updateAlignment(), o.enabled = !1);
    var n = this.ctx.getComponentsInChildren(cc.Widget);
    if (n) for (var i = 0; i < n.length; i++) {
      var r = n[i];
      r.enabled = !0;
      r.updateAlignment();
      r.enabled = !1;
    }
  };

  e.prototype.uD = function () {
    for (var t = [], e = 0; e < arguments.length; e++) {
      t[e] = arguments[e];
    }
  };

  e.prototype.onShow = function () {};

  e.prototype.onHide = function () {};

  e.prototype.setCb = function (t) {
    this.cb = t;
  };

  e.prototype.showAni = function (t) {
    var e = this;

    if (null != this.ctx && this.sAni) {
      var o = this.ctx;
      o.active = !0;
      o.scale = 0.5;
      o.opacity = 0;
      cc.tween(o).to(t, {
        scale: 1,
        opacity: 255
      }, {
        easing: "backOut"
      }).call(function () {
        e.onShow && e.onShow();
      }).start();
    } else this.onShow && this.onShow();
  };

  e.prototype.downAni = function () {
    var t = this;

    if (null != this.ctx && this.sAni) {
      var e = this.ctx;
      e.active = !0;
      e.y = -(cc.winSize.height + e.height) / 2;
      cc.tween(e).to(0.2, {
        y: 60
      }).to(0.1, {
        y: -20
      }).to(0.04, {
        y: 0
      }).call(function () {
        t.onShow && t.onShow();
      }).start();
    } else this.onShow && this.onShow();
  };

  e.prototype.moveAni = function (t, e) {
    if (this.ctx) {
      this.ctx.x = e;
      var o = this;
      o.onShow && o.onShow();
      cc.tween(this.ctx).to(t, {
        x: 0
      }, {
        easing: this.customEaseInOut
      }).call(function () {
        o.onShow && o.onShow();
      }).start();
    }
  };

  e.prototype.customEaseInOut = function (t) {
    return t < 0.5 ? 8 * t * t * t * t : 1 - Math.pow(-2 * t + 2, 4) / 2;
  };

  e.prototype.checkShow = function (t) {
    switch (this.panelHierachy) {
      case a.Right:
        this.moveAni(t, cc.view.getVisibleSize().width);
        break;

      case a.Down:
        this.downAni();
        break;

      case a.Left:
        this.moveAni(t, -cc.view.getVisibleSize().width);
        break;

      default:
        this.onShow && this.onShow();
    }

    this.node.active = !0;
  };

  __decorate([p(cc.Node)], e.prototype, "ctx", void 0);

  __decorate([p(cc.Button)], e.prototype, "closeBtn", void 0);

  __decorate([p(cc.Boolean)], e.prototype, "sAni", void 0);

  __decorate([p(cc.Boolean)], e.prototype, "hAni", void 0);

  __decorate([p({
    displayName: "入场方式",
    tooltip: "设置当前界面的入场方式：\nPop-弹窗进入\nLeft-左边滑动进入，\nRight-右边滑动进入，\nDown-从底部弹出",
    type: cc.Enum(a)
  })], e.prototype, "panelHierachy", void 0);

  return __decorate([u], e);
}(cc.Component);

exports["default"] = d;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcYmFzZVVJLmpzIl0sIm5hbWVzIjpbIm4iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIkhJRVJBUkNIWSIsImEiLCJfY29tIiwicmVxdWlyZSIsIl9pZHgiLCJsIiwiY2MiLCJfZGVjb3JhdG9yIiwidSIsImNjY2xhc3MiLCJwIiwicHJvcGVydHkiLCJ0IiwiTm9uZSIsIkxlZnQiLCJSaWdodCIsIkRvd24iLCJkIiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiY3R4IiwiY2xvc2VCdG4iLCJzQW5pIiwiaEFuaSIsInBhbmVsSGllcmFjaHkiLCJjYiIsImIiLCJjIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwib25Mb2FkIiwibm9kZSIsIm9uIiwiaGlkZVRoaXMiLCJzaG93IiwiaW5pdCIsInVEIiwiYVVJIiwiY2hlY2tTaG93IiwiaGlkZSIsImlzSGlkZWluZyIsImlucyIsIm8iLCJnZXRLIiwiUHJvbWlzZSIsImNhbGwiLCJzdGFydCIsImFjdGl2ZSIsIm9uSGlkZSIsInR3ZWVuIiwidG8iLCJ5Iiwid2luU2l6ZSIsImhlaWdodCIsIm1vdmVIaWRlQW5pIiwidmlldyIsImdldFZpc2libGVTaXplIiwid2lkdGgiLCJ4IiwiZWFzaW5nIiwiY3VzdG9tRWFzZUluT3V0IiwibGVuZ3RoIiwicGxhdGZvcm0iLCJjYW5TaG93QmFubmVyIiwiZ2V0QmFubmVyU2l6ZSIsImdldFN5c3RlbURhdGEiLCJ3aW5kb3dIZWlnaHQiLCJnZXREZXNpZ25SZXNvbHV0aW9uU2l6ZSIsImdldENvbXBvbmVudCIsIldpZGdldCIsImVuYWJsZWQiLCJ1cGRhdGVBbGlnbm1lbnQiLCJnZXRDb21wb25lbnRzSW5DaGlsZHJlbiIsImkiLCJyIiwib25TaG93Iiwic2V0Q2IiLCJzaG93QW5pIiwic2NhbGUiLCJvcGFjaXR5IiwiZG93bkFuaSIsIm1vdmVBbmkiLCJNYXRoIiwicG93IiwiX19kZWNvcmF0ZSIsIk5vZGUiLCJCdXR0b24iLCJCb29sZWFuIiwiZGlzcGxheU5hbWUiLCJ0b29sdGlwIiwidHlwZSIsIkVudW0iLCJDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsQ0FBSjtBQUNBQyxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0VBQUNDLEtBQUssRUFBRSxDQUFDO0FBQVQsQ0FBN0M7QUFDQUQsT0FBTyxDQUFDRSxTQUFSLEdBQW9CLEtBQUssQ0FBekI7QUFDQSxJQUFJQyxDQUFKOztBQUNBLElBQUlDLElBQUksR0FBR0MsT0FBTyxDQUFDLEtBQUQsQ0FBbEI7O0FBQ0EsSUFBSUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsS0FBRCxDQUFsQjs7QUFDQSxJQUFJRSxDQUFDLEdBQUdDLEVBQUUsQ0FBQ0MsVUFBWDtBQUNBLElBQUlDLENBQUMsR0FBR0gsQ0FBQyxDQUFDSSxPQUFWO0FBQ0EsSUFBSUMsQ0FBQyxHQUFHTCxDQUFDLENBQUNNLFFBQVY7O0FBQ0EsQ0FBQyxVQUFVQyxDQUFWLEVBQWE7RUFDVkEsQ0FBQyxDQUFFQSxDQUFDLENBQUNDLElBQUYsR0FBUyxDQUFYLENBQUQsR0FBa0IsTUFBbEI7RUFDQUQsQ0FBQyxDQUFFQSxDQUFDLENBQUNFLElBQUYsR0FBUyxDQUFYLENBQUQsR0FBa0IsTUFBbEI7RUFDQUYsQ0FBQyxDQUFFQSxDQUFDLENBQUNHLEtBQUYsR0FBVSxDQUFaLENBQUQsR0FBbUIsT0FBbkI7RUFDQUgsQ0FBQyxDQUFFQSxDQUFDLENBQUNJLElBQUYsR0FBUyxDQUFYLENBQUQsR0FBa0IsTUFBbEI7QUFDSCxDQUxELEVBS0lmLENBQUMsR0FBR0gsT0FBTyxDQUFDRSxTQUFSLEtBQXNCRixPQUFPLENBQUNFLFNBQVIsR0FBb0IsRUFBMUMsQ0FMUjs7QUFNQSxJQUFJaUIsQ0FBQyxHQUFJLFVBQVVMLENBQVYsRUFBYTtFQUNsQixTQUFTTSxDQUFULEdBQWE7SUFDVCxJQUFJQSxDQUFDLEdBQUksU0FBU04sQ0FB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LEtBQUssQ0FYQyxDQUFWOztFQWFBLE9BQU91RCxVQUFVLENBQUMsQ0FBQzdFLENBQUQsQ0FBRCxFQUFNVSxDQUFOLENBQWpCO0FBQ0gsQ0FuTU8sQ0FtTUxaLEVBQUUsQ0FBQ3VGLFNBbk1FLENBQVI7O0FBb01BL0YsT0FBTyxXQUFQLEdBQWtCbUIsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBuO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7dmFsdWU6ICEwfSk7XG5leHBvcnRzLkhJRVJBUkNIWSA9IHZvaWQgMDtcbnZhciBhO1xudmFyIF9jb20gPSByZXF1aXJlKFwiY29tXCIpO1xudmFyIF9pZHggPSByZXF1aXJlKFwiaWR4XCIpO1xudmFyIGwgPSBjYy5fZGVjb3JhdG9yO1xudmFyIHUgPSBsLmNjY2xhc3M7XG52YXIgcCA9IGwucHJvcGVydHk7XG4oZnVuY3Rpb24gKHQpIHtcbiAgICB0Wyh0Lk5vbmUgPSAwKV0gPSBcIk5vbmVcIjtcbiAgICB0Wyh0LkxlZnQgPSAxKV0gPSBcIkxlZnRcIjtcbiAgICB0Wyh0LlJpZ2h0ID0gMildID0gXCJSaWdodFwiO1xuICAgIHRbKHQuRG93biA9IDMpXSA9IFwiRG93blwiO1xufSkoKGEgPSBleHBvcnRzLkhJRVJBUkNIWSB8fCAoZXhwb3J0cy5ISUVSQVJDSFkgPSB7fSkpKTtcbnZhciBkID0gKGZ1bmN0aW9uICh0KSB7XG4gICAgZnVuY3Rpb24gZSgpIHtcbiAgICAgICAgdmFyIGUgPSAobnVsbCAhPT0gdCAmJiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHx8IHRoaXM7XG4gICAgICAgIGUuY3R4ID0gbnVsbDtcbiAgICAgICAgZS5jbG9zZUJ0biA9IG51bGw7XG4gICAgICAgIGUuc0FuaSA9ICEwO1xuICAgICAgICBlLmhBbmkgPSAhMDtcbiAgICAgICAgZS5wYW5lbEhpZXJhY2h5ID0gYS5Eb3duO1xuICAgICAgICBlLmEgPSAwLjU7XG4gICAgICAgIGUuY2IgPSBudWxsO1xuICAgICAgICBlLmIgPSBudWxsO1xuICAgICAgICBlLmMgPSBudWxsO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgX19leHRlbmRzKGUsIHQpO1xuICAgIGUucHJvdG90eXBlLm9uTG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jbG9zZUJ0biAmJiB0aGlzLmNsb3NlQnRuLm5vZGUub24oXCJjbGlja1wiLCB0aGlzLmhpZGVUaGlzLCB0aGlzKTtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLmhpZGVUaGlzID0gZnVuY3Rpb24gKCkge307XG4gICAgZS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IHRoaXMuYSk7XG4gICAgICAgIHRoaXMuYyA9IHQ7XG4gICAgICAgIHRoaXMuaW5pdCh0aGlzLmMpO1xuICAgICAgICB0aGlzLnVEKHRoaXMuYyk7XG4gICAgICAgIHRoaXMuYVVJKCk7XG4gICAgICAgIHRoaXMuY2hlY2tTaG93KGUpO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIGlmICghdGhpcy5pc0hpZGVpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuaXNIaWRlaW5nID0gITA7XG4gICAgICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgICAgICBfY29tLmRlZmF1bHQuaW5zLmEodCwgMSk7XG4gICAgICAgICAgICBfY29tLmRlZmF1bHQuaW5zLmIodGhpcy5ub2RlLCAhMCk7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMubm9kZTtcbiAgICAgICAgICAgIHZhciBuID0gdGhpcy5nZXRLKGUsIG8pO1xuICAgICAgICAgICAgcmV0dXJuIG5cbiAgICAgICAgICAgICAgICA/IG5ldyBQcm9taXNlKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgbi5jYWxsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdCgxKTtcbiAgICAgICAgICAgICAgICAgICAgICB9KS5zdGFydCgpO1xuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA6IG5ldyBQcm9taXNlKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgby5hY3RpdmUgPSAhMTtcbiAgICAgICAgICAgICAgICAgICAgICBlLm9uSGlkZSAmJiBlLm9uSGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgIF9jb20uZGVmYXVsdC5pbnMuYihlLm5vZGUsICExKTtcbiAgICAgICAgICAgICAgICAgICAgICBlLmNiICYmIGUuY2IobywgZS5iKTtcbiAgICAgICAgICAgICAgICAgICAgICB0KDEpO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGUucHJvdG90eXBlLmdldEsgPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMucGFuZWxIaWVyYWNoeSkge1xuICAgICAgICAgICAgY2FzZSBhLkRvd246XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNjXG4gICAgICAgICAgICAgICAgICAgIC50d2Vlbih0aGlzLmN0eClcbiAgICAgICAgICAgICAgICAgICAgLnRvKDAuMSwge3k6IDYwfSlcbiAgICAgICAgICAgICAgICAgICAgLnRvKDAuMiwge3k6IC0oY2Mud2luU2l6ZS5oZWlnaHQgKyBlLmhlaWdodCkgLyAyfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5hY3RpdmUgPSAhMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHQub25IaWRlICYmIHQub25IaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY29tLmRlZmF1bHQuaW5zLmIodC5ub2RlLCAhMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmNiICYmIHQuY2IoZSwgdC5iKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjYXNlIGEuTGVmdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb3ZlSGlkZUFuaSh0LCBlLCAtY2Mudmlldy5nZXRWaXNpYmxlU2l6ZSgpLndpZHRoKTtcbiAgICAgICAgICAgIGNhc2UgYS5SaWdodDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb3ZlSGlkZUFuaSh0LCBlLCBjYy52aWV3LmdldFZpc2libGVTaXplKCkud2lkdGgpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZS5wcm90b3R5cGUubW92ZUhpZGVBbmkgPSBmdW5jdGlvbiAodCwgZSwgbykge1xuICAgICAgICByZXR1cm4gY2NcbiAgICAgICAgICAgIC50d2Vlbih0aGlzLmN0eClcbiAgICAgICAgICAgIC50bygwLjI1LCB7eDogb30sIHtlYXNpbmc6IHRoaXMuY3VzdG9tRWFzZUluT3V0fSlcbiAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBlLmFjdGl2ZSA9ICExO1xuICAgICAgICAgICAgICAgIHQub25IaWRlICYmIHQub25IaWRlKCk7XG4gICAgICAgICAgICAgICAgX2NvbS5kZWZhdWx0Lmlucy5iKHQubm9kZSwgITEpO1xuICAgICAgICAgICAgICAgIHQuY2IgJiYgdC5jYihlLCB0LmIpO1xuICAgICAgICAgICAgfSk7XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKSB0W2VdID0gYXJndW1lbnRzW2VdO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUuYVVJID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoX2lkeC5wbGF0Zm9ybS5jYW5TaG93QmFubmVyKCkpIHtcbiAgICAgICAgICAgIHZhciB0ID1cbiAgICAgICAgICAgICAgICAoX2lkeC5wbGF0Zm9ybS5nZXRCYW5uZXJTaXplKCkuaGVpZ2h0IC8gX2lkeC5wbGF0Zm9ybS5nZXRTeXN0ZW1EYXRhKCkud2luZG93SGVpZ2h0KSAqXG4gICAgICAgICAgICAgICAgY2Mudmlldy5nZXRWaXNpYmxlU2l6ZSgpLmhlaWdodDtcbiAgICAgICAgICAgIGlmIChudWxsICE9IHRoaXMuY3R4KSB7XG4gICAgICAgICAgICAgICAgdmFyIGUgPSAoY2Mudmlldy5nZXRWaXNpYmxlU2l6ZSgpLmhlaWdodCAtIGNjLnZpZXcuZ2V0RGVzaWduUmVzb2x1dGlvblNpemUoKS5oZWlnaHQpIC8gMjtcbiAgICAgICAgICAgICAgICBlIDwgdCAmJiAodGhpcy5jdHgueSArPSB0IC0gZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG8gPSB0aGlzLmN0eC5nZXRDb21wb25lbnQoY2MuV2lkZ2V0KTtcbiAgICAgICAgbyAmJiAoKG8uZW5hYmxlZCA9ICEwKSwgby51cGRhdGVBbGlnbm1lbnQoKSwgKG8uZW5hYmxlZCA9ICExKSk7XG4gICAgICAgIHZhciBuID0gdGhpcy5jdHguZ2V0Q29tcG9uZW50c0luQ2hpbGRyZW4oY2MuV2lkZ2V0KTtcbiAgICAgICAgaWYgKG4pXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IG5baV07XG4gICAgICAgICAgICAgICAgci5lbmFibGVkID0gITA7XG4gICAgICAgICAgICAgICAgci51cGRhdGVBbGlnbm1lbnQoKTtcbiAgICAgICAgICAgICAgICByLmVuYWJsZWQgPSAhMTtcbiAgICAgICAgICAgIH1cbiAgICB9O1xuICAgIGUucHJvdG90eXBlLnVEID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKSB0W2VdID0gYXJndW1lbnRzW2VdO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUub25TaG93ID0gZnVuY3Rpb24gKCkge307XG4gICAgZS5wcm90b3R5cGUub25IaWRlID0gZnVuY3Rpb24gKCkge307XG4gICAgZS5wcm90b3R5cGUuc2V0Q2IgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICB0aGlzLmNiID0gdDtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLnNob3dBbmkgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIGlmIChudWxsICE9IHRoaXMuY3R4ICYmIHRoaXMuc0FuaSkge1xuICAgICAgICAgICAgdmFyIG8gPSB0aGlzLmN0eDtcbiAgICAgICAgICAgIG8uYWN0aXZlID0gITA7XG4gICAgICAgICAgICBvLnNjYWxlID0gMC41O1xuICAgICAgICAgICAgby5vcGFjaXR5ID0gMDtcbiAgICAgICAgICAgIGNjLnR3ZWVuKG8pXG4gICAgICAgICAgICAgICAgLnRvKHQsIHtzY2FsZTogMSwgb3BhY2l0eTogMjU1fSwge2Vhc2luZzogXCJiYWNrT3V0XCJ9KVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5vblNob3cgJiYgZS5vblNob3coKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGFydCgpO1xuICAgICAgICB9IGVsc2UgdGhpcy5vblNob3cgJiYgdGhpcy5vblNob3coKTtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLmRvd25BbmkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5jdHggJiYgdGhpcy5zQW5pKSB7XG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMuY3R4O1xuICAgICAgICAgICAgZS5hY3RpdmUgPSAhMDtcbiAgICAgICAgICAgIGUueSA9IC0oY2Mud2luU2l6ZS5oZWlnaHQgKyBlLmhlaWdodCkgLyAyO1xuICAgICAgICAgICAgY2MudHdlZW4oZSlcbiAgICAgICAgICAgICAgICAudG8oMC4yLCB7eTogNjB9KVxuICAgICAgICAgICAgICAgIC50bygwLjEsIHt5OiAtMjB9KVxuICAgICAgICAgICAgICAgIC50bygwLjA0LCB7eTogMH0pXG4gICAgICAgICAgICAgICAgLmNhbGwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0Lm9uU2hvdyAmJiB0Lm9uU2hvdygpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXJ0KCk7XG4gICAgICAgIH0gZWxzZSB0aGlzLm9uU2hvdyAmJiB0aGlzLm9uU2hvdygpO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUubW92ZUFuaSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgIGlmICh0aGlzLmN0eCkge1xuICAgICAgICAgICAgdGhpcy5jdHgueCA9IGU7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXM7XG4gICAgICAgICAgICBvLm9uU2hvdyAmJiBvLm9uU2hvdygpO1xuICAgICAgICAgICAgY2MudHdlZW4odGhpcy5jdHgpXG4gICAgICAgICAgICAgICAgLnRvKHQsIHt4OiAwfSwge2Vhc2luZzogdGhpcy5jdXN0b21FYXNlSW5PdXR9KVxuICAgICAgICAgICAgICAgIC5jYWxsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgby5vblNob3cgJiYgby5vblNob3coKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5zdGFydCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5jdXN0b21FYXNlSW5PdXQgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICByZXR1cm4gdCA8IDAuNSA/IDggKiB0ICogdCAqIHQgKiB0IDogMSAtIE1hdGgucG93KC0yICogdCArIDIsIDQpIC8gMjtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLmNoZWNrU2hvdyA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5wYW5lbEhpZXJhY2h5KSB7XG4gICAgICAgICAgICBjYXNlIGEuUmlnaHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlQW5pKHQsIGNjLnZpZXcuZ2V0VmlzaWJsZVNpemUoKS53aWR0aCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGEuRG93bjpcbiAgICAgICAgICAgICAgICB0aGlzLmRvd25BbmkoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgYS5MZWZ0OlxuICAgICAgICAgICAgICAgIHRoaXMubW92ZUFuaSh0LCAtY2Mudmlldy5nZXRWaXNpYmxlU2l6ZSgpLndpZHRoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5vblNob3cgJiYgdGhpcy5vblNob3coKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5vZGUuYWN0aXZlID0gITA7XG4gICAgfTtcbiAgICBfX2RlY29yYXRlKFtwKGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwiY3R4XCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbcChjYy5CdXR0b24pXSwgZS5wcm90b3R5cGUsIFwiY2xvc2VCdG5cIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtwKGNjLkJvb2xlYW4pXSwgZS5wcm90b3R5cGUsIFwic0FuaVwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW3AoY2MuQm9vbGVhbildLCBlLnByb3RvdHlwZSwgXCJoQW5pXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShcbiAgICAgICAgW1xuICAgICAgICAgICAgcCh7XG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwi5YWl5Zy65pa55byPXCIsXG4gICAgICAgICAgICAgICAgdG9vbHRpcDpcbiAgICAgICAgICAgICAgICAgICAgXCLorr7nva7lvZPliY3nlYzpnaLnmoTlhaXlnLrmlrnlvI/vvJpcXG5Qb3At5by556qX6L+b5YWlXFxuTGVmdC3lt6bovrnmu5Hliqjov5vlhaXvvIxcXG5SaWdodC3lj7Povrnmu5Hliqjov5vlhaXvvIxcXG5Eb3duLeS7juW6lemDqOW8ueWHulwiLFxuICAgICAgICAgICAgICAgIHR5cGU6IGNjLkVudW0oYSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIF0sXG4gICAgICAgIGUucHJvdG90eXBlLFxuICAgICAgICBcInBhbmVsSGllcmFjaHlcIixcbiAgICAgICAgdm9pZCAwXG4gICAgKTtcbiAgICByZXR1cm4gX19kZWNvcmF0ZShbdV0sIGUpO1xufSkoY2MuQ29tcG9uZW50KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGQ7XG4iXX0=