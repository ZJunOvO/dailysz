
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/chapterItem.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b3964ueQUBM7pwnBS90wcFu', 'chapterItem');
// scripts/chapterItem.js

"use strict";

var n;
Object.defineProperty(exports, "__esModule", {
  value: !0
});

var _evts = require("evts");

var _idx = require("idx");

var _global = require("global");

var _levelMgr = require("levelMgr");

var _panelMgr = require("panelMgr");

var _pInfo = require("pInfo");

var d = cc._decorator;
var h = d.ccclass;
var f = d.property;

var g = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.nameLbl = null;
    e.pro = null;
    e.proLbl = null;
    e.goBtn = null;
    e.pics = [];
    e.grayMater = null;
    e.normalMater = null;
    return e;
  }

  __extends(e, t);

  e.prototype.init = function (t, e) {
    var o = this;
    this.posObj = e;
    this._chapter = t;
    this.nameLbl.string = "第" + t + "章";

    var n = _pInfo["default"].ins.getPuzzleLvl();

    this.pro.progress = 0;
    var i = n - (54 * (this._chapter - 1) + 1);
    i = i < 0 ? 0 : i;
    _global["default"].levelDone && (i = 54);
    var r = 0;
    i > 0 && (r = Math.floor(i / 9));
    n > 54 * this._chapter && (r = 6, i = 54);

    _levelMgr["default"].ins.getchapterBunder().then(function () {
      for (var t = "" + (100 + o._chapter), e = function e(_e) {
        _levelMgr["default"].ins.getJigsawIcon(_e, t).then(function (t) {
          t && (o.pics[_e - 1].spriteFrame = t, _e <= r ? o.pics[_e - 1].setMaterial(0, o.normalMater) : o.pics[_e - 1].setMaterial(0, o.grayMater));
        })["catch"](function () {
          console.error("getJigsawIconErr");
        });
      }, n = 1; n <= 6; n++) {
        e(n);
      }
    })["catch"](function () {
      console.error("getChapterBundleErr");
    });

    this.updPro();
  };

  e.prototype.updPro = function () {
    if (this._chapter) {
      var t = _pInfo["default"].ins.getPuzzleLvl();

      this.pro.progress = 0;
      var e = t - (54 * (this._chapter - 1) + 1);
      e = (e = e < 0 ? 0 : e) > 54 ? 54 : e;
      cc.tween(this.pro).to(0.5, {
        progress: e / 54
      }).start();
      this.proLbl.string = e + "/54";
    }
  };

  e.prototype.unuse = function () {};

  e.prototype.reuse = function () {};

  e.prototype.onEnable = function () {};

  e.prototype.onDisable = function () {};

  e.prototype.onGoBtn = function () {
    _idx.platform.showLoading();

    var t = _global["default"].levelTmp = this._chapter;

    _levelMgr["default"].ins.updateTmpData(t).then(function () {
      _idx.platform.hideLoading();

      _panelMgr["default"].ins.closeAllPanel();

      _evts["default"].opE.emit({
        action: _evts["default"].UPDATA_LEVEL_TMP
      });
    });
  };

  e.prototype.onDestroy = function () {
    var t = "" + (100 + this._chapter);

    _levelMgr["default"].ins.getchapterBunder().then(function (e) {
      cc.assetManager.releaseAsset(e.get(t + "/chapter", cc.SpriteFrame));
    })["catch"](function () {
      console.error("getBundleErr");
    });
  };

  __decorate([f(cc.Label)], e.prototype, "nameLbl", void 0);

  __decorate([f(cc.ProgressBar)], e.prototype, "pro", void 0);

  __decorate([f(cc.Label)], e.prototype, "proLbl", void 0);

  __decorate([f(cc.Button)], e.prototype, "goBtn", void 0);

  __decorate([f([cc.Sprite])], e.prototype, "pics", void 0);

  __decorate([f(cc.Material)], e.prototype, "grayMater", void 0);

  __decorate([f(cc.Material)], e.prototype, "normalMater", void 0);

  return __decorate([h], e);
}(cc.Component);

exports["default"] = g;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcY2hhcHRlckl0ZW0uanMiXSwibmFtZXMiOlsibiIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiX2V2dHMiLCJyZXF1aXJlIiwiX2lkeCIsIl9nbG9iYWwiLCJfbGV2ZWxNZ3IiLCJfcGFuZWxNZ3IiLCJfcEluZm8iLCJkIiwiY2MiLCJfZGVjb3JhdG9yIiwiaCIsImNjY2xhc3MiLCJmIiwicHJvcGVydHkiLCJnIiwidCIsImUiLCJhcHBseSIsImFyZ3VtZW50cyIsIm5hbWVMYmwiLCJwcm8iLCJwcm9MYmwiLCJnb0J0biIsInBpY3MiLCJncmF5TWF0ZXIiLCJub3JtYWxNYXRlciIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsImluaXQiLCJvIiwicG9zT2JqIiwiX2NoYXB0ZXIiLCJzdHJpbmciLCJpbnMiLCJnZXRQdXp6bGVMdmwiLCJwcm9ncmVzcyIsImkiLCJsZXZlbERvbmUiLCJyIiwiTWF0aCIsImZsb29yIiwiZ2V0Y2hhcHRlckJ1bmRlciIsInRoZW4iLCJnZXRKaWdzYXdJY29uIiwic3ByaXRlRnJhbWUiLCJzZXRNYXRlcmlhbCIsImNvbnNvbGUiLCJlcnJvciIsInVwZFBybyIsInR3ZWVuIiwidG8iLCJzdGFydCIsInVudXNlIiwicmV1c2UiLCJvbkVuYWJsZSIsIm9uRGlzYWJsZSIsIm9uR29CdG4iLCJwbGF0Zm9ybSIsInNob3dMb2FkaW5nIiwibGV2ZWxUbXAiLCJ1cGRhdGVUbXBEYXRhIiwiaGlkZUxvYWRpbmciLCJjbG9zZUFsbFBhbmVsIiwib3BFIiwiZW1pdCIsImFjdGlvbiIsIlVQREFUQV9MRVZFTF9UTVAiLCJvbkRlc3Ryb3kiLCJhc3NldE1hbmFnZXIiLCJyZWxlYXNlQXNzZXQiLCJnZXQiLCJTcHJpdGVGcmFtZSIsIl9fZGVjb3JhdGUiLCJMYWJlbCIsIlByb2dyZXNzQmFyIiwiQnV0dG9uIiwiU3ByaXRlIiwiTWF0ZXJpYWwiLCJDb21wb25lbnQiXSwibWFwcGlu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QyxLQUFLLENBQTVDLENBQVY7O0VBQ0E2QyxVQUFVLENBQUMsQ0FBQzVELENBQUMsQ0FBQyxDQUFDSixFQUFFLENBQUNvRSxNQUFKLENBQUQsQ0FBRixDQUFELEVBQW1CNUQsQ0FBQyxDQUFDVyxTQUFyQixFQUFnQyxNQUFoQyxFQUF3QyxLQUFLLENBQTdDLENBQVY7O0VBQ0E2QyxVQUFVLENBQUMsQ0FBQzVELENBQUMsQ0FBQ0osRUFBRSxDQUFDcUUsUUFBSixDQUFGLENBQUQsRUFBbUI3RCxDQUFDLENBQUNXLFNBQXJCLEVBQWdDLFdBQWhDLEVBQTZDLEtBQUssQ0FBbEQsQ0FBVjs7RUFDQTZDLFVBQVUsQ0FBQyxDQUFDNUQsQ0FBQyxDQUFDSixFQUFFLENBQUNxRSxRQUFKLENBQUYsQ0FBRCxFQUFtQjdELENBQUMsQ0FBQ1csU0FBckIsRUFBZ0MsYUFBaEMsRUFBK0MsS0FBSyxDQUFwRCxDQUFWOztFQUNBLE9BQU82QyxVQUFVLENBQUMsQ0FBQzlELENBQUQsQ0FBRCxFQUFNTSxDQUFOLENBQWpCO0FBQ0gsQ0FwR08sQ0FvR0xSLEVBQUUsQ0FBQ3NFLFNBcEdFLENBQVI7O0FBcUdBaEYsT0FBTyxXQUFQLEdBQWtCZ0IsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBuO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7dmFsdWU6ICEwfSk7XG52YXIgX2V2dHMgPSByZXF1aXJlKFwiZXZ0c1wiKTtcbnZhciBfaWR4ID0gcmVxdWlyZShcImlkeFwiKTtcbnZhciBfZ2xvYmFsID0gcmVxdWlyZShcImdsb2JhbFwiKTtcbnZhciBfbGV2ZWxNZ3IgPSByZXF1aXJlKFwibGV2ZWxNZ3JcIik7XG52YXIgX3BhbmVsTWdyID0gcmVxdWlyZShcInBhbmVsTWdyXCIpO1xudmFyIF9wSW5mbyA9IHJlcXVpcmUoXCJwSW5mb1wiKTtcbnZhciBkID0gY2MuX2RlY29yYXRvcjtcbnZhciBoID0gZC5jY2NsYXNzO1xudmFyIGYgPSBkLnByb3BlcnR5O1xudmFyIGcgPSAoZnVuY3Rpb24gKHQpIHtcbiAgICBmdW5jdGlvbiBlKCkge1xuICAgICAgICB2YXIgZSA9IChudWxsICE9PSB0ICYmIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgfHwgdGhpcztcbiAgICAgICAgZS5uYW1lTGJsID0gbnVsbDtcbiAgICAgICAgZS5wcm8gPSBudWxsO1xuICAgICAgICBlLnByb0xibCA9IG51bGw7XG4gICAgICAgIGUuZ29CdG4gPSBudWxsO1xuICAgICAgICBlLnBpY3MgPSBbXTtcbiAgICAgICAgZS5ncmF5TWF0ZXIgPSBudWxsO1xuICAgICAgICBlLm5vcm1hbE1hdGVyID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIF9fZXh0ZW5kcyhlLCB0KTtcbiAgICBlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgdmFyIG8gPSB0aGlzO1xuICAgICAgICB0aGlzLnBvc09iaiA9IGU7XG4gICAgICAgIHRoaXMuX2NoYXB0ZXIgPSB0O1xuICAgICAgICB0aGlzLm5hbWVMYmwuc3RyaW5nID0gXCLnrKxcIiArIHQgKyBcIueroFwiO1xuICAgICAgICB2YXIgbiA9IF9wSW5mby5kZWZhdWx0Lmlucy5nZXRQdXp6bGVMdmwoKTtcbiAgICAgICAgdGhpcy5wcm8ucHJvZ3Jlc3MgPSAwO1xuICAgICAgICB2YXIgaSA9IG4gLSAoNTQgKiAodGhpcy5fY2hhcHRlciAtIDEpICsgMSk7XG4gICAgICAgIGkgPSBpIDwgMCA/IDAgOiBpO1xuICAgICAgICBfZ2xvYmFsLmRlZmF1bHQubGV2ZWxEb25lICYmIChpID0gNTQpO1xuICAgICAgICB2YXIgciA9IDA7XG4gICAgICAgIGkgPiAwICYmIChyID0gTWF0aC5mbG9vcihpIC8gOSkpO1xuICAgICAgICBuID4gNTQgKiB0aGlzLl9jaGFwdGVyICYmICgociA9IDYpLCAoaSA9IDU0KSk7XG4gICAgICAgIF9sZXZlbE1nci5kZWZhdWx0Lmluc1xuICAgICAgICAgICAgLmdldGNoYXB0ZXJCdW5kZXIoKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGZvciAoXG4gICAgICAgICAgICAgICAgICAgIHZhciB0ID0gXCJcIiArICgxMDAgKyBvLl9jaGFwdGVyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9sZXZlbE1nci5kZWZhdWx0Lmluc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Smlnc2F3SWNvbihlLCB0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoby5waWNzW2UgLSAxXS5zcHJpdGVGcmFtZSA9IHQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPD0gclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG8ucGljc1tlIC0gMV0uc2V0TWF0ZXJpYWwoMCwgby5ub3JtYWxNYXRlcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBvLnBpY3NbZSAtIDFdLnNldE1hdGVyaWFsKDAsIG8uZ3JheU1hdGVyKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZ2V0Smlnc2F3SWNvbkVyclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgbiA9IDE7XG4gICAgICAgICAgICAgICAgICAgIG4gPD0gNjtcbiAgICAgICAgICAgICAgICAgICAgbisrXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICBlKG4pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImdldENoYXB0ZXJCdW5kbGVFcnJcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy51cGRQcm8oKTtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLnVwZFBybyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2NoYXB0ZXIpIHtcbiAgICAgICAgICAgIHZhciB0ID0gX3BJbmZvLmRlZmF1bHQuaW5zLmdldFB1enpsZUx2bCgpO1xuICAgICAgICAgICAgdGhpcy5wcm8ucHJvZ3Jlc3MgPSAwO1xuICAgICAgICAgICAgdmFyIGUgPSB0IC0gKDU0ICogKHRoaXMuX2NoYXB0ZXIgLSAxKSArIDEpO1xuICAgICAgICAgICAgZSA9IChlID0gZSA8IDAgPyAwIDogZSkgPiA1NCA/IDU0IDogZTtcbiAgICAgICAgICAgIGNjLnR3ZWVuKHRoaXMucHJvKVxuICAgICAgICAgICAgICAgIC50bygwLjUsIHtwcm9ncmVzczogZSAvIDU0fSlcbiAgICAgICAgICAgICAgICAuc3RhcnQoKTtcbiAgICAgICAgICAgIHRoaXMucHJvTGJsLnN0cmluZyA9IGUgKyBcIi81NFwiO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS51bnVzZSA9IGZ1bmN0aW9uICgpIHt9O1xuICAgIGUucHJvdG90eXBlLnJldXNlID0gZnVuY3Rpb24gKCkge307XG4gICAgZS5wcm90b3R5cGUub25FbmFibGUgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICBlLnByb3RvdHlwZS5vbkRpc2FibGUgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICBlLnByb3RvdHlwZS5vbkdvQnRuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfaWR4LnBsYXRmb3JtLnNob3dMb2FkaW5nKCk7XG4gICAgICAgIHZhciB0ID0gKF9nbG9iYWwuZGVmYXVsdC5sZXZlbFRtcCA9IHRoaXMuX2NoYXB0ZXIpO1xuICAgICAgICBfbGV2ZWxNZ3IuZGVmYXVsdC5pbnMudXBkYXRlVG1wRGF0YSh0KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF9pZHgucGxhdGZvcm0uaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgICAgIF9wYW5lbE1nci5kZWZhdWx0Lmlucy5jbG9zZUFsbFBhbmVsKCk7XG4gICAgICAgICAgICBfZXZ0cy5kZWZhdWx0Lm9wRS5lbWl0KHthY3Rpb246IF9ldnRzLmRlZmF1bHQuVVBEQVRBX0xFVkVMX1RNUH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLm9uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSBcIlwiICsgKDEwMCArIHRoaXMuX2NoYXB0ZXIpO1xuICAgICAgICBfbGV2ZWxNZ3IuZGVmYXVsdC5pbnNcbiAgICAgICAgICAgIC5nZXRjaGFwdGVyQnVuZGVyKClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgY2MuYXNzZXRNYW5hZ2VyLnJlbGVhc2VBc3NldChlLmdldCh0ICsgXCIvY2hhcHRlclwiLCBjYy5TcHJpdGVGcmFtZSkpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImdldEJ1bmRsZUVyclwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH07XG4gICAgX19kZWNvcmF0ZShbZihjYy5MYWJlbCldLCBlLnByb3RvdHlwZSwgXCJuYW1lTGJsXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbZihjYy5Qcm9ncmVzc0JhcildLCBlLnByb3RvdHlwZSwgXCJwcm9cIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtmKGNjLkxhYmVsKV0sIGUucHJvdG90eXBlLCBcInByb0xibFwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW2YoY2MuQnV0dG9uKV0sIGUucHJvdG90eXBlLCBcImdvQnRuXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbZihbY2MuU3ByaXRlXSldLCBlLnByb3RvdHlwZSwgXCJwaWNzXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbZihjYy5NYXRlcmlhbCldLCBlLnByb3RvdHlwZSwgXCJncmF5TWF0ZXJcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtmKGNjLk1hdGVyaWFsKV0sIGUucHJvdG90eXBlLCBcIm5vcm1hbE1hdGVyXCIsIHZvaWQgMCk7XG4gICAgcmV0dXJuIF9fZGVjb3JhdGUoW2hdLCBlKTtcbn0pKGNjLkNvbXBvbmVudCk7XG5leHBvcnRzLmRlZmF1bHQgPSBnO1xuIl19