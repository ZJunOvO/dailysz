
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/festivalMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b79dds9PTVL16Wia/aps1uK', 'festivalMgr');
// scripts/festivalMgr.js

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: !0
});
exports.fesTaskKey = void 0;
var a;

var _time = require("time");

var _cfgMgr = require("cfgMgr");

var _pInfo = require("pInfo");

var _bagMgr = require("bagMgr");

var p = cc._decorator;
var d = p.ccclass;
p.property;

(function (t) {
  t.raceScore = "race_score";
  t.raceTimes = "race_times";
  t.costPower = "cost_power";
  t.throughMain = "through_main";
  t.finishPuzzle = "finish_puzzle";
})(a = exports.fesTaskKey || (exports.fesTaskKey = {}));

var h = function () {
  function t() {
    this.fesBeginTime = 0;
    this.fesEndTime = 0;
    this.fesTaskDatas = null;
    this.jigsawNum = 1;
  }

  var e;
  e = t;
  Object.defineProperty(t, "ins", {
    get: function get() {
      return this._ins || (this._ins = new e());
    },
    enumerable: !1,
    configurable: !0
  });

  t.prototype.isFesEnd = function () {
    var t = _time["default"].ins.serverTime;
    return t < this.fesBeginTime || t >= this.fesEndTime;
  };

  t.prototype.isFesNotOpen = function () {
    return _time["default"].ins.serverTime < this.fesBeginTime;
  };

  t.prototype.getTodayMaxPro = function () {
    var t = _time["default"].ins.serverTime;
    var e = Math.floor((t - this.fesBeginTime) / 86400);
    return e < 0 ? 0 : e;
  };

  t.prototype.getNowTaskIdx = function () {
    var t = this.getTodayMaxPro();

    var e = _pInfo["default"].ins.getFesPro();

    return Math.min(e, t, 24);
  };

  t.prototype.getNowTaskPro = function () {
    return _pInfo["default"].ins.getFesTaskPro();
  };

  t.prototype.getFesPro = function () {
    return _pInfo["default"].ins.getFesPro();
  };

  t.prototype.getNowTaskData = function () {
    var t = this.getNowTaskIdx();
    return this.fesTaskDatas[t];
  };

  t.prototype.isTaskLocked = function () {
    return _pInfo["default"].ins.getFesPro() > this.getTodayMaxPro();
  };

  t.prototype.isTaskAllFinished = function () {
    return _pInfo["default"].ins.getFesPro() >= this.fesTaskDatas.length;
  };

  t.prototype.updPro = function (t, e) {
    if (!this.isTaskLocked() && this.fesTaskDatas && this.getNowTaskData().get_by == t) {
      var o = _pInfo["default"].ins.getFesTaskPro();

      var n = 0;

      switch (t) {
        case a.raceScore:
          n = e;
          break;

        default:
          n = e + Number(o);
      }

      _pInfo["default"].ins.setFesTaskPro(n);
    }
  };

  t.prototype.finishFesTask = function () {
    var t = _pInfo["default"].ins;
    var e = t.getFesPro();
    t.setFesPro(e + 1);
    t.setFesTaskPro(0);
  };

  t.prototype.isPuzzleLocked = function () {
    return this.getFesPuzzleLv() - 1 > this.getTodayMaxPro();
  };

  t.prototype.getFesPuzzleLv = function () {
    return _pInfo["default"].ins.getFesPuzzleLv();
  };

  t.prototype.finishFesPuzzleLv = function () {
    var t = _pInfo["default"].ins.getFesPuzzleLv();

    _pInfo["default"].ins.setFesPuzzleLv(t + 1);
  };

  t.prototype.clearFesPuzzleLv = function () {
    var t = _pInfo["default"].ins;
    t.setFesPuzzleLv(1);
    t.setFesPro(0);
    t.setFesTaskPro(0);
  };

  t.prototype.getRedNum = function () {
    var t = 0;
    if (!this.fesTaskDatas) return t;

    if (this.isPuzzleLocked() || t++, !this.isTaskLocked()) {
      var e = this.getNowTaskData().nums;
      this.getNowTaskPro() >= e && t++;
    }

    return t;
  };

  t.prototype.updateFestivalData = function () {
    var t;
    return __awaiter(this, void 0, void 0, function () {
      var e;
      var o;
      return __generator(this, function (n) {
        switch (n.label) {
          case 0:
            return e = null === (t = _cfgMgr["default"].serverCfg) || void 0 === t ? void 0 : t.festival_tasks, o = (null == e ? void 0 : e.fesName) || "newYear", _pInfo["default"].ins.getFesName() != o && (_pInfo["default"].ins.setFesName(o), this.clearFesPuzzleLv()), this.fesBeginTime = Number(null == e ? void 0 : e.beginTime) || 1707148800, this.fesEndTime = Number(null == e ? void 0 : e.endTime) || this.fesBeginTime + 216e4, this.fesTaskDatas = null == e ? void 0 : e.rules, this.jigsawNum = (null == e ? void 0 : e.jigsawNum) || 1, [2];

          case 1:
            return [2, n.sent()];
        }
      });
    });
  };

  t.prototype.getFesPuzzleInfo = function () {
    var t = this.fesPuzzleData;
    var e = t[0];
    var o = t[1];
    var n = this.getFesPuzzleLv() - 1;
    var i = t[2 + o + (0 == n ? 0 : t[2 + n - 1] + n)];
    return {
      id: n,
      type: e,
      size: 255 & i,
      diff: i >> 8 & 255
    };
  };

  t.prototype.getFesPuzzleData = function () {
    for (var t = this.fesPuzzleData, e = t[1], o = this.getFesPuzzleLv() - 1, n = 0 == o ? 0 : t[2 + o - 1] + o, i = t[2 + o] + o, r = t[2 + e + n], a = Math.pow(255 & r, 2), s = 2 + e + i + 1, c = [], l = 0, u = 2 + e + n + 1; u < s; u++) {
      for (var p = t[u], d = 0; d < 32; d++) {
        var h = 1 << d & 4294967295;
        if (c[l++] = (p & h) == h ? 1 : 0, l == a) break;
      }

      if (l == a) break;
    }

    return c;
  };

  t.prototype.getFesPuzzleDiff = function () {
    return this.getFesPuzzleInfo().diff;
  };

  t.prototype.getFesLevelCost = function () {
    var t = e.ins.getFesPuzzleDiff();
    var o = _cfgMgr["default"].serverCfg.difficulty_rules.rules;
    var n = 10;
    var i = 1;

    for (var r in o) {
      var a = o[r];
      if (n = Number(a.times_val), i === t) break;
      i++;
    }

    return n;
  };

  t.prototype.getFesPuzzleSprFrame = function () {
    var t = this;
    return new Promise(function (e, o) {
      t.bundle.load("levels/" + t.getFesPuzzleLv(), cc.SpriteFrame, function (t, n) {
        t ? o() : e(n);
      });
    });
  };

  t.prototype.getFesDownSprFrame = function () {
    var t = this;
    return new Promise(function (e, o) {
      t.bundle.load("chapter", cc.SpriteFrame, function (t, n) {
        t ? o() : e(n);
      });
    });
  };

  t.prototype.isPuzzleMax = function () {
    return e.ins.getFesPuzzleLv() > 25;
  };

  t.prototype.isJigsawMax = function () {
    return _bagMgr["default"].ins.getItemCount("newYear_pieces") >= 105 * this.jigsawNum;
  };

  t.prototype.getJigsawNum = function () {
    return this.jigsawNum;
  };

  return e = __decorate([d], t);
}();

exports["default"] = h;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcZmVzdGl2YWxNZ3IuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJmZXNUYXNrS2V5IiwiYSIsIl90aW1lIiwicmVxdWlyZSIsIl9jZmdNZ3IiLCJfcEluZm8iLCJfYmFnTWdyIiwicCIsImNjIiwiX2RlY29yYXRvciIsImQiLCJjY2NsYXNzIiwicHJvcGVydHkiLCJ0IiwicmFjZVNjb3JlIiwicmFjZVRpbWVzIiwiY29zdFBvd2VyIiwidGhyb3VnaE1haW4iLCJmaW5pc2hQdXp6bGUiLCJoIiwiZmVzQmVnaW5UaW1lIiwiZmVzRW5kVGltZSIsImZlc1Rhc2tEYXRhcyIsImppZ3Nhd051bSIsImUiLCJnZXQiLCJfaW5zIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsInByb3RvdHlwZSIsImlzRmVzRW5kIiwiaW5zIiwic2VydmVyVGltZSIsImlzRmVzTm90T3BlbiIsImdldFRvZGF5TWF4UHJvIiwiTWF0aCIsImZsb29yIiwiZ2V0Tm93VGFza0lkeCIsImdldEZlc1BybyIsIm1pbiIsImdldE5vd1Rhc2tQcm8iLCJnZXRGZXNUYXNrUHJvIiwiZ2V0Tm93VGFza0RhdGEiLCJpc1Rhc2tMb2NrZWQiLCJpc1Rhc2tBbGxGaW5pc2hlZCIsImxlbmd0aCIsInVwZFBybyIsImdldF9ieSIsIm8iLCJuIiwiTnVtYmVyIiwic2V0RmVzVGFza1BybyIsImZpbmlzaEZlc1Rhc2siLCJzZXRGZXNQcm8iLCJpc1B1enpsZUxvY2tlZCIsImdldEZlc1B1enpsZUx2IiwiZmluaXNoRmVzUHV6emxlTHYiLCJzZXRGZXNQdXp6bGVMdiIsImNsZWFyRmVzUHV6emxlTHYiLCJnZXRSZWROdW0iLCJudW1zIiwidXBkYXRlRmVzdGl2YWxEYXRhIiwiX19hd2FpdGVyIiwiX19nZW5lcmF0b3IiLCJsYWJlbCIsInNlcnZlckNmZyIsImZlc3RpdmFsX3Rhc2tzIiwiZmVzTmFtZSIsImdldEZlc05hbWUiLCJzZXRGZXNOYW1lIiwiYmVnaW5UaW1lIiwiZW5kVGltZSIsInJ1bGVzIiwic2VudCIsImdldEZlc1B1enpsZUluZm8iLCJmZXNQdXp6bGVEYXRhIiwiaSIsImlkIiwidHlwZSIsInNpemUiLCJkaWZmIiwiZ2V0RmVzUHV6emxlRGF0YSIsInIiLCJwb3ciLCJzIiwiYyIsImwiLCJ1IiwiZ2V0RmVzUHV6emxlRGlmZiIsImdldEZlc0xldmVsQ29zdCIsImRpZmZpY3VsdHlfcnVsZXMiLCJ0aW1lc192YWwiLCJnZXRGZXNQdXp6bGVTcHJGcmFtZSIsIlByb21pc2UiLCJidW5kbGUiLCJsb2FkIiwiU3ByaXRlRnJhbWUiLCJnZXRGZXNEb3duU3ByRnJhbWUiLCJpc1B1enpsZU1heCIsImlzSmlnc2F3TWF4IiwiZ2V0SXRlbUNvdW50IiwiZ2V0Smlnc2F3TnVtIiwiX19kZWNvcmF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztFQUFDQyxLQUFLLEVBQUUsQ0FBQztBQUFULENBQTdDO0FBQ0FELE9BQU8sQ0FBQ0UsVUFBUixHQUFxQixLQUFLLENBQTFCO0FBQ0EsSUFBSUMsQ0FBSjs7QUFDQSxJQUFJQyxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQW5COztBQUNBLElBQUlDLE9BQU8sR0FBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBckI7O0FBQ0EsSUFBSUUsTUFBTSxHQUFHRixPQUFPLENBQUMsT0FBRCxDQUFwQjs7QUFDQSxJQUFJRyxPQUFPLEdBQUdILE9BQU8sQ0FBQyxRQUFELENBQXJCOztBQUNBLElBQUlJLENBQUMsR0FBR0MsRUFBRSxDQUFDQyxVQUFYO0FBQ0EsSUFBSUMsQ0FBQyxHQUFHSCxDQUFDLENBQUNJLE9BQVY7QUFDQUosQ0FBQyxDQUFDSyxRQUFGOztBQUNBLENBQUMsVUFBVUMsQ0FBVixFQUFhO0VBQ1ZBLENBQUMsQ0FBQ0MsU0FBRixHQUFjLFlBQWQ7RUFDQUQs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ZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHt2YWx1ZTogITB9KTtcbmV4cG9ydHMuZmVzVGFza0tleSA9IHZvaWQgMDtcbnZhciBhO1xudmFyIF90aW1lID0gcmVxdWlyZShcInRpbWVcIik7XG52YXIgX2NmZ01nciA9IHJlcXVpcmUoXCJjZmdNZ3JcIik7XG52YXIgX3BJbmZvID0gcmVxdWlyZShcInBJbmZvXCIpO1xudmFyIF9iYWdNZ3IgPSByZXF1aXJlKFwiYmFnTWdyXCIpO1xudmFyIHAgPSBjYy5fZGVjb3JhdG9yO1xudmFyIGQgPSBwLmNjY2xhc3M7XG5wLnByb3BlcnR5O1xuKGZ1bmN0aW9uICh0KSB7XG4gICAgdC5yYWNlU2NvcmUgPSBcInJhY2Vfc2NvcmVcIjtcbiAgICB0LnJhY2VUaW1lcyA9IFwicmFjZV90aW1lc1wiO1xuICAgIHQuY29zdFBvd2VyID0gXCJjb3N0X3Bvd2VyXCI7XG4gICAgdC50aHJvdWdoTWFpbiA9IFwidGhyb3VnaF9tYWluXCI7XG4gICAgdC5maW5pc2hQdXp6bGUgPSBcImZpbmlzaF9wdXp6bGVcIjtcbn0pKChhID0gZXhwb3J0cy5mZXNUYXNrS2V5IHx8IChleHBvcnRzLmZlc1Rhc2tLZXkgPSB7fSkpKTtcbnZhciBoID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KCkge1xuICAgICAgICB0aGlzLmZlc0JlZ2luVGltZSA9IDA7XG4gICAgICAgIHRoaXMuZmVzRW5kVGltZSA9IDA7XG4gICAgICAgIHRoaXMuZmVzVGFza0RhdGFzID0gbnVsbDtcbiAgICAgICAgdGhpcy5qaWdzYXdOdW0gPSAxO1xuICAgIH1cbiAgICB2YXIgZTtcbiAgICBlID0gdDtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgXCJpbnNcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnMgfHwgKHRoaXMuX2lucyA9IG5ldyBlKCkpO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiAhMSxcbiAgICAgICAgY29uZmlndXJhYmxlOiAhMFxuICAgIH0pO1xuICAgIHQucHJvdG90eXBlLmlzRmVzRW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdCA9IF90aW1lLmRlZmF1bHQuaW5zLnNlcnZlclRpbWU7XG4gICAgICAgIHJldHVybiB0IDwgdGhpcy5mZXNCZWdpblRpbWUgfHwgdCA+PSB0aGlzLmZlc0VuZFRpbWU7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5pc0Zlc05vdE9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGltZS5kZWZhdWx0Lmlucy5zZXJ2ZXJUaW1lIDwgdGhpcy5mZXNCZWdpblRpbWU7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5nZXRUb2RheU1heFBybyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSBfdGltZS5kZWZhdWx0Lmlucy5zZXJ2ZXJUaW1lO1xuICAgICAgICB2YXIgZSA9IE1hdGguZmxvb3IoKHQgLSB0aGlzLmZlc0JlZ2luVGltZSkgLyA4NjQwMCk7XG4gICAgICAgIHJldHVybiBlIDwgMCA/IDAgOiBlO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuZ2V0Tm93VGFza0lkeCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLmdldFRvZGF5TWF4UHJvKCk7XG4gICAgICAgIHZhciBlID0gX3BJbmZvLmRlZmF1bHQuaW5zLmdldEZlc1BybygpO1xuICAgICAgICByZXR1cm4gTWF0aC5taW4oZSwgdCwgMjQpO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuZ2V0Tm93VGFza1BybyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9wSW5mby5kZWZhdWx0Lmlucy5nZXRGZXNUYXNrUHJvKCk7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5nZXRGZXNQcm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfcEluZm8uZGVmYXVsdC5pbnMuZ2V0RmVzUHJvKCk7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5nZXROb3dUYXNrRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLmdldE5vd1Rhc2tJZHgoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmVzVGFza0RhdGFzW3RdO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuaXNUYXNrTG9ja2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3BJbmZvLmRlZmF1bHQuaW5zLmdldEZlc1BybygpID4gdGhpcy5nZXRUb2RheU1heFBybygpO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuaXNUYXNrQWxsRmluaXNoZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfcEluZm8uZGVmYXVsdC5pbnMuZ2V0RmVzUHJvKCkgPj0gdGhpcy5mZXNUYXNrRGF0YXMubGVuZ3RoO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUudXBkUHJvID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzVGFza0xvY2tlZCgpICYmIHRoaXMuZmVzVGFza0RhdGFzICYmIHRoaXMuZ2V0Tm93VGFza0RhdGEoKS5nZXRfYnkgPT0gdCkge1xuICAgICAgICAgICAgdmFyIG8gPSBfcEluZm8uZGVmYXVsdC5pbnMuZ2V0RmVzVGFza1BybygpO1xuICAgICAgICAgICAgdmFyIG4gPSAwO1xuICAgICAgICAgICAgc3dpdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBhLnJhY2VTY29yZTpcbiAgICAgICAgICAgICAgICAgICAgbiA9IGU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIG4gPSBlICsgTnVtYmVyKG8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3BJbmZvLmRlZmF1bHQuaW5zLnNldEZlc1Rhc2tQcm8obik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHQucHJvdG90eXBlLmZpbmlzaEZlc1Rhc2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gX3BJbmZvLmRlZmF1bHQuaW5zO1xuICAgICAgICB2YXIgZSA9IHQuZ2V0RmVzUHJvKCk7XG4gICAgICAgIHQuc2V0RmVzUHJvKGUgKyAxKTtcbiAgICAgICAgdC5zZXRGZXNUYXNrUHJvKDApO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuaXNQdXp6bGVMb2NrZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEZlc1B1enpsZUx2KCkgLSAxID4gdGhpcy5nZXRUb2RheU1heFBybygpO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuZ2V0RmVzUHV6emxlTHYgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfcEluZm8uZGVmYXVsdC5pbnMuZ2V0RmVzUHV6emxlTHYoKTtcbiAgICB9O1xuICAgIHQucHJvdG90eXBlLmZpbmlzaEZlc1B1enpsZUx2ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdCA9IF9wSW5mby5kZWZhdWx0Lmlucy5nZXRGZXNQdXp6bGVMdigpO1xuICAgICAgICBfcEluZm8uZGVmYXVsdC5pbnMuc2V0RmVzUHV6emxlTHYodCArIDEpO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuY2xlYXJGZXNQdXp6bGVMdiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSBfcEluZm8uZGVmYXVsdC5pbnM7XG4gICAgICAgIHQuc2V0RmVzUHV6emxlTHYoMSk7XG4gICAgICAgIHQuc2V0RmVzUHJvKDApO1xuICAgICAgICB0LnNldEZlc1Rhc2tQcm8oMCk7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5nZXRSZWROdW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gMDtcbiAgICAgICAgaWYgKCF0aGlzLmZlc1Rhc2tEYXRhcykgcmV0dXJuIHQ7XG4gICAgICAgIGlmICgodGhpcy5pc1B1enpsZUxvY2tlZCgpIHx8IHQrKywgIXRoaXMuaXNUYXNrTG9ja2VkKCkpKSB7XG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMuZ2V0Tm93VGFza0RhdGEoKS5udW1zO1xuICAgICAgICAgICAgdGhpcy5nZXROb3dUYXNrUHJvKCkgPj0gZSAmJiB0Kys7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS51cGRhdGVGZXN0aXZhbERhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZTtcbiAgICAgICAgICAgIHZhciBvO1xuICAgICAgICAgICAgcmV0dXJuIF9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChuLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUgPSBudWxsID09PSAodCA9IF9jZmdNZ3IuZGVmYXVsdC5zZXJ2ZXJDZmcpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuZmVzdGl2YWxfdGFza3MpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChvID0gKG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuZmVzTmFtZSkgfHwgXCJuZXdZZWFyXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9wSW5mby5kZWZhdWx0Lmlucy5nZXRGZXNOYW1lKCkgIT0gbyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX3BJbmZvLmRlZmF1bHQuaW5zLnNldEZlc05hbWUobyksIHRoaXMuY2xlYXJGZXNQdXp6bGVMdigpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5mZXNCZWdpblRpbWUgPSBOdW1iZXIobnVsbCA9PSBlID8gdm9pZCAwIDogZS5iZWdpblRpbWUpIHx8IDE3MDcxNDg4MDApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmZlc0VuZFRpbWUgPSBOdW1iZXIobnVsbCA9PSBlID8gdm9pZCAwIDogZS5lbmRUaW1lKSB8fCB0aGlzLmZlc0JlZ2luVGltZSArIDIxNmU0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5mZXNUYXNrRGF0YXMgPSBudWxsID09IGUgPyB2b2lkIDAgOiBlLnJ1bGVzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5qaWdzYXdOdW0gPSAobnVsbCA9PSBlID8gdm9pZCAwIDogZS5qaWdzYXdOdW0pIHx8IDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsyXVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyLCBuLnNlbnQoKV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuZ2V0RmVzUHV6emxlSW5mbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLmZlc1B1enpsZURhdGE7XG4gICAgICAgIHZhciBlID0gdFswXTtcbiAgICAgICAgdmFyIG8gPSB0WzFdO1xuICAgICAgICB2YXIgbiA9IHRoaXMuZ2V0RmVzUHV6emxlTHYoKSAtIDE7XG4gICAgICAgIHZhciBpID0gdFsyICsgbyArICgwID09IG4gPyAwIDogdFsyICsgbiAtIDFdICsgbildO1xuICAgICAgICByZXR1cm4ge2lkOiBuLCB0eXBlOiBlLCBzaXplOiAyNTUgJiBpLCBkaWZmOiAoaSA+PiA4KSAmIDI1NX07XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5nZXRGZXNQdXp6bGVEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKFxuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmZlc1B1enpsZURhdGEsXG4gICAgICAgICAgICAgICAgZSA9IHRbMV0sXG4gICAgICAgICAgICAgICAgbyA9IHRoaXMuZ2V0RmVzUHV6emxlTHYoKSAtIDEsXG4gICAgICAgICAgICAgICAgbiA9IDAgPT0gbyA/IDAgOiB0WzIgKyBvIC0gMV0gKyBvLFxuICAgICAgICAgICAgICAgIGkgPSB0WzIgKyBvXSArIG8sXG4gICAgICAgICAgICAgICAgciA9IHRbMiArIGUgKyBuXSxcbiAgICAgICAgICAgICAgICBhID0gTWF0aC5wb3coMjU1ICYgciwgMiksXG4gICAgICAgICAgICAgICAgcyA9IDIgKyBlICsgaSArIDEsXG4gICAgICAgICAgICAgICAgYyA9IFtdLFxuICAgICAgICAgICAgICAgIGwgPSAwLFxuICAgICAgICAgICAgICAgIHUgPSAyICsgZSArIG4gKyAxO1xuICAgICAgICAgICAgdSA8IHM7XG4gICAgICAgICAgICB1KytcbiAgICAgICAgKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBwID0gdFt1XSwgZCA9IDA7IGQgPCAzMjsgZCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGggPSAoMSA8PCBkKSAmIDQyOTQ5NjcyOTU7XG4gICAgICAgICAgICAgICAgaWYgKCgoY1tsKytdID0gKHAgJiBoKSA9PSBoID8gMSA6IDApLCBsID09IGEpKSBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsID09IGEpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuZ2V0RmVzUHV6emxlRGlmZiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmVzUHV6emxlSW5mbygpLmRpZmY7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5nZXRGZXNMZXZlbENvc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gZS5pbnMuZ2V0RmVzUHV6emxlRGlmZigpO1xuICAgICAgICB2YXIgbyA9IF9jZmdNZ3IuZGVmYXVsdC5zZXJ2ZXJDZmcuZGlmZmljdWx0eV9ydWxlcy5ydWxlcztcbiAgICAgICAgdmFyIG4gPSAxMDtcbiAgICAgICAgdmFyIGkgPSAxO1xuICAgICAgICBmb3IgKHZhciByIGluIG8pIHtcbiAgICAgICAgICAgIHZhciBhID0gb1tyXTtcbiAgICAgICAgICAgIGlmICgoKG4gPSBOdW1iZXIoYS50aW1lc192YWwpKSwgaSA9PT0gdCkpIGJyZWFrO1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuZ2V0RmVzUHV6emxlU3ByRnJhbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChlLCBvKSB7XG4gICAgICAgICAgICB0LmJ1bmRsZS5sb2FkKFwibGV2ZWxzL1wiICsgdC5nZXRGZXNQdXp6bGVMdigpLCBjYy5TcHJpdGVGcmFtZSwgZnVuY3Rpb24gKHQsIG4pIHtcbiAgICAgICAgICAgICAgICB0ID8gbygpIDogZShuKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHQucHJvdG90eXBlLmdldEZlc0Rvd25TcHJGcmFtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGUsIG8pIHtcbiAgICAgICAgICAgIHQuYnVuZGxlLmxvYWQoXCJjaGFwdGVyXCIsIGNjLlNwcml0ZUZyYW1lLCBmdW5jdGlvbiAodCwgbikge1xuICAgICAgICAgICAgICAgIHQgPyBvKCkgOiBlKG4pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuaXNQdXp6bGVNYXggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBlLmlucy5nZXRGZXNQdXp6bGVMdigpID4gMjU7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5pc0ppZ3Nhd01heCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIF9iYWdNZ3IuZGVmYXVsdC5pbnMuZ2V0SXRlbUNvdW50KFwibmV3WWVhcl9waWVjZXNcIikgPj0gMTA1ICogdGhpcy5qaWdzYXdOdW07XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5nZXRKaWdzYXdOdW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmppZ3Nhd051bTtcbiAgICB9O1xuICAgIHJldHVybiAoZSA9IF9fZGVjb3JhdGUoW2RdLCB0KSk7XG59KSgpO1xuZXhwb3J0cy5kZWZhdWx0ID0gaDtcbiJdfQ==