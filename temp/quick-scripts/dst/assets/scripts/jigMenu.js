
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/jigMenu.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'e8351dgsMZDVIb8DD1BgeAK', 'jigMenu');
// scripts/jigMenu.js

"use strict";

var n;
Object.defineProperty(exports, "__esModule", {
  value: !0
});

var _evts = require("evts");

var _res = require("res");

var _cfgMgr = require("cfgMgr");

var _lang = require("lang");

var _global = require("global");

var _jigsawMgr = require("jigsawMgr");

var _newJigMgr = require("newJigMgr");

var _panelMgr = require("panelMgr");

var _tipMgr = require("tipMgr");

var g = cc._decorator;
var y = g.ccclass;
var m = g.property;

var v = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.icons = [];
    e.idxLbls = [];
    e.pieceLbs = [];
    e.unlockNode = null;
    e.lockNode = null;
    e.finishNode = null;
    e.unPlacedLb = null;
    e.theme_id = 0;
    e.themeType = 1;
    return e;
  }

  __extends(e, t);

  e.prototype.onLoad = function () {
    _evts["default"].opE.on(this.onOperTap.bind(this));
  };

  e.prototype.onOperTap = function (t) {
    var e = null == t ? void 0 : t.action;
    if (e) switch (e) {
      case _evts["default"].UPDJIGSAWGAME:
        this.updateView();
    }
  };

  e.prototype.init = function (t, e) {
    var o = this;
    this.theme_id = t;
    this.themeType = e;
    this.idxLbls.forEach(function (e) {
      e.string = t + 1 + "";
    });
    var n = this.getFinAndAllNum();
    var i = n[0];
    n[1];
    this.pieceLbs.forEach(function (t) {
      t.string = i + "/105";
    });
    var r;
    var a = t + 1;
    var c = "pintu_" + a + "_1";
    var l = "pintu_" + a;
    1 === e ? r = _jigsawMgr["default"].ins : 2 === e && (r = _newJigMgr["default"].ins, c = "fes_" + a + "_1", l = "fes_" + a);
    r.isItemUnlock(t) ? this.initUnLock() : this.initLocked();
    this.IsJigsawCompleted(this.theme_id) && (c = l);
    1 === e ? a < 61 ? _res["default"].ins.getBundleByString("jigsaw").then(function (t) {
      t.load(c, cc.SpriteFrame, function (t, e) {
        !t && o.node && o.node.isValid && o.icons.forEach(function (t) {
          t.spriteFrame = e;
        });
      });
    })["catch"](function (t) {
      console.error("RTool.ins.getBundleByString('jigsaw')", t);
    }) : cc.assetManager.loadRemote(_global.OssConfig.jigswawUrl + c + ".jpg", {
      ext: _global.headImgExt
    }, function (t, e) {
      if (!t && o.node && o.node.isValid) {
        var n = new cc.SpriteFrame(e);
        o.icons.forEach(function (t) {
          t.spriteFrame = n;
        });
      }
    }) : _res["default"].ins.getBundleByString("jigsaw").then(function (t) {
      t.load(c, cc.SpriteFrame, function (t, e) {
        !t && o.node && o.node.isValid && o.icons.forEach(function (t) {
          t.spriteFrame = e;
        });
      });
    })["catch"](function (t) {
      console.error("RTool.ins.getBundleByString('jigsaw')", t);
    });
    this.checkUnPlacedNum();
  };

  e.prototype.updateView = function () {
    this.init(this.theme_id, this.themeType);
  };

  e.prototype.initLocked = function () {
    this.lockNode.active = !0;
    this.unlockNode.active = !1;
    this.finishNode.active = !1;
  };

  e.prototype.initUnLock = function () {
    this.lockNode.active = !1;
    this.IsJigsawCompleted(this.theme_id) ? this.initComplete() : this.initUnComplete();
  };

  e.prototype.initComplete = function () {
    this.unlockNode.active = !1;
    this.finishNode.active = !0;
  };

  e.prototype.initUnComplete = function () {
    this.unlockNode.active = !0;
    this.finishNode.active = !1;
  };

  e.prototype.IsJigsawCompleted = function (t) {
    var e;
    1 === this.themeType ? e = _jigsawMgr["default"].ins : 2 === this.themeType && (e = _newJigMgr["default"].ins);
    var o = e.checkHasFin(t);
    if (o) return o;
    var n = e.getJigsawTilesByIdx(t);

    if (105 == n.length) {
      for (var i = 0, r = n; i < r.length; i++) {
        var a = r[i];
        if (a[0] != a[1]) return !1;
      }

      return !0;
    }

    return !1;
  };

  e.prototype.getFinAndAllNum = function () {
    var t;
    1 === this.themeType ? t = _jigsawMgr["default"].ins : 2 === this.themeType && (t = _newJigMgr["default"].ins);

    for (var e = t.getJigsawTilesByIdx(this.theme_id), o = e.length, n = 0, i = 0; i < o; i++) {
      var r = e[i];
      r[0] == r[1] && n++;
    }

    t.checkHasFin(this.theme_id) && (n = 105);
    return [n, o];
  };

  e.prototype.checkUnPlacedNum = function () {
    var t;
    1 === this.themeType ? t = _jigsawMgr["default"].ins : 2 === this.themeType && (t = _newJigMgr["default"].ins);

    for (var e = t.getJigsawTilesByIdx(this.theme_id), o = e.length, n = 0, i = 0; i < o; i++) {
      var r = e[i];
      r[1] != r[0] && n++;
    }

    t.checkHasFin(this.theme_id) && (n = 0);
    var a = this.unPlacedLb;
    n > 0 ? (a.node.parent.active = !0, a.string = n + "") : a.node.parent.active = !1;
  };

  e.prototype.onBtnClick = function () {
    var t;
    var e;
    var o;
    var n = this.themeType;
    if (1 === n ? o = _jigsawMgr["default"].ins : 2 === n && (o = _newJigMgr["default"].ins), o.isItemUnlock(this.theme_id)) _panelMgr["default"].ins.open("ui/ui_jigsaw", {
      theme_id: this.theme_id,
      themeType: this.themeType
    });else {
      var i = _cfgMgr["default"].serverCfg;
      var r = (null === (e = null === (t = null == i ? void 0 : i.lock_rules) || void 0 === t ? void 0 : t.main_line_lock) || void 0 === e ? void 0 : e.puzzle_line_val) || 0;
      var a = o.isPieceEnough(this.theme_id) ? _lang.lang[30001].format(r) : "拼图未解锁";

      _tipMgr["default"].ins.showTip(a);
    }
  };

  __decorate([m([cc.Sprite])], e.prototype, "icons", void 0);

  __decorate([m([cc.Label])], e.prototype, "idxLbls", void 0);

  __decorate([m([cc.Label])], e.prototype, "pieceLbs", void 0);

  __decorate([m(cc.Node)], e.prototype, "unlockNode", void 0);

  __decorate([m(cc.Node)], e.prototype, "lockNode", void 0);

  __decorate([m(cc.Node)], e.prototype, "finishNode", void 0);

  __decorate([m(cc.Label)], e.prototype, "unPlacedLb", void 0);

  return __decorate([y], e);
}(cc.Component);

exports["default"] = v;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcamlnTWVudS5qcyJdLCJuYW1lcyI6WyJuIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJfZXZ0cyIsInJlcXVpcmUiLCJfcmVzIiwiX2NmZ01nciIsIl9sYW5nIiwiX2dsb2JhbCIsIl9qaWdzYXdNZ3IiLCJfbmV3SmlnTWdyIiwiX3BhbmVsTWdyIiwiX3RpcE1nciIsImciLCJjYyIsIl9kZWNvcmF0b3IiLCJ5IiwiY2NjbGFzcyIsIm0iLCJwcm9wZXJ0eSIsInYiLCJ0IiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiaWNvbnMiLCJpZHhMYmxzIiwicGllY2VMYnMiLCJ1bmxvY2tOb2RlIiwibG9ja05vZGUiLCJmaW5pc2hOb2RlIiwidW5QbGFjZWRMYiIsInRoZW1lX2lkIiwidGhlbWVUeXBlIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwib25Mb2FkIiwib3BFIiwib24iLCJvbk9wZXJUYXAiLCJiaW5kIiwiYWN0aW9uIiwiVVBESklHU0FXR0FNRSIsInVwZGF0ZVZpZXciLCJpbml0IiwibyIsImZvckVhY2giLCJzdHJpbmciLCJnZXRGaW5BbmRBbGxOdW0iLCJpIiwiciIsImEiLCJjIiwibCIsImlucyIsImlzSXRlbVVubG9jayIsImluaXRVbkxvY2siLCJpbml0TG9ja2VkIiwiSXNKaWdzYXdDb21wbGV0ZWQiLCJnZXRCdW5kbGVCeVN0cmluZyIsInRoZW4iLCJsb2FkIiwiU3ByaXRlRnJhbWUiLCJub2RlIiwiaXNWYWxpZCIsInNwcml0ZUZyYW1lIiwiY29uc29sZSIsImVycm9yIiwiYXNzZXRNYW5hZ2VyIiwibG9hZFJlbW90ZSIsIk9zc0NvbmZpZyIsImppZ3N3YXdVcmwiLCJleHQiLCJoZWFkSW1nRXh0IiwiY2hlY2tVblBsYWNlZE51bSIsImFjdGl2ZSIsImluaXRDb21wbGV0ZSIsImluaXRVbkNvbXBsZXRlIiwiY2hlY2tIYXNGaW4iLCJnZXRKaWdzYXdUaWxlc0J5SWR4IiwibGVuZ3RoIiwicGFyZW50Iiwib25CdG5DbGljayIsIm9wZW4iLCJzZXJ2ZXJDZmciLCJsb2NrX3J1bGVzIiwibWFpbl9saW5lX2xvY2siLCJwdXp6bGVfbGluZV92YWwiLCJpc1BpZWNlRW5vdWdoIiwibGFuZyIsImZvcm1hdCIsInNob3dUaXAiLCJfX2RlY29yYXRlIiwiU3ByaXRlIiwiTGFiZWwiLCJOb2RlIiwiQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLENBQUo7QUFDQUMsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztFQUFFQyxLQUFLLEVBQUUsQ0FBQztBQUFWLENBQTdDOztBQUNBLElBQUlDLEtBQUssR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBbkI7O0FBQ0EsSUFBSUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsS0FBRCxDQUFsQjs7QUFDQSxJQUFJRSxPQUFPLEdBQUdGLE9BQU8sQ0FBQyxRQUFELENBQXJCOztBQUNBLElBQUlHLEtBQUssR0FBR0gsT0FBTyxDQUFDLE1BQUQsQ0FBbkI7O0FBQ0EsSUFBSUksT0FBTyxHQUFHSixPQUFPLENBQUMsUUFBRCxDQUFyQjs7QUFDQSxJQUFJSyxVQUFVLEdBQUdMLE9BQU8sQ0FBQyxXQUFELENBQXhCOztBQUNBLElBQUlNLFVBQVUsR0FBR04sT0FBTyxDQUFDLFdBQUQsQ0FBeEI7O0FBQ0EsSUFBSU8sU0FBUyxHQUFHUCxPQUFPLENBQUMsVUFBRCxDQUF2Qjs7QUFDQSxJQUFJUSxPQUFPLEdBQUdSLE9BQU8sQ0FBQyxRQUFELENBQXJCOztBQUNBLElBQUlTLENBQUMsR0FBR0MsRUFBRSxDQUFDQyxVQUFYO0FBQ0EsSUFBSUMsQ0FBQyxHQUFHSCxDQUFDLENBQUNJLE9BQVY7QUFDQSxJQUFJQyxDQUFDLEdBQUdMLENBQUMsQ0FBQ00sUUFBVjs7QUFDQSxJQUFJQyxDQUFDLEdBQUksVUFBU0MsQ0FBVCxFQUFZO0VBQ2pCLFNBQVNDLENBQVQsR0FBYTtJQUNULElBQUlB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LENBQUQsRUFBTU0sQ0FBTixDQUFqQjtBQUNILENBcExPLENBb0xMUixFQUFFLENBQUNrRixTQXBMRSxDQUFSOztBQXFMQS9GLE9BQU8sV0FBUCxHQUFrQm1CLENBQWxCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogITAgfSk7XG52YXIgX2V2dHMgPSByZXF1aXJlKFwiZXZ0c1wiKTtcbnZhciBfcmVzID0gcmVxdWlyZShcInJlc1wiKTtcbnZhciBfY2ZnTWdyID0gcmVxdWlyZShcImNmZ01nclwiKTtcbnZhciBfbGFuZyA9IHJlcXVpcmUoXCJsYW5nXCIpO1xudmFyIF9nbG9iYWwgPSByZXF1aXJlKFwiZ2xvYmFsXCIpO1xudmFyIF9qaWdzYXdNZ3IgPSByZXF1aXJlKFwiamlnc2F3TWdyXCIpO1xudmFyIF9uZXdKaWdNZ3IgPSByZXF1aXJlKFwibmV3SmlnTWdyXCIpO1xudmFyIF9wYW5lbE1nciA9IHJlcXVpcmUoXCJwYW5lbE1nclwiKTtcbnZhciBfdGlwTWdyID0gcmVxdWlyZShcInRpcE1nclwiKTtcbnZhciBnID0gY2MuX2RlY29yYXRvcjtcbnZhciB5ID0gZy5jY2NsYXNzO1xudmFyIG0gPSBnLnByb3BlcnR5O1xudmFyIHYgPSAoZnVuY3Rpb24odCkge1xuICAgIGZ1bmN0aW9uIGUoKSB7XG4gICAgICAgIHZhciBlID0gKG51bGwgIT09IHQgJiYgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB8fCB0aGlzO1xuICAgICAgICBlLmljb25zID0gW107XG4gICAgICAgIGUuaWR4TGJscyA9IFtdO1xuICAgICAgICBlLnBpZWNlTGJzID0gW107XG4gICAgICAgIGUudW5sb2NrTm9kZSA9IG51bGw7XG4gICAgICAgIGUubG9ja05vZGUgPSBudWxsO1xuICAgICAgICBlLmZpbmlzaE5vZGUgPSBudWxsO1xuICAgICAgICBlLnVuUGxhY2VkTGIgPSBudWxsO1xuICAgICAgICBlLnRoZW1lX2lkID0gMDtcbiAgICAgICAgZS50aGVtZVR5cGUgPSAxO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgX19leHRlbmRzKGUsIHQpO1xuICAgIGUucHJvdG90eXBlLm9uTG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBfZXZ0cy5kZWZhdWx0Lm9wRS5vbih0aGlzLm9uT3BlclRhcC5iaW5kKHRoaXMpKTtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLm9uT3BlclRhcCA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgdmFyIGUgPSBudWxsID09IHQgPyB2b2lkIDAgOiB0LmFjdGlvbjtcbiAgICAgICAgaWYgKGUpXG4gICAgICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIF9ldnRzLmRlZmF1bHQuVVBESklHU0FXR0FNRTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVWaWV3KCk7XG4gICAgICAgICAgICB9XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICB2YXIgbyA9IHRoaXM7XG4gICAgICAgIHRoaXMudGhlbWVfaWQgPSB0O1xuICAgICAgICB0aGlzLnRoZW1lVHlwZSA9IGU7XG4gICAgICAgIHRoaXMuaWR4TGJscy5mb3JFYWNoKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGUuc3RyaW5nID0gdCArIDEgKyBcIlwiO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG4gPSB0aGlzLmdldEZpbkFuZEFsbE51bSgpO1xuICAgICAgICB2YXIgaSA9IG5bMF07XG4gICAgICAgIG5bMV07XG4gICAgICAgIHRoaXMucGllY2VMYnMuZm9yRWFjaChmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICB0LnN0cmluZyA9IGkgKyBcIi8xMDVcIjtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciByO1xuICAgICAgICB2YXIgYSA9IHQgKyAxO1xuICAgICAgICB2YXIgYyA9IFwicGludHVfXCIgKyBhICsgXCJfMVwiO1xuICAgICAgICB2YXIgbCA9IFwicGludHVfXCIgKyBhO1xuICAgICAgICAxID09PSBlID9cbiAgICAgICAgICAgIChyID0gX2ppZ3Nhd01nci5kZWZhdWx0LmlucykgOlxuICAgICAgICAgICAgMiA9PT0gZSAmJiAoKHIgPSBfbmV3SmlnTWdyLmRlZmF1bHQuaW5zKSwgKGMgPSBcImZlc19cIiArIGEgKyBcIl8xXCIpLCAobCA9IFwiZmVzX1wiICsgYSkpO1xuICAgICAgICByLmlzSXRlbVVubG9jayh0KSA/IHRoaXMuaW5pdFVuTG9jaygpIDogdGhpcy5pbml0TG9ja2VkKCk7XG4gICAgICAgIHRoaXMuSXNKaWdzYXdDb21wbGV0ZWQodGhpcy50aGVtZV9pZCkgJiYgKGMgPSBsKTtcbiAgICAgICAgMSA9PT0gZSA/XG4gICAgICAgICAgICBhIDwgNjEgP1xuICAgICAgICAgICAgX3Jlcy5kZWZhdWx0Lmluc1xuICAgICAgICAgICAgLmdldEJ1bmRsZUJ5U3RyaW5nKFwiamlnc2F3XCIpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgdC5sb2FkKGMsIGNjLlNwcml0ZUZyYW1lLCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgICAgICF0ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBvLm5vZGUgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIG8ubm9kZS5pc1ZhbGlkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBvLmljb25zLmZvckVhY2goZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc3ByaXRlRnJhbWUgPSBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiUlRvb2wuaW5zLmdldEJ1bmRsZUJ5U3RyaW5nKCdqaWdzYXcnKVwiLCB0KTtcbiAgICAgICAgICAgIH0pIDpcbiAgICAgICAgICAgIGNjLmFzc2V0TWFuYWdlci5sb2FkUmVtb3RlKFxuICAgICAgICAgICAgICAgIF9nbG9iYWwuT3NzQ29uZmlnLmppZ3N3YXdVcmwgKyBjICsgXCIuanBnXCIsIHsgZXh0OiBfZ2xvYmFsLmhlYWRJbWdFeHQgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdCAmJiBvLm5vZGUgJiYgby5ub2RlLmlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gbmV3IGNjLlNwcml0ZUZyYW1lKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgby5pY29ucy5mb3JFYWNoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnNwcml0ZUZyYW1lID0gbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKSA6XG4gICAgICAgICAgICBfcmVzLmRlZmF1bHQuaW5zXG4gICAgICAgICAgICAuZ2V0QnVuZGxlQnlTdHJpbmcoXCJqaWdzYXdcIilcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICB0LmxvYWQoYywgY2MuU3ByaXRlRnJhbWUsIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgICAgICAgICAgIXQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIG8ubm9kZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgby5ub2RlLmlzVmFsaWQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIG8uaWNvbnMuZm9yRWFjaChmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5zcHJpdGVGcmFtZSA9IGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJSVG9vbC5pbnMuZ2V0QnVuZGxlQnlTdHJpbmcoJ2ppZ3NhdycpXCIsIHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2hlY2tVblBsYWNlZE51bSgpO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUudXBkYXRlVmlldyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmluaXQodGhpcy50aGVtZV9pZCwgdGhpcy50aGVtZVR5cGUpO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUuaW5pdExvY2tlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLmxvY2tOb2RlLmFjdGl2ZSA9ICEwO1xuICAgICAgICB0aGlzLnVubG9ja05vZGUuYWN0aXZlID0gITE7XG4gICAgICAgIHRoaXMuZmluaXNoTm9kZS5hY3RpdmUgPSAhMTtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLmluaXRVbkxvY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5sb2NrTm9kZS5hY3RpdmUgPSAhMTtcbiAgICAgICAgdGhpcy5Jc0ppZ3Nhd0NvbXBsZXRlZCh0aGlzLnRoZW1lX2lkKSA/IHRoaXMuaW5pdENvbXBsZXRlKCkgOiB0aGlzLmluaXRVbkNvbXBsZXRlKCk7XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5pbml0Q29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy51bmxvY2tOb2RlLmFjdGl2ZSA9ICExO1xuICAgICAgICB0aGlzLmZpbmlzaE5vZGUuYWN0aXZlID0gITA7XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5pbml0VW5Db21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnVubG9ja05vZGUuYWN0aXZlID0gITA7XG4gICAgICAgIHRoaXMuZmluaXNoTm9kZS5hY3RpdmUgPSAhMTtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLklzSmlnc2F3Q29tcGxldGVkID0gZnVuY3Rpb24odCkge1xuICAgICAgICB2YXIgZTtcbiAgICAgICAgMSA9PT0gdGhpcy50aGVtZVR5cGUgPyAoZSA9IF9qaWdzYXdNZ3IuZGVmYXVsdC5pbnMpIDogMiA9PT0gdGhpcy50aGVtZVR5cGUgJiYgKGUgPSBfbmV3SmlnTWdyLmRlZmF1bHQuaW5zKTtcbiAgICAgICAgdmFyIG8gPSBlLmNoZWNrSGFzRmluKHQpO1xuICAgICAgICBpZiAobykgcmV0dXJuIG87XG4gICAgICAgIHZhciBuID0gZS5nZXRKaWdzYXdUaWxlc0J5SWR4KHQpO1xuICAgICAgICBpZiAoMTA1ID09IG4ubGVuZ3RoKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgciA9IG47IGkgPCByLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSByW2ldO1xuICAgICAgICAgICAgICAgIGlmIChhWzBdICE9IGFbMV0pIHJldHVybiAhMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gITE7XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5nZXRGaW5BbmRBbGxOdW0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHQ7XG4gICAgICAgIDEgPT09IHRoaXMudGhlbWVUeXBlID8gKHQgPSBfamlnc2F3TWdyLmRlZmF1bHQuaW5zKSA6IDIgPT09IHRoaXMudGhlbWVUeXBlICYmICh0ID0gX25ld0ppZ01nci5kZWZhdWx0Lmlucyk7XG4gICAgICAgIGZvciAodmFyIGUgPSB0LmdldEppZ3Nhd1RpbGVzQnlJZHgodGhpcy50aGVtZV9pZCksIG8gPSBlLmxlbmd0aCwgbiA9IDAsIGkgPSAwOyBpIDwgbzsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgciA9IGVbaV07XG4gICAgICAgICAgICByWzBdID09IHJbMV0gJiYgbisrO1xuICAgICAgICB9XG4gICAgICAgIHQuY2hlY2tIYXNGaW4odGhpcy50aGVtZV9pZCkgJiYgKG4gPSAxMDUpO1xuICAgICAgICByZXR1cm4gW24sIG9dO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUuY2hlY2tVblBsYWNlZE51bSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgMSA9PT0gdGhpcy50aGVtZVR5cGUgPyAodCA9IF9qaWdzYXdNZ3IuZGVmYXVsdC5pbnMpIDogMiA9PT0gdGhpcy50aGVtZVR5cGUgJiYgKHQgPSBfbmV3SmlnTWdyLmRlZmF1bHQuaW5zKTtcbiAgICAgICAgZm9yICh2YXIgZSA9IHQuZ2V0Smlnc2F3VGlsZXNCeUlkeCh0aGlzLnRoZW1lX2lkKSwgbyA9IGUubGVuZ3RoLCBuID0gMCwgaSA9IDA7IGkgPCBvOyBpKyspIHtcbiAgICAgICAgICAgIHZhciByID0gZVtpXTtcbiAgICAgICAgICAgIHJbMV0gIT0gclswXSAmJiBuKys7XG4gICAgICAgIH1cbiAgICAgICAgdC5jaGVja0hhc0Zpbih0aGlzLnRoZW1lX2lkKSAmJiAobiA9IDApO1xuICAgICAgICB2YXIgYSA9IHRoaXMudW5QbGFjZWRMYjtcbiAgICAgICAgbiA+IDAgPyAoKGEubm9kZS5wYXJlbnQuYWN0aXZlID0gITApLCAoYS5zdHJpbmcgPSBuICsgXCJcIikpIDogKGEubm9kZS5wYXJlbnQuYWN0aXZlID0gITEpO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUub25CdG5DbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIHZhciBvO1xuICAgICAgICB2YXIgbiA9IHRoaXMudGhlbWVUeXBlO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICAoMSA9PT0gbiA/IChvID0gX2ppZ3Nhd01nci5kZWZhdWx0LmlucykgOiAyID09PSBuICYmIChvID0gX25ld0ppZ01nci5kZWZhdWx0LmlucyksXG4gICAgICAgICAgICAgICAgby5pc0l0ZW1VbmxvY2sodGhpcy50aGVtZV9pZCkpXG4gICAgICAgIClcbiAgICAgICAgICAgIF9wYW5lbE1nci5kZWZhdWx0Lmlucy5vcGVuKFwidWkvdWlfamlnc2F3XCIsIHsgdGhlbWVfaWQ6IHRoaXMudGhlbWVfaWQsIHRoZW1lVHlwZTogdGhpcy50aGVtZVR5cGUgfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIGkgPSBfY2ZnTWdyLmRlZmF1bHQuc2VydmVyQ2ZnO1xuICAgICAgICAgICAgdmFyIHIgPVxuICAgICAgICAgICAgICAgIChudWxsID09PVxuICAgICAgICAgICAgICAgICAgICAoZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsID09PSAodCA9IG51bGwgPT0gaSA/IHZvaWQgMCA6IGkubG9ja19ydWxlcykgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC5tYWluX2xpbmVfbG9jaykgfHxcbiAgICAgICAgICAgICAgICAgICAgdm9pZCAwID09PSBlID9cbiAgICAgICAgICAgICAgICAgICAgdm9pZCAwIDpcbiAgICAgICAgICAgICAgICAgICAgZS5wdXp6bGVfbGluZV92YWwpIHx8IDA7XG4gICAgICAgICAgICB2YXIgYSA9IG8uaXNQaWVjZUVub3VnaCh0aGlzLnRoZW1lX2lkKSA/IF9sYW5nLmxhbmdbMzAwMDFdLmZvcm1hdChyKSA6IFwi5ou85Zu+5pyq6Kej6ZSBXCI7XG4gICAgICAgICAgICBfdGlwTWdyLmRlZmF1bHQuaW5zLnNob3dUaXAoYSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIF9fZGVjb3JhdGUoW20oW2NjLlNwcml0ZV0pXSwgZS5wcm90b3R5cGUsIFwiaWNvbnNcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFttKFtjYy5MYWJlbF0pXSwgZS5wcm90b3R5cGUsIFwiaWR4TGJsc1wiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW20oW2NjLkxhYmVsXSldLCBlLnByb3RvdHlwZSwgXCJwaWVjZUxic1wiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW20oY2MuTm9kZSldLCBlLnByb3RvdHlwZSwgXCJ1bmxvY2tOb2RlXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbbShjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImxvY2tOb2RlXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbbShjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImZpbmlzaE5vZGVcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFttKGNjLkxhYmVsKV0sIGUucHJvdG90eXBlLCBcInVuUGxhY2VkTGJcIiwgdm9pZCAwKTtcbiAgICByZXR1cm4gX19kZWNvcmF0ZShbeV0sIGUpO1xufSkoY2MuQ29tcG9uZW50KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHY7Il19