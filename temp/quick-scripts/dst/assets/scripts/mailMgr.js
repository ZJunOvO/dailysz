
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/mailMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '77a46/RNnRPC5N1AjkZjR9U', 'mailMgr');
// scripts/mailMgr.js

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: !0
});
exports.mailState = void 0;
var n;

var _numberUtils = require("NumberUtils");

var _evts = require("evts");

var _request = require("request");

var _time = require("time");

var _pInfo = require("pInfo");

var _bagMgr = require("bagMgr");

var u = function () {
  function t() {
    if (this._mailInfo = {}, this._serverMail = {}, this.isGetting = !1, this.getCb = [], t._ins) throw new Error("mailMgr can only be one！");
    t._ins = this;
    this.initMail();
  }

  Object.defineProperty(t, "ins", {
    get: function get() {
      t._ins || new t();
      return t._ins;
    },
    enumerable: !1,
    configurable: !0
  });

  t.prototype.initMail = function () {
    this._mailInfo = _pInfo["default"].ins.Mail;
    this._mailInfo.mail || (this._mailInfo.mail = {});
    this._mailInfo.outMail || (this._mailInfo.outMail = []);
  };

  t.prototype.saveMail = function () {
    _pInfo["default"].ins.Mail = this._mailInfo;
  };

  Object.defineProperty(t.prototype, "mailInfo", {
    get: function get() {
      return this._mailInfo;
    },
    enumerable: !1,
    configurable: !0
  });
  Object.defineProperty(t.prototype, "serverMail", {
    get: function get() {
      return this._serverMail;
    },
    enumerable: !1,
    configurable: !0
  });

  t.prototype.getMail = function (t) {
    if (t && this.getCb.push(t), !this.isGetting) {
      var e = this;

      var o = function o(t) {
        e.getCb.length > 0 && e.getCb.forEach(function (e) {
          return e && e(t);
        });
        e.getCb = [];
        e.isGetting = !1;
      };

      e.isGetting = !0;
      var t = {
        "status": 0,
        "msg": "无邮件信息",
        "code": 0,
        "server_time": Date.now()
      }; // _request.default.ins
      //     .getMailData(void 0, this._mailInfo.outMail)
      //     .then(function (t) {

      if (t && t.code && t.data) {
        var i;
        if (e.mailInfo.mail instanceof Array) i = e.mailInfo.mail, e.mailInfo.mail = {};else if (Object.keys(e._mailInfo.mail).length !== t.data.length) {
          var r = new Set();
          var a = JSON.parse(JSON.stringify(e._mailInfo.mail));

          for (var c in JSON.parse(JSON.stringify(t.data)).forEach(function (t) {
            r.add(t.id);
          }), a) {
            r.has(Number(c)) || delete e._mailInfo.mail[c];
          }
        }
        t.data.forEach(function (t) {
          e._serverMail[t.id] = t;
          t.end_time < 1e3 * _time["default"].ins.serverTime ? e._mailInfo.outMail.indexOf(t.id) < 0 && e._mailInfo.outMail.push(t.id) : e.mailInfo.mail[t.id] || (i && i.indexOf(t.id) > -1 ? e.mailInfo.mail[t.id] = i[t.id] : e.mailInfo.mail[t.id] = n.noRead);
        });
      } else t && 0 === t.code && (e.mailInfo.mail = {});

      e.saveMail();
      o(e._serverMail); // })
      // .catch(function (t) {
      //     console.error("getMailDataErr", t);
      //     o({errMsg: "error"});
      // });
    }
  };

  t.prototype.deleteMail = function (t) {
    if (void 0 === t && (t = null), t = _numberUtils["default"].parseNum(t)) return this._mailInfo.mail[t] && delete this._mailInfo.mail[t], -1 == this._mailInfo.outMail.indexOf(t) && this._mailInfo.outMail.push(t), this.saveMail(), !0;

    for (var e in this._mailInfo.mail) {
      if (this._mailInfo.mail[e] === n.award) {
        var o = _numberUtils["default"].parseNum(e);

        -1 == this._mailInfo.outMail.indexOf(o) && this._mailInfo.outMail.push(o);
        this._mailInfo.mail[e] && delete this._mailInfo.mail[e];
      }
    }

    this.saveMail();

    _evts["default"].opE.emit({
      action: _evts["default"].UPDMAIL,
      data: {
        type: "keyDelete"
      }
    });

    return !0;
  };

  t.prototype.getAward = function (t) {
    if (void 0 === t && (t = null), t) return this._mailInfo.mail[t] != n.award && (this._mailInfo.mail[t] = n.award, this.addItem(t), this.saveMail(), !0);
    var e = !1;

    for (var o in this._mailInfo.mail) {
      this._mailInfo.mail[o] !== n.award && (e || (e = !0), this._mailInfo.mail[o] = n.award, this.addItem(o));
    }

    e && this.saveMail();

    _evts["default"].opE.emit({
      action: _evts["default"].UPDMAIL,
      data: {
        type: "keyAward"
      }
    });

    return e;
  };

  t.prototype.readMail = function (t) {
    void 0 === t && (t = null);
    return !(!t || !this._mailInfo.mail[t] || this._mailInfo.mail[t] != n.award && (this._mailInfo.mail[t] != n.noRead || (this._mailInfo.mail[t] = n.read, this.saveMail(), 0)));
  };

  t.prototype.addItem = function (t) {
    var e = this.serverMail;

    if (t) {
      if (!e[t]) return;

      for (var o = JSON.parse(e[t].props), n = Object.keys(o), i = 0; i < n.length; i++) {
        var r = n[i];

        if (o.hasOwnProperty(r)) {
          var a = i === n.length - 1;

          _bagMgr["default"].ins.addItem(r, o[r], !0, a);
        }
      }
    }
  };

  return t;
}();

exports["default"] = u;

(function (t) {
  t[t.none = 0] = "none", t[t.noRead = 1] = "noRead", t[t.read = 2] = "read", t[t.award = 3] = "award";
})(n = exports.mailState || (exports.mailState = {}));

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcbWFpbE1nci5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsIm1haWxTdGF0ZSIsIm4iLCJfbnVtYmVyVXRpbHMiLCJyZXF1aXJlIiwiX2V2dHMiLCJfcmVxdWVzdCIsIl90aW1lIiwiX3BJbmZvIiwiX2JhZ01nciIsInUiLCJ0IiwiX21haWxJbmZvIiwiX3NlcnZlck1haWwiLCJpc0dldHRpbmciLCJnZXRDYiIsIl9pbnMiLCJFcnJvciIsImluaXRNYWlsIiwiZ2V0IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsInByb3RvdHlwZSIsImlucyIsIk1haWwiLCJtYWlsIiwib3V0TWFpbCIsInNhdmVNYWlsIiwiZ2V0TWFpbCIsInB1c2giLCJlIiwibyIsImxlbmd0aCIsImZvckVhY2giLCJEYXRlIiwibm93IiwiY29kZSIsImRhdGEiLCJpIiwibWFpbEluZm8iLCJBcnJheSIsImtleXMiLCJyIiwiU2V0IiwiYSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsImMiLCJhZGQiLCJpZCIsImhhcyIsIk51bWJlciIsImVuZF90aW1lIiwic2VydmVyVGltZSIsImluZGV4T2YiLCJub1JlYWQiLCJkZWxldGVNYWlsIiwicGFyc2VOdW0iLCJhd2FyZCIsIm9wRSIsImVtaXQiLCJhY3Rpb24iLCJVUERNQUlMIiwidHlwZSIsImdldEF3YXJkIiwiYWRkSXRlbSIsInJlYWRNYWlsIiwicmVhZCIsInNlcnZlck1haWwiLCJwcm9wcyIsImhhc093blByb3BlcnR5Iiwibm9uZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztFQUFFQyxLQUFLLEVBQUUsQ0FBQztBQUFWLENBQTdDO0FBQ0FELE9BQU8sQ0FBQ0UsU0FBUixHQUFvQixLQUFLLENBQXpCO0FBQ0EsSUFBSUMsQ0FBSjs7QUFDQSxJQUFJQyxZQUFZLEdBQUdDLE9BQU8sQ0FBQyxhQUFELENBQTFCOztBQUNBLElBQUlDLEtBQUssR0FBR0QsT0FBTyxDQUFDLE1BQUQsQ0FBbkI7O0FBQ0EsSUFBSUUsUUFBUSxHQUFHRixPQUFPLENBQUMsU0FBRCxDQUF0Qjs7QUFDQSxJQUFJRyxLQUFLLEdBQUdILE9BQU8sQ0FBQyxNQUFELENBQW5COztBQUNBLElBQUlJLE1BQU0sR0FBR0osT0FBTyxDQUFDLE9BQUQsQ0FBcEI7O0FBQ0EsSUFBSUssT0FBTyxHQUFHTCxPQUFPLENBQUMsUUFBRCxDQUFyQjs7QUFDQSxJQUFJTSxDQUFDLEdBQUksWUFBVztFQUNoQixTQUFTQyxDQUFULEdBQWE7SUFDVCxJQUFNLEtBQUtDLFNBQUwsR0FBaUIsRUFBbEIsRUFBd0IsS0FBS0MsV0FBTCxHQUFtQixFQUEzQyxFQUFpRCxLQUFLQyxTQUFMLEdBQWlCLENBQUMsQ0FBbkUsRUFBd0UsS0FBS0MsS0FBTCxHQUFhLEVBQXJGLEVBQTBGSixDQUFDLENBQUNLLElBQWpHLEVBQ0ksTUFBTSxJQUFJQyxLQUFKLENBQVUsMEJBQVYsQ0FBTjtJQUNKTixDQUFDLENBQUNLLElBQUYsR0FBUyxJQUFUO0lBQ0EsS0FBS0UsUUFBTDtFQUNIOztFQUNEckIsTUFBTSxDQUFDQyxjQUFQLENBQXNCYSxDQUF0QixFQUF5QixLQUF6QixFQUFnQztJQUM1QlEsR0FBRyxFQUFFLGVBQVc7TUFDWlIsQ0FBQyxDQUFDSyxJQUFGLElBQVUsSUFBSUwsQ0FBSixFQUFWO01BQ0EsT0FBT0EsQ0FBQyxDQUFDSyxJQUFUO0lBQ0gsQ0FKMkI7SUFLNUJJLFVBQVUsRUFBRSxDQUFDLENBTGU7SUFNNUJDLFlBQVksRUFBRSxDQUFDO0VBTmEsQ0FBaEM7O0VBUUFWLENBQUMsQ0FBQ1csU0FBRixDQUFZSixRQUFaLEdBQXVCLFlBQVc7SUFDOUIsS0FBS04sU0FBTCxHQUFpQkosTUFBTSxXQUFOLENBQWVlLEdBQWYsQ0FBbUJDLElBQXBDO0lBQ0EsS0FBS1osU0FBTCxDQUFlYSxJQUFmLEtBQXdCLEtBQUtiLFNBQUwsQ0FBZWEsSUFBZixHQUFzQixFQUE5QztJQUNBLEtBQUtiLFNBQUwsQ0FBZWMsT0FBZixLQUEyQixLQUFLZCxTQUFMLENBQWVjLE9BQWYsR0FBeUIsRUFBcEQ7RUFDSCxDQUpEOztFQUtBZixDQUFDLENBQUNXLFNBQUYsQ0FBWUssUUFBWixHQUF1QixZQUFXO0lBQzlCbkIsTUFBTSxXQUFOLENBQWVlLEdBQWYsQ0FBbUJDLElBQW5CLEdBQTBCLEtBQUtaLFNBQS9CO0VBQ0gsQ0FGRDs7RUFHQWYsTUFBTSxDQUFDQyxjQUFQLENBQXNCYSxDQUFDLENBQUNXLFNBQXhCLEVBQW1DLFVBQW5DLEVBQStDO0lBQzNDSCxHQUFHLEVBQUUsZUFBVztNQUNaLE9BQU8sS0FBS1AsU0FBWjtJQUNILENBSDBDO0lBSTNDUSxVQUFVLEVBQUUsQ0FBQyxDQUo4QjtJQUszQ0MsWUFBWSxFQUFFLENBQUM7RUFMNEIsQ0FBL0M7RUFPQXhCLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQmEsQ0FBQyxDQUFDVyxTQUF4QixFQUFtQyxZQUFuQyxFQUFpRDtJQUM3Q0gsR0FBRyxFQUFFLGVBQVc7TUFDWixPQUFPLEtBQUtOLFdBQVo7SUFDSCxDQUg0QztJQUk3Q08sVUFBVSxFQUFFLENBQUMsQ0FKZ0M7SUFLN0NDLFlBQVksRUFBRSxDQUFDO0VBTDhCLENBQWpEOztFQU9BVixDQUFDLENBQUNXLFNBQUYsQ0FBWU0sT0FBWixHQUFzQixVQUFTakIsQ0FBVCxFQUFZO0lBQzlCLElBQUtBLENBQUMsSUFBSSxLQUFLSSxLQUFMLENBQVdjLElBQVgsQ0FBZ0JsQixDQUFoQixDQUFMLEVBQXlCLENBQUMsS0FBS0csU0FBcEMsRUFBZ0Q7TUFDNUMsSUFBSWdCLENBQUMsR0FBRyxJQUFSOztNQUNBLElBQUlDLENBQUMsR0FBRyxTQUFKQSxDQUFJLENBQVNwQixDQUFULEVBQVk7UUFDaEJtQixDQUFDLENBQUNmLEtBQUYsQ0FBUWlCLE1BQVIsR0FBaUIsQ0FBakIsSUFDSUYsQ0FBQyxDQUFDZixLQUFGLENBQVFrQixPQUFSLENBQWdCLFVBQVNILENBQVQsRUFBWTtVQUN4QixPQUFPQSxDQUFDLElBQUlBLENBQUMsQ0FBQ25CLENBQUQsQ0FBYjtRQUNILENBRkQsQ0FESjtRQUlBbUIsQ0FBQyxDQUFDZixLQUFGLEdBQVUsRUFBVjtRQUNBZSxDQUFDLENBQUNoQixTQUFGLEdBQWMsQ0FBQyxDQUFmO01BQ0gsQ0FQRDs7TUFRQWdCLENBQUMsQ0FBQ2hCLFNBQUYsR0FBYyxDQUFDLENBQWY7TUFDQSxJQUFJSCxDQUFDLEdBQUc7UUFDSixVQUFVLENBRE47UUFFSixPQUFPLE9BRkg7UUFHSixRQUFRLENBSEo7UUFJSixlQUFldUIsSUFBSSxDQUFDQyxHQUFMO01BSlgsQ0FBUixDQVg0QyxDQWlCNUM7TUFDQTtNQUNBOztNQUNBLElBQUl4QixDQUFDLElBQUlBLENBQUMsQ0FBQ3lCLElBQVAsSUFBZXpCLENBQUMsQ0FBQzBCLElBQXJCLEVBQTJCO1FBQ3ZCLElBQUlDLENBQUo7UUFDQSxJQUFJUixDQUFDLENBQUNTLFFBQUYsQ0FBV2QsSUFBWCxZQUEyQmUsS0FBL0IsRUFBc0NGLENBQUMsR0FBR1IsQ0FBQyxDQUFDUyxRQUFGLENBQVdkLElBQWhCLEVBQXdCSyxDQUFDLENBQUNTLFFBQUYsQ0FBV2QsSUFBWCxHQUFrQixFQUExQyxDQUFyQyxLQUNLLElBQUk1QixNQUFNLENBQUM0QyxJQUFQLENBQVlYLENBQUMsQ0FBQ2xCLFNBQUYsQ0FBWWEsSUFBeEIsRUFBOEJPLE1BQTlCLEtBQXlDckIsQ0FBQyxDQUFDMEIsSUFBRixDQUFPTCxNQUFwRCxFQUE0RDtVQUM3RCxJQUFJVSxDQUFDLEdBQUcsSUFBSUMsR0FBSixFQUFSO1VBQ0EsSUFBSUMsQ0FBQyxHQUFHQyxJQUFJLENBQUNDLEtBQUwsQ0FBV0QsSUFBSSxDQUFDRSxTQUFMLENBQWVqQixDQUFDLENBQUNsQixTQUFGLENBQVlhLElBQTNCLENBQVgsQ0FBUjs7VUFDQSxLQUFLLElBQUl1QixDQUFULElBQWVILElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLFNBQUwsQ0FBZXBDLENBQUMsQ0FBQzBCLElBQWpCLENBQVgsRUFBbUNKLE9BQW5DLENBQTJDLFVBQVN0QixDQUFULEVBQVk7WUFDMUQrQixDQUFDLENBQUNPLEdBQUYsQ0FBTXRDLENBQUMsQ0FBQ3VDLEVBQVI7VUFDSCxDQUZNLEdBR1BOLENBSFI7WUFJSUYsQ0FBQyxDQUFDUyxHQUFGLENBQU1DLE1BQU0sQ0FBQ0osQ0FBRCxDQUFaLEtBQW9CLE9BQU9sQixDQUFDLENBQUNsQixTQUFGLENBQVlhLElBQVosQ0FBaUJ1QixDQUFqQixDQUEzQjtVQUpKO1FBS0g7UUFDRHJDLENBQUMsQ0FBQzBCLElBQUYsQ0FBT0osT0FBUCxDQUFlLFVBQVN0QixDQUFULEVBQVk7VUFDdkJtQixDQUFDLENBQUNqQixXQUFGLENBQWNGLENBQUMsQ0FBQ3VDLEVBQWhCLElBQXNCdkMsQ0FBdEI7VUFDQUEsQ0FBQyxDQUFDMEMsUUFBRixHQUFhLE1BQU05QyxLQUFLLFdBQUwsQ0FBY2dCLEdBQWQsQ0FBa0IrQixVQUFyQyxHQUNJeEIsQ0FBQyxDQUFDbEIsU0FBRixDQUFZYyxPQUFaLENBQW9CNkIsT0FBcEIsQ0FBNEI1QyxDQUFDLENBQUN1QyxFQUE5QixJQUFvQyxDQUFwQyxJQUF5Q3BCLENBQUMsQ0FBQ2xCLFNBQUYsQ0FBWWMsT0FBWixDQUFvQkcsSUFBcEIsQ0FBeUJsQixDQUFDLENBQUN1QyxFQUEzQixDQUQ3QyxHQUVJcEIsQ0FBQyxDQUFDUyxRQUFGLENBQVdkLElBQVgsQ0FBZ0JkLENBQUMsQ0FBQ3VDLEVBQWxCLE1BQ0NaLENBQUMsSUFBSUEsQ0FBQyxDQUFDaUIsT0FBRixDQUFVNUMsQ0FBQyxDQUFDdUMsRUFBWixJQUFrQixDQUFDLENBQXhCLEdBQ0lwQixDQUFDLENBQUNTLFFBQUYsQ0FBV2QsSUFBWCxDQUFnQmQsQ0FBQyxDQUFDdUMsRUFBbEIsSUFBd0JaLENBQUMsQ0FBQzNCLENBQUMsQ0FBQ3VDLEVBQUgsQ0FEN0IsR0FFSXBCLENBQUMsQ0FBQ1MsUUFBRixDQUFXZCxJQUFYLENBQWdCZCxDQUFDLENBQUN1QyxFQUFsQixJQUF3QmhELENBQUMsQ0FBQ3NELE1BSC9CLENBRko7UUFNSCxDQVJEO01BU0gsQ0FyQkQsTUFxQk83QyxDQUFDLElBQUksTUFBTUEsQ0FBQyxDQUFDeUIsSUFBYixLQUFzQk4sQ0FBQyxDQUFDUyxRQUFGLENBQVdkLElBQVgsR0FBa0IsRUFBeEM7O01BQ1BLLENBQUMsQ0FBQ0gsUUFBRjtNQUNBSSxDQUFDLENBQUNELENBQUMsQ0FBQ2pCLFdBQUgsQ0FBRCxDQTNDNEMsQ0E0QzVDO01BQ0E7TUFDQTtNQUNBO01BQ0E7SUFDSDtFQUNKLENBbkREOztFQW9EQUYsQ0FBQyxDQUFDVyxTQUFGLENBQVltQyxVQUFaLEdBQXlCLFVBQVM5QyxDQUFULEVBQVk7SUFDakMsSUFBSyxLQUFLLENBQUwsS0FBV0EsQ0FBWCxLQUFpQkEsQ0FBQyxHQUFHLElBQXJCLEdBQTZCQSxDQUFDLEdBQUdSLFlBQVksV0FBWixDQUFxQnVELFFBQXJCLENBQThCL0MsQ0FBOUIsQ0FBdEMsRUFDSSxPQUNJLEtBQUtDLFNBQUwsQ0FBZWEsSUFBZixDQUFvQmQsQ0FBcEIsS0FBMEIsT0FBTyxLQUFLQyxTQUFMLENBQWVhLElBQWYsQ0FBb0JkLENBQXBCLENBQWpDLEVBQXlELENBQUMsQ0FBRCxJQUFNLEtBQUtDLFNBQUwsQ0FBZWMsT0FBZixDQUF1QjZCLE9BQXZCLENBQStCNUMsQ0FBL0IsQ0FBTixJQUEyQyxLQUFLQyxTQUFMLENBQWVjLE9BQWYsQ0FBdUJHLElBQXZCLENBQTRCbEIsQ0FBNUIsQ0FBcEcsRUFDQSxLQUFLZ0IsUUFBTCxFQURBLEVBQ2lCLENBQUMsQ0FGdEI7O0lBSUosS0FBSyxJQUFJRyxDQUFULElBQWMsS0FBS2xCLFNBQUwsQ0FBZWEsSUFBN0I7TUFDSSxJQUFJLEtBQUtiLFNBQUwsQ0FBZWEsSUFBZixDQUFvQkssQ0FBcEIsTUFBMkI1QixDQUFDLENBQUN5RCxLQUFqQyxFQUF3QztRQUNwQyxJQUFJNUIsQ0FBQyxHQUFHNUIsWUFBWSxXQUFaLENBQXFCdUQsUUFBckIsQ0FBOEI1QixDQUE5QixDQUFSOztRQUEwQyxDQUMxQyxDQUQwQyxJQUNyQyxLQUFLbEIsU0FBTCxDQUFlYyxPQUFmLENBQXVCNkIsT0FBdkIsQ0FBK0J4QixDQUEvQixDQURxQyxJQUNBLEtBQUtuQixTQUFMLENBQWVjLE9BQWYsQ0FBdUJHLElBQXZCLENBQTRCRSxDQUE1QixDQURBO1FBRTFDLEtBQUtuQixTQUFMLENBQWVhLElBQWYsQ0FBb0JLLENBQXBCLEtBQTBCLE9BQU8sS0FBS2xCLFNBQUwsQ0FBZWEsSUFBZixDQUFvQkssQ0FBcEIsQ0FBakM7TUFDSDtJQUxMOztJQU1BLEtBQUtILFFBQUw7O0lBQ0F0QixLQUFLLFdBQUwsQ0FBY3VELEdBQWQsQ0FBa0JDLElBQWxCLENBQXVCO01BQUVDLE1BQU0sRUFBRXpELEtBQUssV0FBTCxDQUFjMEQsT0FBeEI7TUFBaUMxQixJQUFJLEVBQUU7UUFBRTJCLElBQUksRUFBRTtNQUFSO0lBQXZDLENBQXZCOztJQUNBLE9BQU8sQ0FBQyxDQUFSO0VBQ0gsQ0FmRDs7RUFnQkFyRCxDQUFDLENBQUNXLFNBQUYsQ0FBWTJDLFFBQVosR0FBdUIsVUFBU3RELENBQVQsRUFBWTtJQUMvQixJQUFLLEtBQUssQ0FBTCxLQUFXQSxDQUFYLEtBQWlCQSxDQUFDLEdBQUcsSUFBckIsR0FBNEJBLENBQWpDLEVBQ0ksT0FDSSxLQUFLQyxTQUFMLENBQWVhLElBQWYsQ0FBb0JkLENBQXBCLEtBQTBCVCxDQUFDLENBQUN5RCxLQUE1QixLQUNFLEtBQUsvQyxTQUFMLENBQWVhLElBQWYsQ0FBb0JkLENBQXBCLElBQXlCVCxDQUFDLENBQUN5RCxLQUE1QixFQUFvQyxLQUFLTyxPQUFMLENBQWF2RCxDQUFiLENBQXBDLEVBQXFELEtBQUtnQixRQUFMLEVBQXJELEVBQXNFLENBQUMsQ0FEeEUsQ0FESjtJQUlKLElBQUlHLENBQUMsR0FBRyxDQUFDLENBQVQ7O0lBQ0EsS0FBSyxJQUFJQyxDQUFULElBQWMsS0FBS25CLFNBQUwsQ0FBZWEsSUFBN0I7TUFDSSxLQUFLYixTQUFMLENBQWVhLElBQWYsQ0FBb0JNLENBQXBCLE1BQTJCN0IsQ0FBQyxDQUFDeUQsS0FBN0IsS0FBdUM3QixDQUFDLEtBQUtBLENBQUMsR0FBRyxDQUFDLENBQVYsQ0FBRCxFQUFnQixLQUFLbEIsU0FBTCxDQUFlYSxJQUFmLENBQW9CTSxDQUFwQixJQUF5QjdCLENBQUMsQ0FBQ3lELEtBQTNDLEVBQW1ELEtBQUtPLE9BQUwsQ0FBYW5DLENBQWIsQ0FBMUY7SUFESjs7SUFFQUQsQ0FBQyxJQUFJLEtBQUtILFFBQUwsRUFBTDs7SUFDQXRCLEtBQUssV0FBTCxDQUFjdUQsR0FBZCxDQUFrQkMsSUFBbEIsQ0FBdUI7TUFBRUMsTUFBTSxFQUFFekQsS0FBSyxXQUFMLENBQWMwRCxPQUF4QjtNQUFpQzFCLElBQUksRUFBRTtRQUFFMkIsSUFBSSxFQUFFO01BQVI7SUFBdkMsQ0FBdkI7O0lBQ0EsT0FBT2xDLENBQVA7RUFDSCxDQVpEOztFQWFBbkIsQ0FBQyxDQUFDVyxTQUFGLENBQVk2QyxRQUFaLEdBQXVCLFVBQVN4RCxDQUFULEVBQVk7SUFDL0IsS0FBSyxDQUFMLEtBQVdBLENBQVgsS0FBaUJBLENBQUMsR0FBRyxJQUFyQjtJQUNBLE9BQU8sRUFBRSxDQUFDQSxDQUFELElBQ0wsQ0FBQyxLQUFLQyxTQUFMLENBQWVhLElBQWYsQ0FBb0JkLENBQXBCLENBREksSUFFSixLQUFLQyxTQUFMLENBQWVhLElBQWYsQ0FBb0JkLENBQXBCLEtBQTBCVCxDQUFDLENBQUN5RCxLQUE1QixLQUNJLEtBQUsvQyxTQUFMLENBQWVhLElBQWYsQ0FBb0JkLENBQXBCLEtBQTBCVCxDQUFDLENBQUNzRCxNQUE1QixLQUF3QyxLQUFLNUMsU0FBTCxDQUFlYSxJQUFmLENBQW9CZCxDQUFwQixJQUF5QlQsQ0FBQyxDQUFDa0UsSUFBNUIsRUFBbUMsS0FBS3pDLFFBQUwsRUFBbkMsRUFBb0QsQ0FBM0YsQ0FESixDQUZFLENBQVA7RUFLSCxDQVBEOztFQVFBaEIsQ0FBQyxDQUFDVyxTQUFGLENBQVk0QyxPQUFaLEdBQXNCLFVBQVN2RCxDQUFULEVBQVk7SUFDOUIsSUFBSW1CLENBQUMsR0FBRyxLQUFLdUMsVUFBYjs7SUFDQSxJQUFJMUQsQ0FBSixFQUFPO01BQ0gsSUFBSSxDQUFDbUIsQ0FBQyxDQUFDbkIsQ0FBRCxDQUFOLEVBQVc7O01BQ1gsS0FBSyxJQUFJb0IsQ0FBQyxHQUFHYyxJQUFJLENBQUNDLEtBQUwsQ0FBV2hCLENBQUMsQ0FBQ25CLENBQUQsQ0FBRCxDQUFLMkQsS0FBaEIsQ0FBUixFQUFnQ3BFLENBQUMsR0FBR0wsTUFBTSxDQUFDNEMsSUFBUCxDQUFZVixDQUFaLENBQXBDLEVBQW9ETyxDQUFDLEdBQUcsQ0FBN0QsRUFBZ0VBLENBQUMsR0FBR3BDLENBQUMsQ0FBQzhCLE1BQXRFLEVBQThFTSxDQUFDLEVBQS9FLEVBQW1GO1FBQy9FLElBQUlJLENBQUMsR0FBR3hDLENBQUMsQ0FBQ29DLENBQUQsQ0FBVDs7UUFDQSxJQUFJUCxDQUFDLENBQUN3QyxjQUFGLENBQWlCN0IsQ0FBakIsQ0FBSixFQUF5QjtVQUNyQixJQUFJRSxDQUFDLEdBQUdOLENBQUMsS0FBS3BDLENBQUMsQ0FBQzhCLE1BQUYsR0FBVyxDQUF6Qjs7VUFDQXZCLE9BQU8sV0FBUCxDQUFnQmMsR0FBaEIsQ0FBb0IyQyxPQUFwQixDQUE0QnhCLENBQTVCLEVBQStCWCxDQUFDLENBQUNXLENBQUQsQ0FBaEMsRUFBcUMsQ0FBQyxDQUF0QyxFQUF5Q0UsQ0FBekM7UUFDSDtNQUNKO0lBQ0o7RUFDSixDQVpEOztFQWFBLE9BQU9qQyxDQUFQO0FBQ0gsQ0E1SU8sRUFBUjs7QUE2SUFaLE9BQU8sV0FBUCxHQUFrQlcsQ0FBbEI7O0FBQ0EsQ0FBQyxVQUFTQyxDQUFULEVBQVk7RUFDUkEsQ0FBQyxDQUFFQSxDQUFDLENBQUM2RCxJQUFGLEdBQVMsQ0FBWCxDQUFELEdBQWtCLE1BQW5CLEVBQ0M3RCxDQUFDLENBQUVBLENBQUMsQ0FBQzZDLE1BQUYsR0FBVyxDQUFiLENBQUQsR0FBb0IsUUFEckIsRUFFQzdDLENBQUMsQ0FBRUEsQ0FBQyxDQUFDeUQsSUFBRixHQUFTLENBQVgsQ0FBRCxHQUFrQixNQUZuQixFQUdDekQsQ0FBQyxDQUFFQSxDQUFDLENBQUNnRCxLQUFGLEdBQVUsQ0FBWixDQUFELEdBQW1CLE9BSHBCO0FBSUgsQ0FMRCxFQUtJekQsQ0FBQyxHQUFHSCxPQUFPLENBQUNFLFNBQVIsS0FBc0JGLE9BQU8sQ0FBQ0UsU0FBUixHQUFvQixFQUExQyxDQUxSIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6ICEwIH0pO1xuZXhwb3J0cy5tYWlsU3RhdGUgPSB2b2lkIDA7XG52YXIgbjtcbnZhciBfbnVtYmVyVXRpbHMgPSByZXF1aXJlKFwiTnVtYmVyVXRpbHNcIik7XG52YXIgX2V2dHMgPSByZXF1aXJlKFwiZXZ0c1wiKTtcbnZhciBfcmVxdWVzdCA9IHJlcXVpcmUoXCJyZXF1ZXN0XCIpO1xudmFyIF90aW1lID0gcmVxdWlyZShcInRpbWVcIik7XG52YXIgX3BJbmZvID0gcmVxdWlyZShcInBJbmZvXCIpO1xudmFyIF9iYWdNZ3IgPSByZXF1aXJlKFwiYmFnTWdyXCIpO1xudmFyIHUgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gdCgpIHtcbiAgICAgICAgaWYgKCgodGhpcy5fbWFpbEluZm8gPSB7fSksICh0aGlzLl9zZXJ2ZXJNYWlsID0ge30pLCAodGhpcy5pc0dldHRpbmcgPSAhMSksICh0aGlzLmdldENiID0gW10pLCB0Ll9pbnMpKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibWFpbE1nciBjYW4gb25seSBiZSBvbmXvvIFcIik7XG4gICAgICAgIHQuX2lucyA9IHRoaXM7XG4gICAgICAgIHRoaXMuaW5pdE1haWwoKTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIFwiaW5zXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHQuX2lucyB8fCBuZXcgdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHQuX2lucztcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogITEsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogITBcbiAgICB9KTtcbiAgICB0LnByb3RvdHlwZS5pbml0TWFpbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLl9tYWlsSW5mbyA9IF9wSW5mby5kZWZhdWx0Lmlucy5NYWlsO1xuICAgICAgICB0aGlzLl9tYWlsSW5mby5tYWlsIHx8ICh0aGlzLl9tYWlsSW5mby5tYWlsID0ge30pO1xuICAgICAgICB0aGlzLl9tYWlsSW5mby5vdXRNYWlsIHx8ICh0aGlzLl9tYWlsSW5mby5vdXRNYWlsID0gW10pO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuc2F2ZU1haWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgX3BJbmZvLmRlZmF1bHQuaW5zLk1haWwgPSB0aGlzLl9tYWlsSW5mbztcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LnByb3RvdHlwZSwgXCJtYWlsSW5mb1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFpbEluZm87XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6ICExLFxuICAgICAgICBjb25maWd1cmFibGU6ICEwXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQucHJvdG90eXBlLCBcInNlcnZlck1haWxcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NlcnZlck1haWw7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6ICExLFxuICAgICAgICBjb25maWd1cmFibGU6ICEwXG4gICAgfSk7XG4gICAgdC5wcm90b3R5cGUuZ2V0TWFpbCA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgaWYgKCh0ICYmIHRoaXMuZ2V0Q2IucHVzaCh0KSwgIXRoaXMuaXNHZXR0aW5nKSkge1xuICAgICAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG8gPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgZS5nZXRDYi5sZW5ndGggPiAwICYmXG4gICAgICAgICAgICAgICAgICAgIGUuZ2V0Q2IuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZSAmJiBlKHQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBlLmdldENiID0gW107XG4gICAgICAgICAgICAgICAgZS5pc0dldHRpbmcgPSAhMTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBlLmlzR2V0dGluZyA9ICEwO1xuICAgICAgICAgICAgdmFyIHQgPSB7XG4gICAgICAgICAgICAgICAgXCJzdGF0dXNcIjogMCxcbiAgICAgICAgICAgICAgICBcIm1zZ1wiOiBcIuaXoOmCruS7tuS/oeaBr1wiLFxuICAgICAgICAgICAgICAgIFwiY29kZVwiOiAwLFxuICAgICAgICAgICAgICAgIFwic2VydmVyX3RpbWVcIjogRGF0ZS5ub3coKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIF9yZXF1ZXN0LmRlZmF1bHQuaW5zXG4gICAgICAgICAgICAvLyAgICAgLmdldE1haWxEYXRhKHZvaWQgMCwgdGhpcy5fbWFpbEluZm8ub3V0TWFpbClcbiAgICAgICAgICAgIC8vICAgICAudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgaWYgKHQgJiYgdC5jb2RlICYmIHQuZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgICAgIGlmIChlLm1haWxJbmZvLm1haWwgaW5zdGFuY2VvZiBBcnJheSkoaSA9IGUubWFpbEluZm8ubWFpbCksIChlLm1haWxJbmZvLm1haWwgPSB7fSk7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoT2JqZWN0LmtleXMoZS5fbWFpbEluZm8ubWFpbCkubGVuZ3RoICE9PSB0LmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByID0gbmV3IFNldCgpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZS5fbWFpbEluZm8ubWFpbCkpO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjIGluIChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHQuZGF0YSkpLmZvckVhY2goZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByLmFkZCh0LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHIuaGFzKE51bWJlcihjKSkgfHwgZGVsZXRlIGUuX21haWxJbmZvLm1haWxbY107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHQuZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5fc2VydmVyTWFpbFt0LmlkXSA9IHQ7XG4gICAgICAgICAgICAgICAgICAgIHQuZW5kX3RpbWUgPCAxZTMgKiBfdGltZS5kZWZhdWx0Lmlucy5zZXJ2ZXJUaW1lID9cbiAgICAgICAgICAgICAgICAgICAgICAgIGUuX21haWxJbmZvLm91dE1haWwuaW5kZXhPZih0LmlkKSA8IDAgJiYgZS5fbWFpbEluZm8ub3V0TWFpbC5wdXNoKHQuaWQpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGUubWFpbEluZm8ubWFpbFt0LmlkXSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgKGkgJiYgaS5pbmRleE9mKHQuaWQpID4gLTEgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlLm1haWxJbmZvLm1haWxbdC5pZF0gPSBpW3QuaWRdKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGUubWFpbEluZm8ubWFpbFt0LmlkXSA9IG4ubm9SZWFkKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgdCAmJiAwID09PSB0LmNvZGUgJiYgKGUubWFpbEluZm8ubWFpbCA9IHt9KTtcbiAgICAgICAgICAgIGUuc2F2ZU1haWwoKTtcbiAgICAgICAgICAgIG8oZS5fc2VydmVyTWFpbCk7XG4gICAgICAgICAgICAvLyB9KVxuICAgICAgICAgICAgLy8gLmNhdGNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAvLyAgICAgY29uc29sZS5lcnJvcihcImdldE1haWxEYXRhRXJyXCIsIHQpO1xuICAgICAgICAgICAgLy8gICAgIG8oe2Vyck1zZzogXCJlcnJvclwifSk7XG4gICAgICAgICAgICAvLyB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgdC5wcm90b3R5cGUuZGVsZXRlTWFpbCA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgaWYgKCh2b2lkIDAgPT09IHQgJiYgKHQgPSBudWxsKSwgKHQgPSBfbnVtYmVyVXRpbHMuZGVmYXVsdC5wYXJzZU51bSh0KSkpKVxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICB0aGlzLl9tYWlsSW5mby5tYWlsW3RdICYmIGRlbGV0ZSB0aGlzLl9tYWlsSW5mby5tYWlsW3RdLCAtMSA9PSB0aGlzLl9tYWlsSW5mby5vdXRNYWlsLmluZGV4T2YodCkgJiYgdGhpcy5fbWFpbEluZm8ub3V0TWFpbC5wdXNoKHQpLFxuICAgICAgICAgICAgICAgIHRoaXMuc2F2ZU1haWwoKSwgITBcbiAgICAgICAgICAgICk7XG4gICAgICAgIGZvciAodmFyIGUgaW4gdGhpcy5fbWFpbEluZm8ubWFpbClcbiAgICAgICAgICAgIGlmICh0aGlzLl9tYWlsSW5mby5tYWlsW2VdID09PSBuLmF3YXJkKSB7XG4gICAgICAgICAgICAgICAgdmFyIG8gPSBfbnVtYmVyVXRpbHMuZGVmYXVsdC5wYXJzZU51bShlKTsgLVxuICAgICAgICAgICAgICAgIDEgPT0gdGhpcy5fbWFpbEluZm8ub3V0TWFpbC5pbmRleE9mKG8pICYmIHRoaXMuX21haWxJbmZvLm91dE1haWwucHVzaChvKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYWlsSW5mby5tYWlsW2VdICYmIGRlbGV0ZSB0aGlzLl9tYWlsSW5mby5tYWlsW2VdO1xuICAgICAgICAgICAgfVxuICAgICAgICB0aGlzLnNhdmVNYWlsKCk7XG4gICAgICAgIF9ldnRzLmRlZmF1bHQub3BFLmVtaXQoeyBhY3Rpb246IF9ldnRzLmRlZmF1bHQuVVBETUFJTCwgZGF0YTogeyB0eXBlOiBcImtleURlbGV0ZVwiIH0gfSk7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9O1xuICAgIHQucHJvdG90eXBlLmdldEF3YXJkID0gZnVuY3Rpb24odCkge1xuICAgICAgICBpZiAoKHZvaWQgMCA9PT0gdCAmJiAodCA9IG51bGwpLCB0KSlcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgdGhpcy5fbWFpbEluZm8ubWFpbFt0XSAhPSBuLmF3YXJkICYmXG4gICAgICAgICAgICAgICAgKCh0aGlzLl9tYWlsSW5mby5tYWlsW3RdID0gbi5hd2FyZCksIHRoaXMuYWRkSXRlbSh0KSwgdGhpcy5zYXZlTWFpbCgpLCAhMClcbiAgICAgICAgICAgICk7XG4gICAgICAgIHZhciBlID0gITE7XG4gICAgICAgIGZvciAodmFyIG8gaW4gdGhpcy5fbWFpbEluZm8ubWFpbClcbiAgICAgICAgICAgIHRoaXMuX21haWxJbmZvLm1haWxbb10gIT09IG4uYXdhcmQgJiYgKGUgfHwgKGUgPSAhMCksICh0aGlzLl9tYWlsSW5mby5tYWlsW29dID0gbi5hd2FyZCksIHRoaXMuYWRkSXRlbShvKSk7XG4gICAgICAgIGUgJiYgdGhpcy5zYXZlTWFpbCgpO1xuICAgICAgICBfZXZ0cy5kZWZhdWx0Lm9wRS5lbWl0KHsgYWN0aW9uOiBfZXZ0cy5kZWZhdWx0LlVQRE1BSUwsIGRhdGE6IHsgdHlwZTogXCJrZXlBd2FyZFwiIH0gfSk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUucmVhZE1haWwgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIHZvaWQgMCA9PT0gdCAmJiAodCA9IG51bGwpO1xuICAgICAgICByZXR1cm4gISghdCB8fFxuICAgICAgICAgICAgIXRoaXMuX21haWxJbmZvLm1haWxbdF0gfHxcbiAgICAgICAgICAgICh0aGlzLl9tYWlsSW5mby5tYWlsW3RdICE9IG4uYXdhcmQgJiZcbiAgICAgICAgICAgICAgICAodGhpcy5fbWFpbEluZm8ubWFpbFt0XSAhPSBuLm5vUmVhZCB8fCAoKHRoaXMuX21haWxJbmZvLm1haWxbdF0gPSBuLnJlYWQpLCB0aGlzLnNhdmVNYWlsKCksIDApKSlcbiAgICAgICAgKTtcbiAgICB9O1xuICAgIHQucHJvdG90eXBlLmFkZEl0ZW0gPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIHZhciBlID0gdGhpcy5zZXJ2ZXJNYWlsO1xuICAgICAgICBpZiAodCkge1xuICAgICAgICAgICAgaWYgKCFlW3RdKSByZXR1cm47XG4gICAgICAgICAgICBmb3IgKHZhciBvID0gSlNPTi5wYXJzZShlW3RdLnByb3BzKSwgbiA9IE9iamVjdC5rZXlzKG8pLCBpID0gMDsgaSA8IG4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IG5baV07XG4gICAgICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkocikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBpID09PSBuLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgIF9iYWdNZ3IuZGVmYXVsdC5pbnMuYWRkSXRlbShyLCBvW3JdLCAhMCwgYSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gdDtcbn0pKCk7XG5leHBvcnRzLmRlZmF1bHQgPSB1O1xuKGZ1bmN0aW9uKHQpIHtcbiAgICAodFsodC5ub25lID0gMCldID0gXCJub25lXCIpLFxuICAgICh0Wyh0Lm5vUmVhZCA9IDEpXSA9IFwibm9SZWFkXCIpLFxuICAgICh0Wyh0LnJlYWQgPSAyKV0gPSBcInJlYWRcIiksXG4gICAgKHRbKHQuYXdhcmQgPSAzKV0gPSBcImF3YXJkXCIpO1xufSkoKG4gPSBleHBvcnRzLm1haWxTdGF0ZSB8fCAoZXhwb3J0cy5tYWlsU3RhdGUgPSB7fSkpKTsiXX0=