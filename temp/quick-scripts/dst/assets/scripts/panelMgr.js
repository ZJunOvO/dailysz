
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/panelMgr.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '18935KmlCBN86TB4yHqLYf5', 'panelMgr');
// scripts/panelMgr.js

"use strict";

var n;
Object.defineProperty(exports, "__esModule", {
  value: !0
});
exports.PanelShowResult = void 0;
var c;

var _evts = require("evts");

var _res = require("res");

var _baseUI = require("baseUI");

var d = cc._decorator;
var h = d.ccclass;
var f = d.property;

(function (t) {
  t[t.DONE = 0] = "DONE";
  t[t.FAILED = 1] = "FAILED";
  t[t.WAITING = 2] = "WAITING";
})(c = exports.PanelShowResult || (exports.PanelShowResult = {}));

var g = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.container = null;
    e.mask = null;
    return e;
  }

  var o;

  __extends(e, t);

  o = e;

  e.prototype.onLoad = function () {
    o.ins = this;
    this.panelQueue = [];
    this.panelList = [];
    this.mask.active = !1;
    this.mask.opacity = 0;
  };

  e.prototype.open = function (t, e, o) {
    void 0 === o && (o = {});
    return __awaiter(this, void 0, void 0, function () {
      var n;
      var i;
      var r;
      var a;
      var d;
      return __generator(this, function (s) {
        switch (s.label) {
          case 0:
            return o.inQueue && this.panelList.length > 0 ? (this.panelQueue.push({
              prefab: t,
              data: e,
              opt: o
            }), [2, {
              panelResult: c.WAITING
            }]) : [3, 1];

          case 1:
            return [4, new Promise(function (e, o) {
              _res["default"].ins.getBundleByString("prefab").then(function (n) {
                n.load(t, cc.Prefab, function (t, n) {
                  t ? o(t) : e(n);
                });
              });
            })];

          case 2:
            return n = s.sent(), d = this, cc.isValid(n) ? (i = cc.instantiate(n), (r = i.getComponent(_baseUI["default"])) ? ((a = i.getComponent(cc.Widget) || i.addComponent(cc.Widget)).verticalCenter = 0, a.horizontalCenter = 0, a.isAlignVerticalCenter = !0, a.isAlignHorizontalCenter = !0, this.currentPanel = i, this.panelList.push({
              prefab: t,
              data: e,
              opt: o,
              node: i
            }), i.setParent(this.container), r.show(e), this.ensureMask(), _evts["default"].laE.emit({
              comp: r
            }), [2, new Promise(function (t) {
              r.setCb(function (e, o) {
                d.currentPanel = null;
                e.destroy();

                for (var n = 0; n < d.panelList.length; n++) {
                  if (e == d.panelList[n].node) {
                    d.panelList.splice(n, 1);
                    break;
                  }
                }

                t({
                  panelResult: c.DONE,
                  values: o
                });
                d.onNext();
                d.scheduleOnce(function () {
                  d.ensureMask();

                  _evts["default"].laE.emit({
                    comp: null
                  });
                }, 0);
              });
            })]) : (console.warn("failed to load component of prefab", t), [2, {
              panelResult: c.FAILED
            }])) : (console.warn("invalid prefab", t), [2, {
              panelResult: c.FAILED
            }]);

          case 3:
            return [2];
        }
      });
    });
  };

  e.prototype.getPanelByPath = function (t) {
    for (var e = this.panelList, o = e.length - 1; o >= 0; --o) {
      if (e[o].prefab === t && null != e[o].node) {
        var n = e[o].node.getComponent(_baseUI["default"]);
        if (null != n) return n;
      }
    }

    return null;
  };

  e.prototype.close = function (t) {
    for (var e = this.panelList, o = e.length - 1; o >= 0; --o) {
      if (e[o].prefab === t) {
        var n = e[o].node;

        if (null != n) {
          var i = n.getComponent(_baseUI["default"]);
          null != i && i.hide();
        }

        break;
      }
    }
  };

  e.prototype.closeAllPanel = function () {
    this.panelQueue = [];

    for (var t = this.panelList, e = t.length - 1; e >= 0; --e) {
      if (null != t[e].node) {
        var o = t[e].node.getComponent(_baseUI["default"]);
        null != o && o.hide();
      }
    }
  };

  e.prototype.onNext = function () {
    if (!(this.panelList.length > 0) && null == this.currentPanel && 0 != this.panelQueue.length) {
      var t = this.panelQueue.shift();
      this.open(t.prefab, t.data, t.opt);
    }
  };

  e.prototype.ensureMask = function () {
    var t = this.panelList;
    var e = t.length;
    var o = t[e - 1];
    var n = this.container.childrenCount;
    var i = this.mask;
    if (e <= 0) i.opacity = 0, i.isValid && (i.active = !1), _evts["default"].opE.emit({
      action: _evts["default"].CHECK_WX_BTNS
    });else {
      var r = o.node;
      i.active = !0;
      cc.tween(i).to(0.2, {
        opacity: 200
      }).start();
      r.active = !0;
      i.setSiblingIndex(n);
      r.setSiblingIndex(n);

      _evts["default"].opE.emit({
        action: _evts["default"].HIDE_WX_BTNS
      });
    }
  };

  e.prototype.onMaskClick = function () {
    var t = this.panelList;
    var e = t.length;

    if (!(e <= 0)) {
      var o = t[e - 1];
      var n = o.opt;
      var i = o.node;
      !n.MaskNoHide && i.getComponent(_baseUI["default"]).hide();
    }
  };

  e.prototype.hasPop = function () {
    return this.panelList.length > 0;
  };

  __decorate([f(cc.Node)], e.prototype, "container", void 0);

  __decorate([f(cc.Node)], e.prototype, "mask", void 0);

  return o = __decorate([h], e);
}(cc.Component);

exports["default"] = g;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xccGFuZWxNZ3IuanMiXSwibmFtZXMiOlsibiIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiUGFuZWxTaG93UmVzdWx0IiwiYyIsIl9ldnRzIiwicmVxdWlyZSIsIl9yZXMiLCJfYmFzZVVJIiwiZCIsImNjIiwiX2RlY29yYXRvciIsImgiLCJjY2NsYXNzIiwiZiIsInByb3BlcnR5IiwidCIsIkRPTkUiLCJGQUlMRUQiLCJXQUlUSU5HIiwiZyIsImUiLCJhcHBseSIsImFyZ3VtZW50cyIsImNvbnRhaW5lciIsIm1hc2siLCJvIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwib25Mb2FkIiwiaW5zIiwicGFuZWxRdWV1ZSIsInBhbmVsTGlzdCIsImFjdGl2ZSIsIm9wYWNpdHkiLCJvcGVuIiwiX19hd2FpdGVyIiwiaSIsInIiLCJhIiwiX19nZW5lcmF0b3IiLCJzIiwibGFiZWwiLCJpblF1ZXVlIiwibGVuZ3RoIiwicHVzaCIsInByZWZhYiIsImRhdGEiLCJvcHQiLCJwYW5lbFJlc3VsdCIsIlByb21pc2UiLCJnZXRCdW5kbGVCeVN0cmluZyIsInRoZW4iLCJsb2FkIiwiUHJlZmFiIiwic2VudCIsImlzVmFsaWQiLCJpbnN0YW50aWF0ZSIsImdldENvbXBvbmVudCIsIldpZGdldCIsImFkZENvbXBvbmVudCIsInZlcnRpY2FsQ2VudGVyIiwiaG9yaXpvbnRhbENlbnRlciIsImlzQWxpZ25WZXJ0aWNhbENlbnRlciIsImlzQWxpZ25Ib3Jpem9udGFsQ2VudGVyIiwiY3VycmVudFBhbmVsIiwibm9kZSIsInNldFBhcmVudCIsInNob3ciLCJlbnN1cmVNYXNrIiwibGFFIiwiZW1pdCIsImNvbXAiLCJzZXRDYiIsImRlc3Ryb3kiLCJzcGxpY2UiLCJ2YWx1ZXMiLCJvbk5leHQiLCJzY2hlZHVsZU9uY2UiLCJjb25zb2xlIiwid2FybiIsImdldFBhbmVsQnlQYXRoIiwiY2xvc2UiLCJoaWRlIiwiY2xvc2VBbGxQYW5lbCIsInNoaWZ0IiwiY2hpbGRyZW5Db3VudCIsIm9wRSIsImFjdGlvbiIsIkNIRUNLX1dYX0JUTlMiLCJ0d2VlbiIsInRvIiwic3RhcnQiLCJzZXRTaWJsaW5nSW5kZXgiLCJISURFX1dYX0JUTlMiLCJvbk1hc2tDbGljayIsIk1hc2tOb0hpZGUiLCJoYXNQb3AiLCJfX2RlY29yYXRlIiwiTm9kZSIsIkNvbXBvbmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxDQUFKO0FBQ0FDLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7RUFBQ0MsS0FBSyxFQUFFLENBQUM7QUFBVCxDQUE3QztBQUNBRCxPQUFPLENBQUNFLGVBQVIsR0FBMEIsS0FBSyxDQUEvQjtBQUNBLElBQUlDLENBQUo7O0FBQ0EsSUFBSUMsS0FBSyxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUFuQjs7QUFDQSxJQUFJQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxLQUFELENBQWxCOztBQUNBLElBQUlFLE9BQU8sR0FBR0YsT0FBTyxDQUFDLFFBQUQsQ0FBckI7O0FBQ0EsSUFBSUcsQ0FBQyxHQUFHQyxFQUFFLENBQUNDLFVBQVg7QUFDQSxJQUFJQyxDQUFDLEdBQUdILENBQUMsQ0FBQ0ksT0FBVjtBQUNBLElBQUlDLENBQUMsR0FBR0wsQ0FBQyxDQUFDTSxRQUFWOztBQUNBLENBQUMsVUFBVUMsQ0FBVixFQUFhO0VBQ1ZBLENBQUMsQ0FBRUEsQ0FBQyxDQUFDQyxJQUFGLEdBQVMsQ0FBWCxDQUFELEdBQWtCLE1BQWxCO0VBQ0FELENBQUMsQ0FBRUEsQ0FBQyxDQUFDRSxNQUFGLEdBQVcsQ0FBYixDQUFELEdBQW9CLFFBQXBCO0VBQ0FGLENBQUMsQ0FBRUEsQ0FBQyxDQUFDRyxPQUFGLEdBQVksQ0FBZCxDQUFELEdBQXFCLFNBQXJCO0FBQ0gsQ0FKRCxFQUlJZixDQUFDLEdBQUdILE9BQU8sQ0FBQ0UsZUFBUixLQUE0QkYsT0FBTyxDQUFDRSxlQUFSLEdBQTBC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Q0FBQyxHQUFHVixDQUFDLENBQUNLLENBQUMsR0FBRyxDQUFMLENBQVQ7TUFDQSxJQUFJdkIsQ0FBQyxHQUFHNEIsQ0FBQyxDQUFDc0IsR0FBVjtNQUNBLElBQUlYLENBQUMsR0FBR1gsQ0FBQyxDQUFDd0MsSUFBVjtNQUNBLENBQUNwRSxDQUFDLENBQUNrRyxVQUFILElBQWlCM0QsQ0FBQyxDQUFDcUIsWUFBRixDQUFlbEQsT0FBTyxXQUF0QixFQUFnQzJFLElBQWhDLEVBQWpCO0lBQ0g7RUFDSixDQVREOztFQVVBOUQsQ0FBQyxDQUFDTyxTQUFGLENBQVlxRSxNQUFaLEdBQXFCLFlBQVk7SUFDN0IsT0FBTyxLQUFLakUsU0FBTCxDQUFlWSxNQUFmLEdBQXdCLENBQS9CO0VBQ0gsQ0FGRDs7RUFHQXNELFVBQVUsQ0FBQyxDQUFDcEYsQ0FBQyxDQUFDSixFQUFFLENBQUN5RixJQUFKLENBQUYsQ0FBRCxFQUFlOUUsQ0FBQyxDQUFDTyxTQUFqQixFQUE0QixXQUE1QixFQUF5QyxLQUFLLENBQTlDLENBQVY7O0VBQ0FzRSxVQUFVLENBQUMsQ0FBQ3BGLENBQUMsQ0FBQ0osRUFBRSxDQUFDeUYsSUFBSixDQUFGLENBQUQsRUFBZTlFLENBQUMsQ0FBQ08sU0FBakIsRUFBNEIsTUFBNUIsRUFBb0MsS0FBSyxDQUF6QyxDQUFWOztFQUNBLE9BQVFGLENBQUMsR0FBR3dFLFVBQVUsQ0FBQyxDQUFDdEYsQ0FBRCxDQUFELEVBQU1TLENBQU4sQ0FBdEI7QUFDSCxDQS9KTyxDQStKTFgsRUFBRSxDQUFDMEYsU0EvSkUsQ0FBUjs7QUFnS0FuRyxPQUFPLFdBQVAsR0FBa0JtQixDQUFsQiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIG47XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHt2YWx1ZTogITB9KTtcbmV4cG9ydHMuUGFuZWxTaG93UmVzdWx0ID0gdm9pZCAwO1xudmFyIGM7XG52YXIgX2V2dHMgPSByZXF1aXJlKFwiZXZ0c1wiKTtcbnZhciBfcmVzID0gcmVxdWlyZShcInJlc1wiKTtcbnZhciBfYmFzZVVJID0gcmVxdWlyZShcImJhc2VVSVwiKTtcbnZhciBkID0gY2MuX2RlY29yYXRvcjtcbnZhciBoID0gZC5jY2NsYXNzO1xudmFyIGYgPSBkLnByb3BlcnR5O1xuKGZ1bmN0aW9uICh0KSB7XG4gICAgdFsodC5ET05FID0gMCldID0gXCJET05FXCI7XG4gICAgdFsodC5GQUlMRUQgPSAxKV0gPSBcIkZBSUxFRFwiO1xuICAgIHRbKHQuV0FJVElORyA9IDIpXSA9IFwiV0FJVElOR1wiO1xufSkoKGMgPSBleHBvcnRzLlBhbmVsU2hvd1Jlc3VsdCB8fCAoZXhwb3J0cy5QYW5lbFNob3dSZXN1bHQgPSB7fSkpKTtcbnZhciBnID0gKGZ1bmN0aW9uICh0KSB7XG4gICAgZnVuY3Rpb24gZSgpIHtcbiAgICAgICAgdmFyIGUgPSAobnVsbCAhPT0gdCAmJiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHx8IHRoaXM7XG4gICAgICAgIGUuY29udGFpbmVyID0gbnVsbDtcbiAgICAgICAgZS5tYXNrID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIHZhciBvO1xuICAgIF9fZXh0ZW5kcyhlLCB0KTtcbiAgICBvID0gZTtcbiAgICBlLnByb3RvdHlwZS5vbkxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG8uaW5zID0gdGhpcztcbiAgICAgICAgdGhpcy5wYW5lbFF1ZXVlID0gW107XG4gICAgICAgIHRoaXMucGFuZWxMaXN0ID0gW107XG4gICAgICAgIHRoaXMubWFzay5hY3RpdmUgPSAhMTtcbiAgICAgICAgdGhpcy5tYXNrLm9wYWNpdHkgPSAwO1xuICAgIH07XG4gICAgZS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uICh0LCBlLCBvKSB7XG4gICAgICAgIHZvaWQgMCA9PT0gbyAmJiAobyA9IHt9KTtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG47XG4gICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgIHZhciByO1xuICAgICAgICAgICAgdmFyIGE7XG4gICAgICAgICAgICB2YXIgZDtcbiAgICAgICAgICAgIHJldHVybiBfX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAocykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAocy5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gby5pblF1ZXVlICYmIHRoaXMucGFuZWxMaXN0Lmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICh0aGlzLnBhbmVsUXVldWUucHVzaCh7cHJlZmFiOiB0LCBkYXRhOiBlLCBvcHQ6IG99KSwgWzIsIHtwYW5lbFJlc3VsdDogYy5XQUlUSU5HfV0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBbMywgMV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgNCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAoZSwgbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVzLmRlZmF1bHQuaW5zLmdldEJ1bmRsZUJ5U3RyaW5nKFwicHJlZmFiXCIpLnRoZW4oZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ubG9hZCh0LCBjYy5QcmVmYWIsIGZ1bmN0aW9uICh0LCBuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA/IG8odCkgOiBlKG4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChuID0gcy5zZW50KCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChkID0gdGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2MuaXNWYWxpZChuKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICgoaSA9IGNjLmluc3RhbnRpYXRlKG4pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAociA9IGkuZ2V0Q29tcG9uZW50KF9iYXNlVUkuZGVmYXVsdCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gKCgoYSA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuZ2V0Q29tcG9uZW50KGNjLldpZGdldCkgfHwgaS5hZGRDb21wb25lbnQoY2MuV2lkZ2V0KSkudmVydGljYWxDZW50ZXIgPSAwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYS5ob3Jpem9udGFsQ2VudGVyID0gMCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGEuaXNBbGlnblZlcnRpY2FsQ2VudGVyID0gITApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhLmlzQWxpZ25Ib3Jpem9udGFsQ2VudGVyID0gITApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmN1cnJlbnRQYW5lbCA9IGkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFuZWxMaXN0LnB1c2goe3ByZWZhYjogdCwgZGF0YTogZSwgb3B0OiBvLCBub2RlOiBpfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5zZXRQYXJlbnQodGhpcy5jb250YWluZXIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHIuc2hvdyhlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVuc3VyZU1hc2soKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZXZ0cy5kZWZhdWx0LmxhRS5lbWl0KHtjb21wOiByfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgci5zZXRDYihmdW5jdGlvbiAoZSwgbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQuY3VycmVudFBhbmVsID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IGQucGFuZWxMaXN0Lmxlbmd0aDsgbisrKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSA9PSBkLnBhbmVsTGlzdFtuXS5ub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLnBhbmVsTGlzdC5zcGxpY2UobiwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQoe3BhbmVsUmVzdWx0OiBjLkRPTkUsIHZhbHVlczogb30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQub25OZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5zY2hlZHVsZU9uY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkLmVuc3VyZU1hc2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2V2dHMuZGVmYXVsdC5sYUUuZW1pdCh7Y29tcDogbnVsbH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAoY29uc29sZS53YXJuKFwiZmFpbGVkIHRvIGxvYWQgY29tcG9uZW50IG9mIHByZWZhYlwiLCB0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMiwge3BhbmVsUmVzdWx0OiBjLkZBSUxFRH1dKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAoY29uc29sZS53YXJuKFwiaW52YWxpZCBwcmVmYWJcIiwgdCksIFsyLCB7cGFuZWxSZXN1bHQ6IGMuRkFJTEVEfV0pXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzJdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLmdldFBhbmVsQnlQYXRoID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgZm9yICh2YXIgZSA9IHRoaXMucGFuZWxMaXN0LCBvID0gZS5sZW5ndGggLSAxOyBvID49IDA7IC0tbylcbiAgICAgICAgICAgIGlmIChlW29dLnByZWZhYiA9PT0gdCAmJiBudWxsICE9IGVbb10ubm9kZSkge1xuICAgICAgICAgICAgICAgIHZhciBuID0gZVtvXS5ub2RlLmdldENvbXBvbmVudChfYmFzZVVJLmRlZmF1bHQpO1xuICAgICAgICAgICAgICAgIGlmIChudWxsICE9IG4pIHJldHVybiBuO1xuICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgZm9yICh2YXIgZSA9IHRoaXMucGFuZWxMaXN0LCBvID0gZS5sZW5ndGggLSAxOyBvID49IDA7IC0tbylcbiAgICAgICAgICAgIGlmIChlW29dLnByZWZhYiA9PT0gdCkge1xuICAgICAgICAgICAgICAgIHZhciBuID0gZVtvXS5ub2RlO1xuICAgICAgICAgICAgICAgIGlmIChudWxsICE9IG4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBuLmdldENvbXBvbmVudChfYmFzZVVJLmRlZmF1bHQpO1xuICAgICAgICAgICAgICAgICAgICBudWxsICE9IGkgJiYgaS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgIH07XG4gICAgZS5wcm90b3R5cGUuY2xvc2VBbGxQYW5lbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wYW5lbFF1ZXVlID0gW107XG4gICAgICAgIGZvciAodmFyIHQgPSB0aGlzLnBhbmVsTGlzdCwgZSA9IHQubGVuZ3RoIC0gMTsgZSA+PSAwOyAtLWUpXG4gICAgICAgICAgICBpZiAobnVsbCAhPSB0W2VdLm5vZGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbyA9IHRbZV0ubm9kZS5nZXRDb21wb25lbnQoX2Jhc2VVSS5kZWZhdWx0KTtcbiAgICAgICAgICAgICAgICBudWxsICE9IG8gJiYgby5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5vbk5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghKHRoaXMucGFuZWxMaXN0Lmxlbmd0aCA+IDApICYmIG51bGwgPT0gdGhpcy5jdXJyZW50UGFuZWwgJiYgMCAhPSB0aGlzLnBhbmVsUXVldWUubGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IHRoaXMucGFuZWxRdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgdGhpcy5vcGVuKHQucHJlZmFiLCB0LmRhdGEsIHQub3B0KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZS5wcm90b3R5cGUuZW5zdXJlTWFzayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLnBhbmVsTGlzdDtcbiAgICAgICAgdmFyIGUgPSB0Lmxlbmd0aDtcbiAgICAgICAgdmFyIG8gPSB0W2UgLSAxXTtcbiAgICAgICAgdmFyIG4gPSB0aGlzLmNvbnRhaW5lci5jaGlsZHJlbkNvdW50O1xuICAgICAgICB2YXIgaSA9IHRoaXMubWFzaztcbiAgICAgICAgaWYgKGUgPD0gMClcbiAgICAgICAgICAgIChpLm9wYWNpdHkgPSAwKSxcbiAgICAgICAgICAgICAgICBpLmlzVmFsaWQgJiYgKGkuYWN0aXZlID0gITEpLFxuICAgICAgICAgICAgICAgIF9ldnRzLmRlZmF1bHQub3BFLmVtaXQoe2FjdGlvbjogX2V2dHMuZGVmYXVsdC5DSEVDS19XWF9CVE5TfSk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIHIgPSBvLm5vZGU7XG4gICAgICAgICAgICBpLmFjdGl2ZSA9ICEwO1xuICAgICAgICAgICAgY2MudHdlZW4oaSkudG8oMC4yLCB7b3BhY2l0eTogMjAwfSkuc3RhcnQoKTtcbiAgICAgICAgICAgIHIuYWN0aXZlID0gITA7XG4gICAgICAgICAgICBpLnNldFNpYmxpbmdJbmRleChuKTtcbiAgICAgICAgICAgIHIuc2V0U2libGluZ0luZGV4KG4pO1xuICAgICAgICAgICAgX2V2dHMuZGVmYXVsdC5vcEUuZW1pdCh7YWN0aW9uOiBfZXZ0cy5kZWZhdWx0LkhJREVfV1hfQlROU30pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5vbk1hc2tDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLnBhbmVsTGlzdDtcbiAgICAgICAgdmFyIGUgPSB0Lmxlbmd0aDtcbiAgICAgICAgaWYgKCEoZSA8PSAwKSkge1xuICAgICAgICAgICAgdmFyIG8gPSB0W2UgLSAxXTtcbiAgICAgICAgICAgIHZhciBuID0gby5vcHQ7XG4gICAgICAgICAgICB2YXIgaSA9IG8ubm9kZTtcbiAgICAgICAgICAgICFuLk1hc2tOb0hpZGUgJiYgaS5nZXRDb21wb25lbnQoX2Jhc2VVSS5kZWZhdWx0KS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGUucHJvdG90eXBlLmhhc1BvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFuZWxMaXN0Lmxlbmd0aCA+IDA7XG4gICAgfTtcbiAgICBfX2RlY29yYXRlKFtmKGNjLk5vZGUpXSwgZS5wcm90b3R5cGUsIFwiY29udGFpbmVyXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbZihjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcIm1hc2tcIiwgdm9pZCAwKTtcbiAgICByZXR1cm4gKG8gPSBfX2RlY29yYXRlKFtoXSwgZSkpO1xufSkoY2MuQ29tcG9uZW50KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGc7XG4iXX0=