
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/shopItem.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '13e5clDaOZHmrEnbKIG3sTB', 'shopItem');
// scripts/shopItem.js

"use strict";

var n;
Object.defineProperty(exports, "__esModule", {
  value: !0
});

var _idx = require("idx");

var _res = require("res");

var _bagMgr = require("bagMgr");

var _panelMgr = require("panelMgr");

var _tipMgr = require("tipMgr");

var _pInfo = require("pInfo");

var _item = require("item");

var h = cc._decorator;
var f = h.ccclass;
var g = h.property;

var y = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.buyBtnNode = null;
    e.finNode = null;
    e.btnPrice = null;
    e.doubleNode = null;
    e.itemComp = null;
    e.shopData = null;
    e.aniDatas = [];
    e.isDouble = !1;
    return e;
  }

  __extends(e, t);

  e.prototype.onLoad = function () {};

  e.prototype.start = function () {};

  e.prototype.initItem = function (t, e) {
    var o = this;

    if (t) {
      this.shopData = t;
      var n = t.props;

      for (var i in n) {
        var r = Number(n[i]);
        this.itemComp.initByData(i, r);
      }

      var a = e ? "blueLight" : "light";

      _res["default"].ins.getBundleByString("resSps").then(function (t) {
        t.load("spine/" + a + "/action", sp.SkeletonData, function (t, e) {
          if (!t && o.node && o.node.isValid) {
            var n = new cc.Node();
            var i = n.addComponent(sp.Skeleton);
            i.skeletonData = e, i.animation = "animation", n.parent = o.itemComp.node;
          }
        });
      })["catch"](function (t) {
        console.error("RTool.ins.getBundleByString('resSps')", t);
      });

      this.btnPrice.string = "Â¥" + t.price;
      this.finNode.active = !1;
      this.doubleNode.active = !1;
      this.checkData();
    }
  };

  e.prototype.checkData = function () {
    if (this.shopData) {
      var t = this.shopData.key;

      var e = _pInfo["default"].ins.getShopUnreset();

      var o = this.shopData["double"] || 0;
      var n = e[t] || 0;
      this.isDouble = this.doubleNode.active = n < o;
    }
  };

  e.prototype.onBtnBuy = function () {
    var t = this;

    if (this.shopData) {
      var e = this.isDouble ? 1 : 0;
      var o = this.shopData.props;
      var n = JSON.stringify(this.shopData.props);

      _idx.platform.reportEvent(_idx.ERepEvt.susPayment, {
        key: this.shopData.key
      });

      _idx.platform.payment(this.shopData.key, this.shopData.price, e, n).then(function () {
        var e = [];

        for (var n in o) {
          var i = o[n];
          t.isDouble && (i *= 2);

          _bagMgr["default"].ins.addItem(n, i);

          var r = {};
          r.itemId = n;
          r.worldPos = t.node.parent.convertToWorldSpaceAR(t.node.position);
          r.value = i;
          e.push(r);
        }

        _panelMgr["default"].ins.open("ui/ui_flyAni", {
          itemDatas: e
        });

        _pInfo["default"].ins.addShopUnreset(t.shopData.key);

        t.checkData();

        _idx.platform.reportEvent(_idx.ERepEvt.paymentResult, {
          key: t.shopData.key,
          success: 1
        });
      })["catch"](function (e) {
        _tipMgr["default"].ins.showTip(e, !0);

        _idx.platform.reportEvent(_idx.ERepEvt.paymentResult, {
          key: t.shopData.key,
          success: 0
        });
      });
    }
  };

  __decorate([g(cc.Node)], e.prototype, "buyBtnNode", void 0);

  __decorate([g(cc.Node)], e.prototype, "finNode", void 0);

  __decorate([g(cc.Label)], e.prototype, "btnPrice", void 0);

  __decorate([g(cc.Node)], e.prototype, "doubleNode", void 0);

  __decorate([g(_item["default"])], e.prototype, "itemComp", void 0);

  return __decorate([f], e);
}(cc.Component);

exports["default"] = y;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcc2hvcEl0ZW0uanMiXSwibmFtZXMiOlsibiIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiX2lkeCIsInJlcXVpcmUiLCJfcmVzIiwiX2JhZ01nciIsIl9wYW5lbE1nciIsIl90aXBNZ3IiLCJfcEluZm8iLCJfaXRlbSIsImgiLCJjYyIsIl9kZWNvcmF0b3IiLCJmIiwiY2NjbGFzcyIsImciLCJwcm9wZXJ0eSIsInkiLCJ0IiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiYnV5QnRuTm9kZSIsImZpbk5vZGUiLCJidG5QcmljZSIsImRvdWJsZU5vZGUiLCJpdGVtQ29tcCIsInNob3BEYXRhIiwiYW5pRGF0YXMiLCJpc0RvdWJsZSIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsIm9uTG9hZCIsInN0YXJ0IiwiaW5pdEl0ZW0iLCJvIiwicHJvcHMiLCJpIiwiciIsIk51bWJlciIsImluaXRCeURhdGEiLCJhIiwiaW5zIiwiZ2V0QnVuZGxlQnlTdHJpbmciLCJ0aGVuIiwibG9hZCIsInNwIiwiU2tlbGV0b25EYXRhIiwibm9kZSIsImlzVmFsaWQiLCJOb2RlIiwiYWRkQ29tcG9uZW50IiwiU2tlbGV0b24iLCJza2VsZXRvbkRhdGEiLCJhbmltYXRpb24iLCJwYXJlbnQiLCJjb25zb2xlIiwiZXJyb3IiLCJzdHJpbmciLCJwcmljZSIsImFjdGl2ZSIsImNoZWNrRGF0YSIsImtleSIsImdldFNob3BVbnJlc2V0Iiwib25CdG5CdXkiLCJKU09OIiwic3RyaW5naWZ5IiwicGxhdGZvcm0iLCJyZXBvcnRFdmVudCIsIkVSZXBFdnQiLCJzdXNQYXltZW50IiwicGF5bWVudCIsImFkZEl0ZW0iLCJpdGVtSWQiLCJ3b3JsZFBvcyIsImNvbnZlcnRUb1dvcmxkU3BhY2VBUiIsInBvc2l0aW9uIiwicHVzaCIsIm9wZW4iLCJpdGVtRGF0YXMiLCJhZGRTaG9wVW5yZXNldCIsInBheW1lbnRSZXN1bHQiLCJzdWNj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LENBQUMsQ0FBQ0osRUFBRSxDQUFDdUMsSUFBSixDQUFGLENBQUQsRUFBZS9CLENBQUMsQ0FBQ1ksU0FBakIsRUFBNEIsWUFBNUIsRUFBMEMsS0FBSyxDQUEvQyxDQUFWOztFQUNBcUQsVUFBVSxDQUFDLENBQUNyRSxDQUFDLENBQUNKLEVBQUUsQ0FBQ3VDLElBQUosQ0FBRixDQUFELEVBQWUvQixDQUFDLENBQUNZLFNBQWpCLEVBQTRCLFNBQTVCLEVBQXVDLEtBQUssQ0FBNUMsQ0FBVjs7RUFDQXFELFVBQVUsQ0FBQyxDQUFDckUsQ0FBQyxDQUFDSixFQUFFLENBQUMwRSxLQUFKLENBQUYsQ0FBRCxFQUFnQmxFLENBQUMsQ0FBQ1ksU0FBbEIsRUFBNkIsVUFBN0IsRUFBeUMsS0FBSyxDQUE5QyxDQUFWOztFQUNBcUQsVUFBVSxDQUFDLENBQUNyRSxDQUFDLENBQUNKLEVBQUUsQ0FBQ3VDLElBQUosQ0FBRixDQUFELEVBQWUvQixDQUFDLENBQUNZLFNBQWpCLEVBQTRCLFlBQTVCLEVBQTBDLEtBQUssQ0FBL0MsQ0FBVjs7RUFDQXFELFVBQVUsQ0FBQyxDQUFDckUsQ0FBQyxDQUFDTixLQUFLLFdBQU4sQ0FBRixDQUFELEVBQXFCVSxDQUFDLENBQUNZLFNBQXZCLEVBQWtDLFVBQWxDLEVBQThDLEtBQUssQ0FBbkQsQ0FBVjs7RUFDQSxPQUFPcUQsVUFBVSxDQUFDLENBQUN2RSxDQUFELENBQUQsRUFBTU0sQ0FBTixDQUFqQjtBQUNILENBN0ZPLENBNkZMUixFQUFFLENBQUMyRSxTQTdGRSxDQUFSOztBQThGQXRGLE9BQU8sV0FBUCxHQUFrQmlCLENBQWxCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge3ZhbHVlOiAhMH0pO1xudmFyIF9pZHggPSByZXF1aXJlKFwiaWR4XCIpO1xudmFyIF9yZXMgPSByZXF1aXJlKFwicmVzXCIpO1xudmFyIF9iYWdNZ3IgPSByZXF1aXJlKFwiYmFnTWdyXCIpO1xudmFyIF9wYW5lbE1nciA9IHJlcXVpcmUoXCJwYW5lbE1nclwiKTtcbnZhciBfdGlwTWdyID0gcmVxdWlyZShcInRpcE1nclwiKTtcbnZhciBfcEluZm8gPSByZXF1aXJlKFwicEluZm9cIik7XG52YXIgX2l0ZW0gPSByZXF1aXJlKFwiaXRlbVwiKTtcbnZhciBoID0gY2MuX2RlY29yYXRvcjtcbnZhciBmID0gaC5jY2NsYXNzO1xudmFyIGcgPSBoLnByb3BlcnR5O1xudmFyIHkgPSAoZnVuY3Rpb24gKHQpIHtcbiAgICBmdW5jdGlvbiBlKCkge1xuICAgICAgICB2YXIgZSA9IChudWxsICE9PSB0ICYmIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgfHwgdGhpcztcbiAgICAgICAgZS5idXlCdG5Ob2RlID0gbnVsbDtcbiAgICAgICAgZS5maW5Ob2RlID0gbnVsbDtcbiAgICAgICAgZS5idG5QcmljZSA9IG51bGw7XG4gICAgICAgIGUuZG91YmxlTm9kZSA9IG51bGw7XG4gICAgICAgIGUuaXRlbUNvbXAgPSBudWxsO1xuICAgICAgICBlLnNob3BEYXRhID0gbnVsbDtcbiAgICAgICAgZS5hbmlEYXRhcyA9IFtdO1xuICAgICAgICBlLmlzRG91YmxlID0gITE7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbiAgICBfX2V4dGVuZHMoZSwgdCk7XG4gICAgZS5wcm90b3R5cGUub25Mb2FkID0gZnVuY3Rpb24gKCkge307XG4gICAgZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICBlLnByb3RvdHlwZS5pbml0SXRlbSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgIHZhciBvID0gdGhpcztcbiAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgIHRoaXMuc2hvcERhdGEgPSB0O1xuICAgICAgICAgICAgdmFyIG4gPSB0LnByb3BzO1xuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBuKSB7XG4gICAgICAgICAgICAgICAgdmFyIHIgPSBOdW1iZXIobltpXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtQ29tcC5pbml0QnlEYXRhKGksIHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGEgPSBlID8gXCJibHVlTGlnaHRcIiA6IFwibGlnaHRcIjtcbiAgICAgICAgICAgIF9yZXMuZGVmYXVsdC5pbnNcbiAgICAgICAgICAgICAgICAuZ2V0QnVuZGxlQnlTdHJpbmcoXCJyZXNTcHNcIilcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICB0LmxvYWQoXCJzcGluZS9cIiArIGEgKyBcIi9hY3Rpb25cIiwgc3AuU2tlbGV0b25EYXRhLCBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0ICYmIG8ubm9kZSAmJiBvLm5vZGUuaXNWYWxpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gbmV3IGNjLk5vZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG4uYWRkQ29tcG9uZW50KHNwLlNrZWxldG9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaS5za2VsZXRvbkRhdGEgPSBlKSwgKGkuYW5pbWF0aW9uID0gXCJhbmltYXRpb25cIiksIChuLnBhcmVudCA9IG8uaXRlbUNvbXAubm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJSVG9vbC5pbnMuZ2V0QnVuZGxlQnlTdHJpbmcoJ3Jlc1NwcycpXCIsIHQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5idG5QcmljZS5zdHJpbmcgPSBcIsKlXCIgKyB0LnByaWNlO1xuICAgICAgICAgICAgdGhpcy5maW5Ob2RlLmFjdGl2ZSA9ICExO1xuICAgICAgICAgICAgdGhpcy5kb3VibGVOb2RlLmFjdGl2ZSA9ICExO1xuICAgICAgICAgICAgdGhpcy5jaGVja0RhdGEoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZS5wcm90b3R5cGUuY2hlY2tEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5zaG9wRGF0YSkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLnNob3BEYXRhLmtleTtcbiAgICAgICAgICAgIHZhciBlID0gX3BJbmZvLmRlZmF1bHQuaW5zLmdldFNob3BVbnJlc2V0KCk7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMuc2hvcERhdGEuZG91YmxlIHx8IDA7XG4gICAgICAgICAgICB2YXIgbiA9IGVbdF0gfHwgMDtcbiAgICAgICAgICAgIHRoaXMuaXNEb3VibGUgPSB0aGlzLmRvdWJsZU5vZGUuYWN0aXZlID0gbiA8IG87XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGUucHJvdG90eXBlLm9uQnRuQnV5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLnNob3BEYXRhKSB7XG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMuaXNEb3VibGUgPyAxIDogMDtcbiAgICAgICAgICAgIHZhciBvID0gdGhpcy5zaG9wRGF0YS5wcm9wcztcbiAgICAgICAgICAgIHZhciBuID0gSlNPTi5zdHJpbmdpZnkodGhpcy5zaG9wRGF0YS5wcm9wcyk7XG4gICAgICAgICAgICBfaWR4LnBsYXRmb3JtLnJlcG9ydEV2ZW50KF9pZHguRVJlcEV2dC5zdXNQYXltZW50LCB7a2V5OiB0aGlzLnNob3BEYXRhLmtleX0pO1xuICAgICAgICAgICAgX2lkeC5wbGF0Zm9ybVxuICAgICAgICAgICAgICAgIC5wYXltZW50KHRoaXMuc2hvcERhdGEua2V5LCB0aGlzLnNob3BEYXRhLnByaWNlLCBlLCBuKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbiBpbiBvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IG9bbl07XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmlzRG91YmxlICYmIChpICo9IDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2JhZ01nci5kZWZhdWx0Lmlucy5hZGRJdGVtKG4sIGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHIuaXRlbUlkID0gbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHIud29ybGRQb3MgPSB0Lm5vZGUucGFyZW50LmNvbnZlcnRUb1dvcmxkU3BhY2VBUih0Lm5vZGUucG9zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgci52YWx1ZSA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnB1c2gocik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3BhbmVsTWdyLmRlZmF1bHQuaW5zLm9wZW4oXCJ1aS91aV9mbHlBbmlcIiwge2l0ZW1EYXRhczogZX0pO1xuICAgICAgICAgICAgICAgICAgICBfcEluZm8uZGVmYXVsdC5pbnMuYWRkU2hvcFVucmVzZXQodC5zaG9wRGF0YS5rZXkpO1xuICAgICAgICAgICAgICAgICAgICB0LmNoZWNrRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICBfaWR4LnBsYXRmb3JtLnJlcG9ydEV2ZW50KF9pZHguRVJlcEV2dC5wYXltZW50UmVzdWx0LCB7a2V5OiB0LnNob3BEYXRhLmtleSwgc3VjY2VzczogMX0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aXBNZ3IuZGVmYXVsdC5pbnMuc2hvd1RpcChlLCAhMCk7XG4gICAgICAgICAgICAgICAgICAgIF9pZHgucGxhdGZvcm0ucmVwb3J0RXZlbnQoX2lkeC5FUmVwRXZ0LnBheW1lbnRSZXN1bHQsIHtrZXk6IHQuc2hvcERhdGEua2V5LCBzdWNjZXNzOiAwfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIF9fZGVjb3JhdGUoW2coY2MuTm9kZSldLCBlLnByb3RvdHlwZSwgXCJidXlCdG5Ob2RlXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbZyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImZpbk5vZGVcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtnKGNjLkxhYmVsKV0sIGUucHJvdG90eXBlLCBcImJ0blByaWNlXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbZyhjYy5Ob2RlKV0sIGUucHJvdG90eXBlLCBcImRvdWJsZU5vZGVcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtnKF9pdGVtLmRlZmF1bHQpXSwgZS5wcm90b3R5cGUsIFwiaXRlbUNvbXBcIiwgdm9pZCAwKTtcbiAgICByZXR1cm4gX19kZWNvcmF0ZShbZl0sIGUpO1xufSkoY2MuQ29tcG9uZW50KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHk7XG4iXX0=