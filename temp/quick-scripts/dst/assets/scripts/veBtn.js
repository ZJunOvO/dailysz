
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/veBtn.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'eb0f04Zrj5E9omuqiykJWJz', 'veBtn');
// scripts/veBtn.js

"use strict";

var n;
Object.defineProperty(exports, "__esModule", {
  value: !0
});

var _adC = require("adC");

var _com = require("com");

var _evts = require("evts");

var _idx = require("idx");

var _pConst = require("pConst");

var _request = require("request");

var _res = require("res");

var _sound = require("sound");

var _lang = require("lang");

var _tipMgr = require("tipMgr");

var _pInfo = require("pInfo");

var m = cc._decorator;
var v = m.ccclass;
var _ = m.property;

var b = function (t) {
  function e() {
    var e = null !== t && t.apply(this, arguments) || this;
    e.videoSource = "";
    e.videoDuration = _adC.VEnum2.MEDIUM;
    e.onWatchEndEvent = null;
    e.adSp = null;
    e.cb = null;
    e.eCb = null;
    return e;
  }

  __extends(e, t);

  e.prototype.onLoad = function () {
    _idx.platform.preloadVideo(_adC.VEnum[this.videoDuration]);

    this.adSp || (this.adSp = this.node.getChildByName("bg").getChildByName("img_gk_ds").getComponent(cc.Sprite));
    this.setShareIcon();
  };

  e.prototype.onEnable = function () {
    this.node.on("click", this.onClick, this);
    this.eCb = this.onOperTap.bind(this);

    _evts["default"].opE.on(this.eCb);
  };

  e.prototype.onDisable = function () {
    this.node.off("click", this.onClick, this);

    _evts["default"].opE.off(this.eCb);

    this.eCb = null;
  };

  e.prototype.onOperTap = function (t) {
    switch (t.action) {
      case _evts["default"].AD_MAX:
        this.setShareIcon();
    }
  };

  e.prototype.onClick = function (t) {
    var e = this;

    if ((!t || t.interactable) && null != this.onWatchEndEvent && (null == this.cb || this.cb())) {
      var o = _com["default"].ins.a(this.node, 1);

      var n = _pInfo["default"].ins.isMaxShareCount();

      var i = _pInfo["default"].ins.isMaxAdCount();

      if (n && i) return void _tipMgr["default"].ins.showTip(_lang.lang[10009]);
      if (i) return void _idx.platform.share().then(function (n) {
        n && (o(), e.onWatchEndEvent && cc.Component.EventHandler.emitEvents([e.onWatchEndEvent], t), _pInfo["default"].ins.addShareCount());
      })["catch"](function (t) {
        console.error(t);
      });
      var r = this.node.adDotData || e.onWatchEndEvent.customEventData;

      _idx.platform.doWatchAD({
        videoSource: this.videoSource,
        videoDuration: this.videoDuration,
        sequenceInfo: null
      }).then(function () {
        _sound["default"].ins.playBGM();

        o();
        e.onWatchEndEvent && cc.Component.EventHandler.emitEvents([e.onWatchEndEvent], t);

        _pInfo["default"].ins.addAdCount();

        _request["default"].ins.adDot(r, 1);
      })["catch"](function (t) {
        switch (_sound["default"].ins.playBGM(), o(), t) {
          case _pConst.VideoFailCode.NO_AD:
            _tipMgr["default"].ins.showTip(_lang.lang[1e4]), _request["default"].ins.adDot(r, 0);
            break;

          case _pConst.VideoFailCode.CANCELED:
            _request["default"].ins.adDot(r, 2);

        }
      });
    }
  };

  e.prototype.setBeforeWatchCheckHandler = function (t) {
    this.cb = t;
  };

  e.prototype.setShareIcon = function () {
    this.adSp && _pInfo["default"].ins.isMaxAdCount() && (this.adSp.node.$isShare || (_res["default"].ins.lSF("common/lupin_2", this.adSp), this.adSp.node.$isShare = !0));
  };

  __decorate([_(cc.String)], e.prototype, "videoSource", void 0);

  __decorate([_(cc.Component.EventHandler)], e.prototype, "onWatchEndEvent", void 0);

  __decorate([_(cc.Sprite)], e.prototype, "adSp", void 0);

  return __decorate([v], e);
}(cc.Component);

exports["default"] = b;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcdmVCdG4uanMiXSwibmFtZXMiOlsibiIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiX2FkQyIsInJlcXVpcmUiLCJfY29tIiwiX2V2dHMiLCJfaWR4IiwiX3BDb25zdCIsIl9yZXF1ZXN0IiwiX3JlcyIsIl9zb3VuZCIsIl9sYW5nIiwiX3RpcE1nciIsIl9wSW5mbyIsIm0iLCJjYyIsIl9kZWNvcmF0b3IiLCJ2IiwiY2NjbGFzcyIsIl8iLCJwcm9wZXJ0eSIsImIiLCJ0IiwiZSIsImFwcGx5IiwiYXJndW1lbnRzIiwidmlkZW9Tb3VyY2UiLCJ2aWRlb0R1cmF0aW9uIiwiVkVudW0yIiwiTUVESVVNIiwib25XYXRjaEVuZEV2ZW50IiwiYWRTcCIsImNiIiwiZUNiIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwib25Mb2FkIiwicGxhdGZvcm0iLCJwcmVsb2FkVmlkZW8iLCJWRW51bSIsIm5vZGUiLCJnZXRDaGlsZEJ5TmFtZSIsImdldENvbXBvbmVudCIsIlNwcml0ZSIsInNldFNoYXJlSWNvbiIsIm9uRW5hYmxlIiwib24iLCJvbkNsaWNrIiwib25PcGVyVGFwIiwiYmluZCIsIm9wRSIsIm9uRGlzYWJsZSIsIm9mZiIsImFjdGlvbiIsIkFEX01BWCIsImludGVyYWN0YWJsZSIsIm8iLCJpbnMiLCJhIiwiaXNNYXhTaGFyZUNvdW50IiwiaSIsImlzTWF4QWRDb3VudCIsInNob3dUaXAiLCJsYW5nIiwic2hhcmUiLCJ0aGVuIiwiQ29tcG9uZW50IiwiRXZlbnRIYW5kbGVyIiwiZW1pdEV2ZW50cyIsImFkZFNoYXJlQ291bnQiLCJjb25zb2xlIiwiZXJyb3IiLCJyIiwiYWREb3REYXRhIiwiY3VzdG9tRXZlbnREYXRhIiwiZG9XYXRjaEFEIiwic2VxdWVuY2VJbmZvIiwicGxheUJHTSIsImFkZEFkQ291bnQiLCJhZERvdCIsIlZpZGVvRmFpbENvZGUiLCJOT19BRCIsIkNBTkNFTEVEIiwic2V0QmVmb3JlV2F0Y2hDaGVja0hhbmRsZXIiLCIkaXNTaGFyZSIsImxTRiIsIl9fZGVjb3JhdGUiLCJTdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsQ0FBSjtBQUNBQyxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0VBQUNDLEtBQUssRUFBRSxDQUFDO0FBQVQsQ0FBN0M7O0FBQ0EsSUFBSUMsSUFBSSxHQUFHQyxPQUFPLENBQUMsS0FBRCxDQUFsQjs7QUFDQSxJQUFJQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxLQUFELENBQWxCOztBQUNBLElBQUlFLEtBQUssR0FBR0YsT0FBTyxDQUFDLE1BQUQsQ0FBbkI7O0FBQ0EsSUFBSUcsSUFBSSxHQUFHSCxPQUFPLENBQUMsS0FBRCxDQUFsQjs7QUFDQSxJQUFJSSxPQUFPLEdBQUdKLE9BQU8sQ0FBQyxRQUFELENBQXJCOztBQUNBLElBQUlLLFFBQVEsR0FBR0wsT0FBTyxDQUFDLFNBQUQsQ0FBdEI7O0FBQ0EsSUFBSU0sSUFBSSxHQUFHTixPQUFPLENBQUMsS0FBRCxDQUFsQjs7QUFDQSxJQUFJTyxNQUFNLEdBQUdQLE9BQU8sQ0FBQyxPQUFELENBQXBCOztBQUNBLElBQUlRLEtBQUssR0FBR1IsT0FBTyxDQUFDLE1BQUQsQ0FBbkI7O0FBQ0EsSUFBSVMsT0FBTyxHQUFHVCxPQUFPLENBQUMsUUFBRCxDQUFyQjs7QUFDQSxJQUFJVSxNQUFNLEdBQUdWLE9BQU8sQ0FBQyxPQUFELENBQXBCOztBQUNBLElBQUlXLENBQUMsR0FBR0MsRUFBRSxDQUFDQyxVQUFYO0FBQ0EsSUFBSUMsQ0FBQyxHQUFHSCxDQUFDLENBQUNJLE9BQVY7QUFDQSxJQUFJQyxDQUFDLEdBQUdMLENBQUMsQ0FBQ00sUUFBVjs7QUFDQSxJQUFJQyxDQUFDLEdBQUksVUFBVUMsQ0FBVixFQUFhO0VBQ2xCLFNBQVNDLENBQVQsR0FBYTtJQUNULElBQUlBLENBQUMsR0FBSSxTQUFTRCxDQUFULElBQWNBLENBQUMsQ0FB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QUFDLENBQUNKLEVBQUUsQ0FBQ3dFLE1BQUosQ0FBRixDQUFELEVBQWlCaEUsQ0FBQyxDQUFDWSxTQUFuQixFQUE4QixhQUE5QixFQUE2QyxLQUFLLENBQWxELENBQVY7O0VBQ0FtRCxVQUFVLENBQUMsQ0FBQ25FLENBQUMsQ0FBQ0osRUFBRSxDQUFDbUQsU0FBSCxDQUFhQyxZQUFkLENBQUYsQ0FBRCxFQUFpQzVDLENBQUMsQ0FBQ1ksU0FBbkMsRUFBOEMsaUJBQTlDLEVBQWlFLEtBQUssQ0FBdEUsQ0FBVjs7RUFDQW1ELFVBQVUsQ0FBQyxDQUFDbkUsQ0FBQyxDQUFDSixFQUFFLENBQUM0QixNQUFKLENBQUYsQ0FBRCxFQUFpQnBCLENBQUMsQ0FBQ1ksU0FBbkIsRUFBOEIsTUFBOUIsRUFBc0MsS0FBSyxDQUEzQyxDQUFWOztFQUNBLE9BQU9tRCxVQUFVLENBQUMsQ0FBQ3JFLENBQUQsQ0FBRCxFQUFNTSxDQUFOLENBQWpCO0FBQ0gsQ0F0Rk8sQ0FzRkxSLEVBQUUsQ0FBQ21ELFNBdEZFLENBQVI7O0FBdUZBbEUsT0FBTyxXQUFQLEdBQWtCcUIsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBuO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7dmFsdWU6ICEwfSk7XG52YXIgX2FkQyA9IHJlcXVpcmUoXCJhZENcIik7XG52YXIgX2NvbSA9IHJlcXVpcmUoXCJjb21cIik7XG52YXIgX2V2dHMgPSByZXF1aXJlKFwiZXZ0c1wiKTtcbnZhciBfaWR4ID0gcmVxdWlyZShcImlkeFwiKTtcbnZhciBfcENvbnN0ID0gcmVxdWlyZShcInBDb25zdFwiKTtcbnZhciBfcmVxdWVzdCA9IHJlcXVpcmUoXCJyZXF1ZXN0XCIpO1xudmFyIF9yZXMgPSByZXF1aXJlKFwicmVzXCIpO1xudmFyIF9zb3VuZCA9IHJlcXVpcmUoXCJzb3VuZFwiKTtcbnZhciBfbGFuZyA9IHJlcXVpcmUoXCJsYW5nXCIpO1xudmFyIF90aXBNZ3IgPSByZXF1aXJlKFwidGlwTWdyXCIpO1xudmFyIF9wSW5mbyA9IHJlcXVpcmUoXCJwSW5mb1wiKTtcbnZhciBtID0gY2MuX2RlY29yYXRvcjtcbnZhciB2ID0gbS5jY2NsYXNzO1xudmFyIF8gPSBtLnByb3BlcnR5O1xudmFyIGIgPSAoZnVuY3Rpb24gKHQpIHtcbiAgICBmdW5jdGlvbiBlKCkge1xuICAgICAgICB2YXIgZSA9IChudWxsICE9PSB0ICYmIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgfHwgdGhpcztcbiAgICAgICAgZS52aWRlb1NvdXJjZSA9IFwiXCI7XG4gICAgICAgIGUudmlkZW9EdXJhdGlvbiA9IF9hZEMuVkVudW0yLk1FRElVTTtcbiAgICAgICAgZS5vbldhdGNoRW5kRXZlbnQgPSBudWxsO1xuICAgICAgICBlLmFkU3AgPSBudWxsO1xuICAgICAgICBlLmNiID0gbnVsbDtcbiAgICAgICAgZS5lQ2IgPSBudWxsO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgX19leHRlbmRzKGUsIHQpO1xuICAgIGUucHJvdG90eXBlLm9uTG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX2lkeC5wbGF0Zm9ybS5wcmVsb2FkVmlkZW8oX2FkQy5WRW51bVt0aGlzLnZpZGVvRHVyYXRpb25dKTtcbiAgICAgICAgdGhpcy5hZFNwIHx8ICh0aGlzLmFkU3AgPSB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJiZ1wiKS5nZXRDaGlsZEJ5TmFtZShcImltZ19na19kc1wiKS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKSk7XG4gICAgICAgIHRoaXMuc2V0U2hhcmVJY29uKCk7XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5vbkVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ub2RlLm9uKFwiY2xpY2tcIiwgdGhpcy5vbkNsaWNrLCB0aGlzKTtcbiAgICAgICAgdGhpcy5lQ2IgPSB0aGlzLm9uT3BlclRhcC5iaW5kKHRoaXMpO1xuICAgICAgICBfZXZ0cy5kZWZhdWx0Lm9wRS5vbih0aGlzLmVDYik7XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5vbkRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubm9kZS5vZmYoXCJjbGlja1wiLCB0aGlzLm9uQ2xpY2ssIHRoaXMpO1xuICAgICAgICBfZXZ0cy5kZWZhdWx0Lm9wRS5vZmYodGhpcy5lQ2IpO1xuICAgICAgICB0aGlzLmVDYiA9IG51bGw7XG4gICAgfTtcbiAgICBlLnByb3RvdHlwZS5vbk9wZXJUYXAgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICBzd2l0Y2ggKHQuYWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIF9ldnRzLmRlZmF1bHQuQURfTUFYOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U2hhcmVJY29uKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGUucHJvdG90eXBlLm9uQ2xpY2sgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIGlmICgoIXQgfHwgdC5pbnRlcmFjdGFibGUpICYmIG51bGwgIT0gdGhpcy5vbldhdGNoRW5kRXZlbnQgJiYgKG51bGwgPT0gdGhpcy5jYiB8fCB0aGlzLmNiKCkpKSB7XG4gICAgICAgICAgICB2YXIgbyA9IF9jb20uZGVmYXVsdC5pbnMuYSh0aGlzLm5vZGUsIDEpO1xuICAgICAgICAgICAgdmFyIG4gPSBfcEluZm8uZGVmYXVsdC5pbnMuaXNNYXhTaGFyZUNvdW50KCk7XG4gICAgICAgICAgICB2YXIgaSA9IF9wSW5mby5kZWZhdWx0Lmlucy5pc01heEFkQ291bnQoKTtcbiAgICAgICAgICAgIGlmIChuICYmIGkpIHJldHVybiB2b2lkIF90aXBNZ3IuZGVmYXVsdC5pbnMuc2hvd1RpcChfbGFuZy5sYW5nWzEwMDA5XSk7XG4gICAgICAgICAgICBpZiAoaSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBfaWR4LnBsYXRmb3JtXG4gICAgICAgICAgICAgICAgICAgIC5zaGFyZSgpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKG8oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm9uV2F0Y2hFbmRFdmVudCAmJiBjYy5Db21wb25lbnQuRXZlbnRIYW5kbGVyLmVtaXRFdmVudHMoW2Uub25XYXRjaEVuZEV2ZW50XSwgdCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3BJbmZvLmRlZmF1bHQuaW5zLmFkZFNoYXJlQ291bnQoKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih0KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgciA9IHRoaXMubm9kZS5hZERvdERhdGEgfHwgZS5vbldhdGNoRW5kRXZlbnQuY3VzdG9tRXZlbnREYXRhO1xuICAgICAgICAgICAgX2lkeC5wbGF0Zm9ybVxuICAgICAgICAgICAgICAgIC5kb1dhdGNoQUQoe3ZpZGVvU291cmNlOiB0aGlzLnZpZGVvU291cmNlLCB2aWRlb0R1cmF0aW9uOiB0aGlzLnZpZGVvRHVyYXRpb24sIHNlcXVlbmNlSW5mbzogbnVsbH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfc291bmQuZGVmYXVsdC5pbnMucGxheUJHTSgpO1xuICAgICAgICAgICAgICAgICAgICBvKCk7XG4gICAgICAgICAgICAgICAgICAgIGUub25XYXRjaEVuZEV2ZW50ICYmIGNjLkNvbXBvbmVudC5FdmVudEhhbmRsZXIuZW1pdEV2ZW50cyhbZS5vbldhdGNoRW5kRXZlbnRdLCB0KTtcbiAgICAgICAgICAgICAgICAgICAgX3BJbmZvLmRlZmF1bHQuaW5zLmFkZEFkQ291bnQoKTtcbiAgICAgICAgICAgICAgICAgICAgX3JlcXVlc3QuZGVmYXVsdC5pbnMuYWREb3QociwgMSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICgoX3NvdW5kLmRlZmF1bHQuaW5zLnBsYXlCR00oKSwgbygpLCB0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBfcENvbnN0LlZpZGVvRmFpbENvZGUuTk9fQUQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RpcE1nci5kZWZhdWx0Lmlucy5zaG93VGlwKF9sYW5nLmxhbmdbMWU0XSksIF9yZXF1ZXN0LmRlZmF1bHQuaW5zLmFkRG90KHIsIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBfcENvbnN0LlZpZGVvRmFpbENvZGUuQ0FOQ0VMRUQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3JlcXVlc3QuZGVmYXVsdC5pbnMuYWREb3QociwgMik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZS5wcm90b3R5cGUuc2V0QmVmb3JlV2F0Y2hDaGVja0hhbmRsZXIgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICB0aGlzLmNiID0gdDtcbiAgICB9O1xuICAgIGUucHJvdG90eXBlLnNldFNoYXJlSWNvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5hZFNwICYmXG4gICAgICAgICAgICBfcEluZm8uZGVmYXVsdC5pbnMuaXNNYXhBZENvdW50KCkgJiZcbiAgICAgICAgICAgICh0aGlzLmFkU3Aubm9kZS4kaXNTaGFyZSB8fFxuICAgICAgICAgICAgICAgIChfcmVzLmRlZmF1bHQuaW5zLmxTRihcImNvbW1vbi9sdXBpbl8yXCIsIHRoaXMuYWRTcCksICh0aGlzLmFkU3Aubm9kZS4kaXNTaGFyZSA9ICEwKSkpO1xuICAgIH07XG4gICAgX19kZWNvcmF0ZShbXyhjYy5TdHJpbmcpXSwgZS5wcm90b3R5cGUsIFwidmlkZW9Tb3VyY2VcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtfKGNjLkNvbXBvbmVudC5FdmVudEhhbmRsZXIpXSwgZS5wcm90b3R5cGUsIFwib25XYXRjaEVuZEV2ZW50XCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXyhjYy5TcHJpdGUpXSwgZS5wcm90b3R5cGUsIFwiYWRTcFwiLCB2b2lkIDApO1xuICAgIHJldHVybiBfX2RlY29yYXRlKFt2XSwgZSk7XG59KShjYy5Db21wb25lbnQpO1xuZXhwb3J0cy5kZWZhdWx0ID0gYjtcbiJdfQ==