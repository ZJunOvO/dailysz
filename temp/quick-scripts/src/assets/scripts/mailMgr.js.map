{"version":3,"sources":["assets\\scripts\\mailMgr.js"],"names":["Object","defineProperty","exports","value","mailState","n","_numberUtils","require","_evts","_request","_time","_pInfo","_bagMgr","u","t","_mailInfo","_serverMail","isGetting","getCb","_ins","Error","initMail","get","enumerable","configurable","prototype","ins","Mail","mail","outMail","saveMail","getMail","push","e","o","length","forEach","Date","now","code","data","i","mailInfo","Array","keys","r","Set","a","JSON","parse","stringify","c","add","id","has","Number","end_time","serverTime","indexOf","noRead","deleteMail","parseNum","award","opE","emit","action","UPDMAIL","type","getAward","addItem","readMail","read","serverMail","props","hasOwnProperty","none"],"mappings":"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","sourceRoot":"/","sourcesContent":["Object.defineProperty(exports, \"__esModule\", { value: !0 });\nexports.mailState = void 0;\nvar n;\nvar _numberUtils = require(\"NumberUtils\");\nvar _evts = require(\"evts\");\nvar _request = require(\"request\");\nvar _time = require(\"time\");\nvar _pInfo = require(\"pInfo\");\nvar _bagMgr = require(\"bagMgr\");\nvar u = (function() {\n    function t() {\n        if (((this._mailInfo = {}), (this._serverMail = {}), (this.isGetting = !1), (this.getCb = []), t._ins))\n            throw new Error(\"mailMgr can only be one！\");\n        t._ins = this;\n        this.initMail();\n    }\n    Object.defineProperty(t, \"ins\", {\n        get: function() {\n            t._ins || new t();\n            return t._ins;\n        },\n        enumerable: !1,\n        configurable: !0\n    });\n    t.prototype.initMail = function() {\n        this._mailInfo = _pInfo.default.ins.Mail;\n        this._mailInfo.mail || (this._mailInfo.mail = {});\n        this._mailInfo.outMail || (this._mailInfo.outMail = []);\n    };\n    t.prototype.saveMail = function() {\n        _pInfo.default.ins.Mail = this._mailInfo;\n    };\n    Object.defineProperty(t.prototype, \"mailInfo\", {\n        get: function() {\n            return this._mailInfo;\n        },\n        enumerable: !1,\n        configurable: !0\n    });\n    Object.defineProperty(t.prototype, \"serverMail\", {\n        get: function() {\n            return this._serverMail;\n        },\n        enumerable: !1,\n        configurable: !0\n    });\n    t.prototype.getMail = function(t) {\n        if ((t && this.getCb.push(t), !this.isGetting)) {\n            var e = this;\n            var o = function(t) {\n                e.getCb.length > 0 &&\n                    e.getCb.forEach(function(e) {\n                        return e && e(t);\n                    });\n                e.getCb = [];\n                e.isGetting = !1;\n            };\n            e.isGetting = !0;\n            var t = {\n                \"status\": 0,\n                \"msg\": \"无邮件信息\",\n                \"code\": 0,\n                \"server_time\": Date.now()\n            };\n            // _request.default.ins\n            //     .getMailData(void 0, this._mailInfo.outMail)\n            //     .then(function (t) {\n            if (t && t.code && t.data) {\n                var i;\n                if (e.mailInfo.mail instanceof Array)(i = e.mailInfo.mail), (e.mailInfo.mail = {});\n                else if (Object.keys(e._mailInfo.mail).length !== t.data.length) {\n                    var r = new Set();\n                    var a = JSON.parse(JSON.stringify(e._mailInfo.mail));\n                    for (var c in (JSON.parse(JSON.stringify(t.data)).forEach(function(t) {\n                                r.add(t.id);\n                            }),\n                            a))\n                        r.has(Number(c)) || delete e._mailInfo.mail[c];\n                }\n                t.data.forEach(function(t) {\n                    e._serverMail[t.id] = t;\n                    t.end_time < 1e3 * _time.default.ins.serverTime ?\n                        e._mailInfo.outMail.indexOf(t.id) < 0 && e._mailInfo.outMail.push(t.id) :\n                        e.mailInfo.mail[t.id] ||\n                        (i && i.indexOf(t.id) > -1 ?\n                            (e.mailInfo.mail[t.id] = i[t.id]) :\n                            (e.mailInfo.mail[t.id] = n.noRead));\n                });\n            } else t && 0 === t.code && (e.mailInfo.mail = {});\n            e.saveMail();\n            o(e._serverMail);\n            // })\n            // .catch(function (t) {\n            //     console.error(\"getMailDataErr\", t);\n            //     o({errMsg: \"error\"});\n            // });\n        }\n    };\n    t.prototype.deleteMail = function(t) {\n        if ((void 0 === t && (t = null), (t = _numberUtils.default.parseNum(t))))\n            return (\n                this._mailInfo.mail[t] && delete this._mailInfo.mail[t], -1 == this._mailInfo.outMail.indexOf(t) && this._mailInfo.outMail.push(t),\n                this.saveMail(), !0\n            );\n        for (var e in this._mailInfo.mail)\n            if (this._mailInfo.mail[e] === n.award) {\n                var o = _numberUtils.default.parseNum(e); -\n                1 == this._mailInfo.outMail.indexOf(o) && this._mailInfo.outMail.push(o);\n                this._mailInfo.mail[e] && delete this._mailInfo.mail[e];\n            }\n        this.saveMail();\n        _evts.default.opE.emit({ action: _evts.default.UPDMAIL, data: { type: \"keyDelete\" } });\n        return !0;\n    };\n    t.prototype.getAward = function(t) {\n        if ((void 0 === t && (t = null), t))\n            return (\n                this._mailInfo.mail[t] != n.award &&\n                ((this._mailInfo.mail[t] = n.award), this.addItem(t), this.saveMail(), !0)\n            );\n        var e = !1;\n        for (var o in this._mailInfo.mail)\n            this._mailInfo.mail[o] !== n.award && (e || (e = !0), (this._mailInfo.mail[o] = n.award), this.addItem(o));\n        e && this.saveMail();\n        _evts.default.opE.emit({ action: _evts.default.UPDMAIL, data: { type: \"keyAward\" } });\n        return e;\n    };\n    t.prototype.readMail = function(t) {\n        void 0 === t && (t = null);\n        return !(!t ||\n            !this._mailInfo.mail[t] ||\n            (this._mailInfo.mail[t] != n.award &&\n                (this._mailInfo.mail[t] != n.noRead || ((this._mailInfo.mail[t] = n.read), this.saveMail(), 0)))\n        );\n    };\n    t.prototype.addItem = function(t) {\n        var e = this.serverMail;\n        if (t) {\n            if (!e[t]) return;\n            for (var o = JSON.parse(e[t].props), n = Object.keys(o), i = 0; i < n.length; i++) {\n                var r = n[i];\n                if (o.hasOwnProperty(r)) {\n                    var a = i === n.length - 1;\n                    _bagMgr.default.ins.addItem(r, o[r], !0, a);\n                }\n            }\n        }\n    };\n    return t;\n})();\nexports.default = u;\n(function(t) {\n    (t[(t.none = 0)] = \"none\"),\n    (t[(t.noRead = 1)] = \"noRead\"),\n    (t[(t.read = 2)] = \"read\"),\n    (t[(t.award = 3)] = \"award\");\n})((n = exports.mailState || (exports.mailState = {})));"]}