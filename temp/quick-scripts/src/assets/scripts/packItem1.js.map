{"version":3,"sources":["assets\\scripts\\packItem1.js"],"names":["n","Object","defineProperty","exports","value","_idx","require","_item","_bagMgr","_panelMgr","_shopMgr","_tipMgr","_pInfo","h","cc","_decorator","f","ccclass","g","property","y","t","e","apply","arguments","packName","scrollView","priceLb","rewardItem","finNode","btnNode","adNode","buyNumLb","redNode","discountLb","shopData","isFree","_rewardItems","__extends","prototype","onLoad","initItem","string","title","price","o","ins","getPackRed","key","active","setPackRed","discount","node","parent","initReward","props","checkData","content","i","children","forEach","push","removeAllChildren","r","a","shift","instantiate","c","getComponent","initByData","setContentSize","getShopRecord","daily_limit_nums","onBtnBuy","JSON","stringify","platform","payment","then","getReward","showTip","onBtnAd","addItem","length","u","p","itemId","worldPos","convertToWorldSpaceAR","position","Number","count","open","itemDatas","addShopRecord","__decorate","Label","ScrollView","Node","Component"],"mappings":"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","sourceRoot":"/","sourcesContent":["var n;\nObject.defineProperty(exports, \"__esModule\", {value: !0});\nvar _idx = require(\"idx\");\nvar _item = require(\"item\");\nvar _bagMgr = require(\"bagMgr\");\nvar _panelMgr = require(\"panelMgr\");\nvar _shopMgr = require(\"shopMgr\");\nvar _tipMgr = require(\"tipMgr\");\nvar _pInfo = require(\"pInfo\");\nvar h = cc._decorator;\nvar f = h.ccclass;\nvar g = h.property;\nvar y = (function (t) {\n    function e() {\n        var e = (null !== t && t.apply(this, arguments)) || this;\n        e.packName = null;\n        e.scrollView = null;\n        e.priceLb = null;\n        e.rewardItem = null;\n        e.finNode = null;\n        e.btnNode = null;\n        e.adNode = null;\n        e.buyNumLb = null;\n        e.redNode = null;\n        e.discountLb = null;\n        e.shopData = null;\n        e.isFree = !1;\n        e._rewardItems = [];\n        return e;\n    }\n    __extends(e, t);\n    e.prototype.onLoad = function () {};\n    e.prototype.initItem = function (t) {\n        this.shopData = t;\n        this.packName.string = (null == t ? void 0 : t.title) || \"礼包\";\n        var e = t.price || 0;\n        this.priceLb.string = \"¥\" + t.price;\n        this.isFree = 0 == e;\n        var o = _shopMgr.default.ins.getPackRed();\n        o[t.key]\n            ? (this.redNode.active = !1)\n            : ((this.redNode.active = !0), (o[t.key] = 1), _shopMgr.default.ins.setPackRed(o));\n        t.discount\n            ? ((this.discountLb.string = t.discount + \"折\"), (this.discountLb.node.parent.active = !0))\n            : (this.discountLb.node.parent.active = !1);\n        this.initReward(t.props);\n        this.checkData();\n    };\n    e.prototype.initReward = function (t) {\n        var e = this;\n        if (t) {\n            var o = 0;\n            var n = this.scrollView.content;\n            for (var i in (n.children.forEach(function (t) {\n                e._rewardItems.push(t);\n            }),\n            n.removeAllChildren(),\n            t)) {\n                var r = t[i];\n                var a = this._rewardItems.shift();\n                a || (a = cc.instantiate(this.rewardItem));\n                a.parent = n;\n                a.active = !0;\n                var c = a.getComponent(_item.default);\n                c && c.initByData(i, r);\n                o++;\n            }\n            n.setContentSize(93 * o, 100);\n        }\n    };\n    e.prototype.checkData = function () {\n        if (this.shopData) {\n            var t = this.shopData.key;\n            var e = _pInfo.default.ins.getShopRecord();\n            var o = this.shopData.daily_limit_nums || 0;\n            var n = e[t] || 0;\n            this.btnNode.active = !this.isFree;\n            this.adNode.active = this.isFree;\n            var i = this.isFree ? this.adNode : this.btnNode;\n            var r = n >= o;\n            this.finNode.active = r;\n            i.active = !r;\n            this.buyNumLb.node.active = !r;\n            this.buyNumLb.string = \"限购:\" + n + \"/\" + o;\n        }\n    };\n    e.prototype.onBtnBuy = function () {\n        var t = this;\n        if (this.shopData) {\n            var e = JSON.stringify(this.shopData.props);\n            _idx.platform\n                .payment(this.shopData.key, this.shopData.price, 0, e)\n                .then(function () {\n                    t.getReward();\n                })\n                .catch(function (t) {\n                    _tipMgr.default.ins.showTip(t, !0);\n                });\n        }\n    };\n    e.prototype.onBtnAd = function () {\n        this.shopData && this.getReward();\n    };\n    e.prototype.getReward = function () {\n        var t = this.shopData.props;\n        for (var e in t) {\n            var o = t[e];\n            _bagMgr.default.ins.addItem(e, o);\n        }\n        for (var n = this.scrollView.content.children, i = [], r = 0, a = n.length; r < a; r++) {\n            var u = n[r];\n            var p = u.getComponent(_item.default);\n            var h = {};\n            h.itemId = p.key;\n            h.worldPos = u.parent.convertToWorldSpaceAR(u.position);\n            h.value = Number(p.count);\n            i.push(h);\n        }\n        _panelMgr.default.ins.open(\"ui/ui_flyAni\", {itemDatas: i});\n        _pInfo.default.ins.addShopRecord(this.shopData.key);\n        this.checkData();\n    };\n    __decorate([g(cc.Label)], e.prototype, \"packName\", void 0);\n    __decorate([g(cc.ScrollView)], e.prototype, \"scrollView\", void 0);\n    __decorate([g(cc.Label)], e.prototype, \"priceLb\", void 0);\n    __decorate([g(cc.Node)], e.prototype, \"rewardItem\", void 0);\n    __decorate([g(cc.Node)], e.prototype, \"finNode\", void 0);\n    __decorate([g(cc.Node)], e.prototype, \"btnNode\", void 0);\n    __decorate([g(cc.Node)], e.prototype, \"adNode\", void 0);\n    __decorate([g(cc.Label)], e.prototype, \"buyNumLb\", void 0);\n    __decorate([g(cc.Node)], e.prototype, \"redNode\", void 0);\n    __decorate([g(cc.Label)], e.prototype, \"discountLb\", void 0);\n    return __decorate([f], e);\n})(cc.Component);\nexports.default = y;\n"]}