{"version":3,"sources":["assets\\scripts\\page_shop.js"],"names":["n","Object","defineProperty","exports","value","_evts","require","_mySafeArea","_res","_cfgMgr","_global","_panelMgr","_skinMgr","_pInfo","_item","_shopItem1","v","cc","_decorator","_","ccclass","b","property","w","t","e","apply","arguments","bgNode","topSpNode","spineNode","scrollView","topBgSp","topBgSp1","powerItem","goldItem","itemSc","itemPre","lightNode","eventFunc","__extends","prototype","onLoad","node","height","winSize","padScale","scaleX","parent","scale","loadGirl","onResize","onOperTap","bind","opE","on","action","REFRESH_CFGDATA","initPanel","getSafeAreaRect","yMin","content","start","__awaiter","__generator","ins","updateRole","getUsingSkin","role","getBundleByString","then","load","sp","SkeletonData","o","isValid","Node","i","addComponent","Skeleton","skeletonData","animation","console","error","initPower","initGold","initPack","removeAllChildren","serverCfg","shop_config","gift","getShopRecord","r","a","daily_limit_nums","s","key","is_shop","width","props","c","l","instantiate","active","addChild","getComponent","initByData","u","children","childrenCount","x","Math","min","scrollToLeft","onBtnGift","open","emit","UPD_MAIN_RED","onDestroy","off","__decorate","ScrollView","Component"],"mappings":"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","sourceRoot":"/","sourcesContent":["var n;\nObject.defineProperty(exports, \"__esModule\", {value: !0});\nvar _evts = require(\"evts\");\nvar _mySafeArea = require(\"mySafeArea\");\nvar _res = require(\"res\");\nvar _cfgMgr = require(\"cfgMgr\");\nvar _global = require(\"global\");\nvar _panelMgr = require(\"panelMgr\");\nvar _skinMgr = require(\"skinMgr\");\nvar _pInfo = require(\"pInfo\");\nvar _item = require(\"item\");\nvar _shopItem1 = require(\"shopItem1\");\nvar v = cc._decorator;\nvar _ = v.ccclass;\nvar b = v.property;\nvar w = (function (t) {\n    function e() {\n        var e = (null !== t && t.apply(this, arguments)) || this;\n        e.bgNode = null;\n        e.topSpNode = null;\n        e.spineNode = null;\n        e.scrollView = null;\n        e.topBgSp = null;\n        e.topBgSp1 = null;\n        e.powerItem = null;\n        e.goldItem = null;\n        e.itemSc = null;\n        e.itemPre = null;\n        e.lightNode = null;\n        e.eventFunc = null;\n        return e;\n    }\n    __extends(e, t);\n    e.prototype.onLoad = function () {\n        this.node.height = cc.winSize.height;\n        _global.default.padScale && (this.bgNode.scaleX = this.topSpNode.parent.scale = _global.default.padScale);\n        this.loadGirl();\n        this.onResize();\n        this.eventFunc = this.onOperTap.bind(this);\n        _evts.default.opE.on(this.eventFunc);\n    };\n    e.prototype.onOperTap = function (t) {\n        var e = null == t ? void 0 : t.action;\n        if (e)\n            switch (e) {\n                case _evts.default.REFRESH_CFGDATA:\n                    this.initPanel();\n            }\n    };\n    e.prototype.onResize = function () {\n        var t = _mySafeArea.getSafeAreaRect().yMin;\n        var e = cc.winSize.height - 1280 - t;\n        this.scrollView.node.height += e;\n        this.scrollView.content.parent.height += e;\n        this.topBgSp.height += e;\n        this.topBgSp1.height += e;\n    };\n    e.prototype.start = function () {\n        this.initPanel();\n    };\n    e.prototype.loadGirl = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var t = this;\n            return __generator(this, function () {\n                _skinMgr.default.ins.updateRole(_pInfo.default.ins.getUsingSkin().role, this.spineNode);\n                _res.default.ins\n                    .getBundleByString(\"resSps\")\n                    .then(function (e) {\n                        e.load(\"spine/light/action\", sp.SkeletonData, function (e, o) {\n                            if (!e && t.node && t.node.isValid) {\n                                var n = new cc.Node();\n                                var i = n.addComponent(sp.Skeleton);\n                                i.skeletonData = o;\n                                i.animation = \"animation\";\n                                n.parent = t.lightNode;\n                            }\n                        });\n                    })\n                    .catch(function (t) {\n                        console.error(\"RTool.ins.getBundleByString('resSps')\", t);\n                    });\n                return [2];\n            });\n        });\n    };\n    e.prototype.initPanel = function () {\n        this.powerItem.initPower();\n        this.goldItem.initGold();\n        this.initPack();\n    };\n    e.prototype.initPack = function () {\n        var t;\n        var e;\n        this.itemSc.content.removeAllChildren();\n        var o =\n            null === (e = null === (t = _cfgMgr.default.serverCfg) || void 0 === t ? void 0 : t.shop_config) ||\n            void 0 === e\n                ? void 0\n                : e.gift;\n        if (o) {\n            var n = {};\n            var i = _pInfo.default.ins.getShopRecord();\n            for (var r in o) {\n                var a = (null == (n = o[r]) ? void 0 : n.daily_limit_nums) || 0;\n                var s = i[n.key] || 0;\n                if ((null == n ? void 0 : n.is_shop) && s < a) break;\n            }\n            if (((this.itemSc.node.width = 330), n && n.props)) {\n                for (var r in n.props) {\n                    var c = n.props[r];\n                    var l = cc.instantiate(this.itemPre);\n                    l.active = !0;\n                    this.itemSc.content.addChild(l);\n                    l.getComponent(_item.default).initByData(r, c);\n                }\n                var u = this.itemSc.content.children[0].width * this.itemSc.content.childrenCount;\n                this.itemSc.node.x = u > this.itemSc.node.width ? -4 : (this.itemSc.node.width - u) / 2 - 4;\n                u = Math.min(u, 330);\n                this.itemSc.node.width = u;\n                this.itemSc.scrollToLeft();\n            }\n        }\n    };\n    e.prototype.onBtnGift = function () {\n        _panelMgr.default.ins.open(\"ui/ui_shopPack\", null).then(function () {\n            _evts.default.opE.emit({action: _evts.default.UPD_MAIN_RED});\n        });\n    };\n    e.prototype.onDestroy = function () {\n        _evts.default.opE.off(this.eventFunc);\n        this.eventFunc = null;\n    };\n    __decorate([b(cc.Node)], e.prototype, \"bgNode\", void 0);\n    __decorate([b(cc.Node)], e.prototype, \"topSpNode\", void 0);\n    __decorate([b(cc.Node)], e.prototype, \"spineNode\", void 0);\n    __decorate([b(cc.ScrollView)], e.prototype, \"scrollView\", void 0);\n    __decorate([b(cc.Node)], e.prototype, \"topBgSp\", void 0);\n    __decorate([b(cc.Node)], e.prototype, \"topBgSp1\", void 0);\n    __decorate([b(_shopItem1.default)], e.prototype, \"powerItem\", void 0);\n    __decorate([b(_shopItem1.default)], e.prototype, \"goldItem\", void 0);\n    __decorate([b(cc.ScrollView)], e.prototype, \"itemSc\", void 0);\n    __decorate([b(cc.Node)], e.prototype, \"itemPre\", void 0);\n    __decorate([b(cc.Node)], e.prototype, \"lightNode\", void 0);\n    return __decorate([_], e);\n})(cc.Component);\nexports.default = w;\n"]}