{"version":3,"sources":["assets\\scripts\\scrollView.js"],"names":["n","Object","defineProperty","exports","value","a","cc","_decorator","s","ccclass","c","property","l","t","e","apply","arguments","maxScale","minScale","brake","content","_touchMovePreviousTimestamp","_autoScrolling","_touchMoveDisplacements","_touchMoveTimeDeltas","_autoScrollAccumulatedTime","_autoScrollTotalTime","_autoScrollStartPosition","v2","_autoScrollTargetDelta","Vec2","ZERO","_isHandleMultiTouch","_isOnDestScrolling","__extends","prototype","onLoad","Node","EventType","on","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","onDestroy","off","resetTouchInfos","getTouches","length","o","getDelta","moveContent","gatherTouchMove","i","_initLen","getPreviousLocation","sub","mag","r","getStartLocation","add","divide","node","convertToNodeSpaceAR","convertToWorldSpaceAR","_initPos","_initScale","scale","getLocation","_tarScale","_scrollZoom","startInertiaScroll","update","mul","Math","abs","processAutoScrolling","calculateTouchMoveVelocity","reduce","x","y","min","getPosition","_clampDelta","startAttenuatingAutoScroll","sqrt","normalize","getContentSize","width","height","calculateAttenuatedFactor","u","p","startAutoScroll","fuzzyEquals","Promise","boundX","boundY","tween","to","position","v3","call","start","setPosition","getTimeInMilliseconds","Date","getMilliseconds","shift","push","get","scaleY","enumerable","configurable","scaleX","scrollTo","then","stopAutoScroll","__decorate","tooltip","type","Float","Component"],"mappings":"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","sourceRoot":"/","sourcesContent":["var n;\nObject.defineProperty(exports, \"__esModule\", {value: !0});\nvar a = cc._decorator;\nvar s = a.ccclass;\nvar c = a.property;\nvar l = (function (t) {\n    function e() {\n        var e = (null !== t && t.apply(this, arguments)) || this;\n        e.maxScale = 1.5;\n        e.minScale = 0.5;\n        e.brake = 0.75;\n        e.content = null;\n        e._touchMovePreviousTimestamp = 0;\n        e._autoScrolling = !1;\n        e._touchMoveDisplacements = [];\n        e._touchMoveTimeDeltas = [];\n        e._autoScrollAccumulatedTime = 0;\n        e._autoScrollTotalTime = 0;\n        e._autoScrollStartPosition = cc.v2(0, 0);\n        e._autoScrollTargetDelta = cc.Vec2.ZERO;\n        e._isHandleMultiTouch = !1;\n        e._isOnDestScrolling = !1;\n        return e;\n    }\n    __extends(e, t);\n    e.prototype.onLoad = function () {\n        var t = this.content;\n        var e = cc.Node.EventType;\n        t.on(e.TOUCH_START, this.onTouchStart, this);\n        t.on(e.TOUCH_MOVE, this.onTouchMove, this);\n        t.on(e.TOUCH_END, this.onTouchEnd, this);\n        t.on(e.TOUCH_CANCEL, this.onTouchEnd, this);\n    };\n    e.prototype.onDestroy = function () {\n        var t = this.content;\n        var e = cc.Node.EventType;\n        t.off(e.TOUCH_START, this.onTouchStart, this);\n        t.off(e.TOUCH_MOVE, this.onTouchMove, this);\n        t.off(e.TOUCH_END, this.onTouchEnd, this);\n        t.off(e.TOUCH_CANCEL, this.onTouchEnd, this);\n    };\n    e.prototype.onTouchStart = function () {\n        this.resetTouchInfos();\n    };\n    e.prototype.onTouchMove = function (t) {\n        if (!this._isOnDestScrolling) {\n            var e = t.getTouches();\n            if (1 == e.length) {\n                var o = t.getDelta();\n                this.moveContent(o);\n                this.gatherTouchMove(o);\n            } else {\n                this._isHandleMultiTouch = !0;\n                var n = e[0];\n                var i = e[1];\n                if (!this._initLen) {\n                    this._initLen = n.getPreviousLocation().sub(i.getPreviousLocation()).mag();\n                    var r = n.getStartLocation().add(i.getStartLocation()).divide(2);\n                    var a = this.node.convertToNodeSpaceAR(r);\n                    var s = this.node.convertToWorldSpaceAR(a);\n                    this._initPos = this.content.convertToNodeSpaceAR(s);\n                    this._initScale = this.content.scale;\n                }\n                var c = n.getLocation().sub(i.getLocation()).mag();\n                var l = this._initScale * (c / this._initLen);\n                if (l > this.maxScale || l < this.minScale) return;\n                this._tarScale = l;\n                this._scrollZoom = !0;\n            }\n        }\n    };\n    e.prototype.onTouchEnd = function (t) {\n        this._isOnDestScrolling ||\n            (this._isHandleMultiTouch\n                ? (this._scrollZoom = null)\n                : (this.gatherTouchMove(t.getDelta()), this.startInertiaScroll()),\n            (this._isHandleMultiTouch = !1));\n    };\n    e.prototype.update = function (t) {\n        if (this._scrollZoom) {\n            var e = this.content.scale;\n            var o = this._tarScale;\n            var n = e + 0.5 * (o - e);\n            var i = n - e;\n            var r = this._initPos.mul(-i);\n            this.content.scale = n;\n            this.moveContent(r);\n            this._scrollZoom = Math.abs(n - o) > 0.01;\n        } else this._autoScrolling && this.processAutoScrolling(t);\n    };\n    e.prototype.calculateTouchMoveVelocity = function () {\n        var t = 0;\n        if (\n            (t = this._touchMoveTimeDeltas.reduce(function (t, e) {\n                return t + e;\n            }, t)) <= 0 ||\n            t >= 0.5\n        )\n            return cc.v2(0, 0);\n        var e = cc.v2(0, 0);\n        e = this._touchMoveDisplacements.reduce(function (t, e) {\n            return t.add(e);\n        }, e);\n        return cc.v2((e.x * (1 - this.brake)) / t, (e.y * (1 - this.brake)) / t);\n    };\n    e.prototype.processAutoScrolling = function (t) {\n        this._autoScrollAccumulatedTime += t;\n        var e;\n        var o = Math.min(1, this._autoScrollAccumulatedTime / this._autoScrollTotalTime);\n        e = o;\n        o = (e -= 1) * e * e * e * e + 1;\n        var n = this._autoScrollStartPosition.add(this._autoScrollTargetDelta.mul(o));\n        Math.abs(o - 1) <= 1e-4 && (this._autoScrolling = !1);\n        var i = n.sub(this.content.getPosition());\n        this.moveContent(this._clampDelta(i));\n    };\n    e.prototype.startAttenuatingAutoScroll = function (t, e) {\n        var o = Math.sqrt(Math.sqrt(e.mag() / 5));\n        var n = t.normalize();\n        var i = this.content.getContentSize();\n        var r = this.node.getContentSize();\n        var a = i.width - r.width;\n        var s = i.height - r.height;\n        var c = this.calculateAttenuatedFactor(a);\n        var l = this.calculateAttenuatedFactor(s);\n        n = cc.v2(n.x * a * (1 - this.brake) * c, n.y * s * l * (1 - this.brake));\n        var u = t.mag();\n        var p = n.mag() / u;\n        n = n.add(t);\n        this.brake > 0 && p > 7 && ((p = Math.sqrt(p)), (n = t.mul(p).add(t)));\n        this.brake > 0 && p > 3 && (o *= p = 3);\n        0 === this.brake && p > 1 && (o *= p);\n        this.startAutoScroll(n, o);\n    };\n    e.prototype.calculateAttenuatedFactor = function (t) {\n        return this.brake <= 0 ? 1 - this.brake : (1 - this.brake) * (1 / (1 + 14e-6 * t + t * t * 8e-9));\n    };\n    e.prototype.startInertiaScroll = function () {\n        var t = this.calculateTouchMoveVelocity();\n        if (!t.fuzzyEquals(cc.v2(0, 0), 1e-4) && this.brake < 1) {\n            var e = t.mul(0.7);\n            this.startAttenuatingAutoScroll(e, t);\n        }\n    };\n    e.prototype.startAutoScroll = function (t, e) {\n        this._autoScrolling = !0;\n        this._autoScrollTargetDelta = t;\n        this._autoScrollStartPosition = this.content.getPosition();\n        this._autoScrollTotalTime = e;\n        this._autoScrollAccumulatedTime = 0;\n    };\n    e.prototype._clampDelta = function (t) {\n        var e = this.content.getContentSize();\n        var o = this.node.getContentSize();\n        e.width < o.width && (t.x = 0);\n        e.height < o.height && (t.y = 0);\n        return t;\n    };\n    e.prototype.moveContent = function (t, e) {\n        var o = this;\n        void 0 === e && (e = 0);\n        return new Promise(function (n) {\n            var i = t;\n            var r = o.content.getPosition().add(i);\n            r.x > o.boundX\n                ? ((r.x = o.boundX), (o._autoScrolling = !1))\n                : r.x < -o.boundX && ((r.x = -o.boundX), (o._autoScrolling = !1));\n            r.y > o.boundY\n                ? ((r.y = o.boundY), (o._autoScrolling = !1))\n                : r.y < -o.boundY && ((r.y = -o.boundY), (o._autoScrolling = !1));\n            e > 0\n                ? cc\n                      .tween(o.content)\n                      .to(e, {position: cc.v3(r.x, r.y)})\n                      .call(function () {\n                          n();\n                      })\n                      .start()\n                : (o.content.setPosition(r), n());\n        });\n    };\n    e.prototype.getTimeInMilliseconds = function () {\n        return new Date().getMilliseconds();\n    };\n    e.prototype.gatherTouchMove = function (t) {\n        for (t = this._clampDelta(t); this._touchMoveDisplacements.length >= 5; )\n            this._touchMoveDisplacements.shift(), this._touchMoveTimeDeltas.shift();\n        this._touchMoveDisplacements.push(t);\n        var e = this.getTimeInMilliseconds();\n        this._touchMoveTimeDeltas.push((e - this._touchMovePreviousTimestamp) / 1e3);\n        this._touchMovePreviousTimestamp = e;\n    };\n    Object.defineProperty(e.prototype, \"boundY\", {\n        get: function () {\n            return (this.content.height * this.content.scaleY) / 2 - this.node.height / 2;\n        },\n        enumerable: !1,\n        configurable: !0\n    });\n    Object.defineProperty(e.prototype, \"boundX\", {\n        get: function () {\n            return (this.content.width * this.content.scaleX) / 2 - this.node.width / 2;\n        },\n        enumerable: !1,\n        configurable: !0\n    });\n    e.prototype.scrollTo = function (t, e) {\n        var o = this;\n        void 0 === e && (e = 0);\n        this._isOnDestScrolling = !0;\n        this.resetTouchInfos();\n        return new Promise(function (n) {\n            o.moveContent(t.mul(-1), e).then(function () {\n                o._isOnDestScrolling = !1;\n                n();\n            });\n        });\n    };\n    e.prototype.resetTouchInfos = function () {\n        this._autoScrolling = !1;\n        this._touchMovePreviousTimestamp = this.getTimeInMilliseconds();\n        this._touchMoveDisplacements.length = 0;\n        this._touchMoveTimeDeltas.length = 0;\n        this._isHandleMultiTouch = !1;\n        this._initLen = null;\n    };\n    e.prototype.stopAutoScroll = function () {\n        this._autoScrolling = !1;\n        this._autoScrollAccumulatedTime = this._autoScrollTotalTime;\n    };\n    __decorate([c({tooltip: \"最大可放大倍数\", type: cc.Float})], e.prototype, \"maxScale\", void 0);\n    __decorate([c({tooltip: \"最小可缩小倍数\", type: cc.Float})], e.prototype, \"minScale\", void 0);\n    __decorate([c({tooltip: \"滚动之后的减速系数\", type: cc.Float})], e.prototype, \"brake\", void 0);\n    __decorate([c(cc.Node)], e.prototype, \"content\", void 0);\n    return __decorate([s], e);\n})(cc.Component);\nexports.default = l;\n"]}