{"version":3,"sources":["assets\\scripts\\shopItem.js"],"names":["n","Object","defineProperty","exports","value","_idx","require","_res","_bagMgr","_panelMgr","_tipMgr","_pInfo","_item","h","cc","_decorator","f","ccclass","g","property","y","t","e","apply","arguments","buyBtnNode","finNode","btnPrice","doubleNode","itemComp","shopData","aniDatas","isDouble","__extends","prototype","onLoad","start","initItem","o","props","i","r","Number","initByData","a","ins","getBundleByString","then","load","sp","SkeletonData","node","isValid","Node","addComponent","Skeleton","skeletonData","animation","parent","console","error","string","price","active","checkData","key","getShopUnreset","onBtnBuy","JSON","stringify","platform","reportEvent","ERepEvt","susPayment","payment","addItem","itemId","worldPos","convertToWorldSpaceAR","position","push","open","itemDatas","addShopUnreset","paymentResult","success","showTip","__decorate","Label","Component"],"mappings":"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","sourceRoot":"/","sourcesContent":["var n;\nObject.defineProperty(exports, \"__esModule\", {value: !0});\nvar _idx = require(\"idx\");\nvar _res = require(\"res\");\nvar _bagMgr = require(\"bagMgr\");\nvar _panelMgr = require(\"panelMgr\");\nvar _tipMgr = require(\"tipMgr\");\nvar _pInfo = require(\"pInfo\");\nvar _item = require(\"item\");\nvar h = cc._decorator;\nvar f = h.ccclass;\nvar g = h.property;\nvar y = (function (t) {\n    function e() {\n        var e = (null !== t && t.apply(this, arguments)) || this;\n        e.buyBtnNode = null;\n        e.finNode = null;\n        e.btnPrice = null;\n        e.doubleNode = null;\n        e.itemComp = null;\n        e.shopData = null;\n        e.aniDatas = [];\n        e.isDouble = !1;\n        return e;\n    }\n    __extends(e, t);\n    e.prototype.onLoad = function () {};\n    e.prototype.start = function () {};\n    e.prototype.initItem = function (t, e) {\n        var o = this;\n        if (t) {\n            this.shopData = t;\n            var n = t.props;\n            for (var i in n) {\n                var r = Number(n[i]);\n                this.itemComp.initByData(i, r);\n            }\n            var a = e ? \"blueLight\" : \"light\";\n            _res.default.ins\n                .getBundleByString(\"resSps\")\n                .then(function (t) {\n                    t.load(\"spine/\" + a + \"/action\", sp.SkeletonData, function (t, e) {\n                        if (!t && o.node && o.node.isValid) {\n                            var n = new cc.Node();\n                            var i = n.addComponent(sp.Skeleton);\n                            (i.skeletonData = e), (i.animation = \"animation\"), (n.parent = o.itemComp.node);\n                        }\n                    });\n                })\n                .catch(function (t) {\n                    console.error(\"RTool.ins.getBundleByString('resSps')\", t);\n                });\n            this.btnPrice.string = \"Â¥\" + t.price;\n            this.finNode.active = !1;\n            this.doubleNode.active = !1;\n            this.checkData();\n        }\n    };\n    e.prototype.checkData = function () {\n        if (this.shopData) {\n            var t = this.shopData.key;\n            var e = _pInfo.default.ins.getShopUnreset();\n            var o = this.shopData.double || 0;\n            var n = e[t] || 0;\n            this.isDouble = this.doubleNode.active = n < o;\n        }\n    };\n    e.prototype.onBtnBuy = function () {\n        var t = this;\n        if (this.shopData) {\n            var e = this.isDouble ? 1 : 0;\n            var o = this.shopData.props;\n            var n = JSON.stringify(this.shopData.props);\n            _idx.platform.reportEvent(_idx.ERepEvt.susPayment, {key: this.shopData.key});\n            _idx.platform\n                .payment(this.shopData.key, this.shopData.price, e, n)\n                .then(function () {\n                    var e = [];\n                    for (var n in o) {\n                        var i = o[n];\n                        t.isDouble && (i *= 2);\n                        _bagMgr.default.ins.addItem(n, i);\n                        var r = {};\n                        r.itemId = n;\n                        r.worldPos = t.node.parent.convertToWorldSpaceAR(t.node.position);\n                        r.value = i;\n                        e.push(r);\n                    }\n                    _panelMgr.default.ins.open(\"ui/ui_flyAni\", {itemDatas: e});\n                    _pInfo.default.ins.addShopUnreset(t.shopData.key);\n                    t.checkData();\n                    _idx.platform.reportEvent(_idx.ERepEvt.paymentResult, {key: t.shopData.key, success: 1});\n                })\n                .catch(function (e) {\n                    _tipMgr.default.ins.showTip(e, !0);\n                    _idx.platform.reportEvent(_idx.ERepEvt.paymentResult, {key: t.shopData.key, success: 0});\n                });\n        }\n    };\n    __decorate([g(cc.Node)], e.prototype, \"buyBtnNode\", void 0);\n    __decorate([g(cc.Node)], e.prototype, \"finNode\", void 0);\n    __decorate([g(cc.Label)], e.prototype, \"btnPrice\", void 0);\n    __decorate([g(cc.Node)], e.prototype, \"doubleNode\", void 0);\n    __decorate([g(_item.default)], e.prototype, \"itemComp\", void 0);\n    return __decorate([f], e);\n})(cc.Component);\nexports.default = y;\n"]}