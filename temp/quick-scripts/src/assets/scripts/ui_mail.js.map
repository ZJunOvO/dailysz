{"version":3,"sources":["assets\\scripts\\ui_mail.js"],"names":["n","Object","defineProperty","exports","value","_evts","require","_lang","_mailItem","_mailMgr","_panelMgr","_tipMgr","_pInfo","_baseUI","f","cc","_decorator","g","ccclass","y","property","m","t","e","apply","arguments","scrollView","mailPfb","emptyNode","getAllNode","eventFunc","isLoad","lastScrollPosition","__extends","prototype","start","init","o","length","ins","getMail","updMail","bind","node","on","pageScroll","content","children","forEach","push","removeAllChildren","mailInfo","mail","keys","active","i","r","a","s","serverMail","u","p","shift","instantiate","addChild","getComponent","Number","updState","type","scheduleOnce","getScrollOffset","Math","abs","parent","height","convertToWorldSpaceAR","Vec2","ZERO","convertToNodeSpaceAR","showLoadAni","tween","to","x","easing","showChangegAni","opacity","chgAni","showChgAni","winSize","width","mailSort","sort","state","Layout","updateLayout","getItemById","id","item","index","props","mailState","award","updateState","splice","destroy","keyDelete","values","showTip","lang","deleteMail","keyAward","Mail","JSON","parse","hasOwnProperty","getAward","c","h","position","itemId","worldPos","open","itemDatas","onLoad","onOperTap","opE","onDestroy","off","action","UPDMAIL","data","hideThis","hide","__decorate","ScrollView","Prefab","Node"],"mappings":"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","sourceRoot":"/","sourcesContent":["var n;\nObject.defineProperty(exports, \"__esModule\", {value: !0});\nvar _evts = require(\"evts\");\nvar _lang = require(\"lang\");\nvar _mailItem = require(\"mailItem\");\nvar _mailMgr = require(\"mailMgr\");\nvar _panelMgr = require(\"panelMgr\");\nvar _tipMgr = require(\"tipMgr\");\nvar _pInfo = require(\"pInfo\");\nvar _baseUI = require(\"baseUI\");\nvar f = cc._decorator;\nvar g = f.ccclass;\nvar y = f.property;\nvar m = (function (t) {\n    function e() {\n        var e = (null !== t && t.apply(this, arguments)) || this;\n        e.scrollView = null;\n        e.mailPfb = null;\n        e.emptyNode = null;\n        e.getAllNode = null;\n        e.eventFunc = null;\n        e.isLoad = !1;\n        e._mailItem = [];\n        e.lastScrollPosition = 0;\n        return e;\n    }\n    __extends(e, t);\n    e.prototype.start = function () {};\n    e.prototype.init = function () {\n        for (var t = this, e = [], o = 0; o < arguments.length; o++) e[o] = arguments[o];\n        _mailMgr.default.ins.getMail(this.updMail.bind(this));\n        this.scrollView.node.on(\n            \"scrolling\",\n            function () {\n                t.pageScroll();\n            },\n            this\n        );\n    };\n    e.prototype.updMail = function () {\n        var t = this;\n        if (!this.isLoad && this.scrollView) {\n            this.isLoad = !0;\n            var e = this.scrollView.content;\n            e.children.forEach(function (e) {\n                t._mailItem.push(e);\n            });\n            e.removeAllChildren();\n            var o = _mailMgr.default.ins.mailInfo.mail;\n            var n = Object.keys(o);\n            if (((this.emptyNode.active = 0 == n.length), n.length)) {\n                for (var i = this.mailPfb, r = _mailMgr.default.ins, a = 0; a < n.length; a++) {\n                    var s = n[a];\n                    if (r.serverMail[s]) {\n                        var u = r.mailInfo.mail[s];\n                        var p = this._mailItem.shift();\n                        p || (p = cc.instantiate(i));\n                        this.scrollView.content.addChild(p, 0);\n                        p.active = !1;\n                        p.getComponent(_mailItem.default).init(Number(s), u);\n                    }\n                }\n                this.isLoad = !1;\n                this.lastScrollPosition = 0;\n                this.updState({type: \"load\"});\n                this.scheduleOnce(this.pageScroll.bind(this, !1), 0);\n            } else this.isLoad = !1;\n        }\n    };\n    e.prototype.pageScroll = function (t) {\n        void 0 === t && (t = !0);\n        var e = this.scrollView.content.children;\n        var o = this.scrollView.getScrollOffset().y;\n        if (!(t && Math.abs(o - this.lastScrollPosition) < 1)) {\n            for (var n = this.scrollView.content.parent.height / 2, i = 0; i < e.length; i++) {\n                var r = e[i];\n                var a = r.convertToWorldSpaceAR(cc.Vec2.ZERO);\n                (a = this.scrollView.content.parent.convertToNodeSpaceAR(a)).y + r.height / 2 < -n ||\n                a.y - r.height / 2 > n\n                    ? (r.children[0].active = !1)\n                    : (r.children[0].active = !0);\n            }\n            this.lastScrollPosition = o;\n        }\n    };\n    e.prototype.showLoadAni = function (t) {\n        cc.tween(t).to(0.5, {x: 0}, {easing: \"backInOut\"}).start();\n    };\n    e.prototype.showChangegAni = function (t) {\n        cc.tween(t).to(0.2, {opacity: 255}).start();\n    };\n    e.prototype.chgAni = function (t, e) {\n        void 0 === e && (e = 0);\n        t.active = !0;\n        this.showChgAni\n            ? ((t.opacity = 0), this.scheduleOnce(this.showChangegAni.bind(this, t), 0.1 * (e + 1)))\n            : ((t.x = (cc.winSize.width + t.width) / 2), this.scheduleOnce(this.showLoadAni.bind(this, t), 0.05 * e));\n    };\n    e.prototype.mailSort = function () {\n        this.scrollView.content.children.sort(function (t, e) {\n            return t.getComponent(_mailItem.default).state - e.getComponent(_mailItem.default).state;\n        });\n        this.scrollView.content.getComponent(cc.Layout).updateLayout();\n    };\n    e.prototype.getItemById = function (t) {\n        for (var e = this.scrollView.content.children, o = 0; o < e.length; o++) {\n            var n = e[o].getComponent(_mailItem.default);\n            if (t === n.id) return {item: n, index: o};\n        }\n    };\n    e.prototype.updState = function (t) {\n        var e = this;\n        var o = this.scrollView.content;\n        var n = _mailMgr.default.ins.serverMail;\n        if (t)\n            if (\"keyAward\" === t.type)\n                o.children.forEach(function (t, o) {\n                    var i = t.getComponent(_mailItem.default);\n                    n[i.id].props &&\n                        i.state !== _mailMgr.mailState.award &&\n                        (i.updateState(_mailMgr.mailState.award), e.chgAni(t, o));\n                });\n            else if (\"load\" === t.type)\n                this.mailSort(),\n                    o.children.forEach(function (t, o) {\n                        e.chgAni(t, o);\n                    });\n            else if (\"keyDelete\" === t.type) {\n                var i = [];\n                o.children.forEach(function (t, e) {\n                    var o = t.getComponent(_mailItem.default);\n                    o.state === _mailMgr.mailState.award && i.push({node: o.node, index: e});\n                });\n                i.forEach(function (t) {\n                    o.children.splice(t.index, 1);\n                    t.node.destroy();\n                    o.getComponent(cc.Layout).updateLayout();\n                });\n            } else if (\"read\" === t.type) {\n                if (t.id) {\n                    var r = this.getItemById(t.id);\n                    var a = _mailMgr.default.ins.mailInfo.mail[t.id];\n                    r && r.item && (r.item.updateState(a), this.chgAni(r.item.node), this.mailSort());\n                }\n            } else if (\"delete\" === t.type) {\n                var s = this.getItemById(t.id);\n                s && s.item.node.destroy();\n                this.scheduleOnce(function () {\n                    o.children.splice(s.index, 1);\n                    e.mailSort();\n                });\n            }\n        this.scheduleOnce(function () {\n            (e.emptyNode.active = 0 == e.scrollView.content.children.length), e.pageScroll.bind(e, !1);\n        });\n        this.showChgAni || (this.showChgAni = !0);\n    };\n    e.prototype.keyDelete = function () {\n        if (!this.isLoad) {\n            var t = 0;\n            Object.values(_mailMgr.default.ins.mailInfo.mail).forEach(function (e) {\n                e === _mailMgr.mailState.award && t++;\n            });\n            t <= 0 ? _tipMgr.default.ins.showTip(_lang.lang[10005]) : _mailMgr.default.ins.deleteMail();\n        }\n    };\n    e.prototype.keyAward = function () {\n        if (!this.isLoad)\n            if (Object.keys(_mailMgr.default.ins.mailInfo.mail).length <= 0)\n                _tipMgr.default.ins.showTip(_lang.lang[10006]);\n            else {\n                var t = _pInfo.default.ins.Mail;\n                var e = _mailMgr.default.ins;\n                var o = {};\n                for (var n in t.mail)\n                    if (t.mail[n] !== _mailMgr.mailState.award) {\n                        var i = e.serverMail;\n                        if (n && i[n]) {\n                            var r = JSON.parse(i[n].props);\n                            for (var a in r)\n                                r.hasOwnProperty(a) && (o[a] ? (o[a] += Number(r[a])) : (o[a] = Number(r[a])));\n                        }\n                    }\n                if (_mailMgr.default.ins.getAward()) {\n                    var c = [];\n                    var h = this.getAllNode.parent.convertToWorldSpaceAR(this.getAllNode.position);\n                    for (var f in o) {\n                        var g = o[f];\n                        var y = {};\n                        y.itemId = f;\n                        y.worldPos = h;\n                        y.value = g;\n                        c.push(y);\n                    }\n                    c.length &&\n                        (c.length > 10 && (c.length = 10), _panelMgr.default.ins.open(\"ui/ui_flyAni\", {itemDatas: c}));\n                } else _tipMgr.default.ins.showTip(_lang.lang[10006]);\n            }\n    };\n    e.prototype.onLoad = function () {\n        this.eventFunc = this.onOperTap.bind(this);\n        _evts.default.opE.on(this.eventFunc);\n    };\n    e.prototype.onDestroy = function () {\n        _evts.default.opE.off(this.eventFunc);\n        this.eventFunc = null;\n    };\n    e.prototype.onOperTap = function (t) {\n        var e = null == t ? void 0 : t.action;\n        if (e)\n            switch (e) {\n                case _evts.default.UPDMAIL:\n                    this.updState(t.data);\n            }\n    };\n    e.prototype.hideThis = function () {\n        this.hide();\n    };\n    __decorate([y(cc.ScrollView)], e.prototype, \"scrollView\", void 0);\n    __decorate([y(cc.Prefab)], e.prototype, \"mailPfb\", void 0);\n    __decorate([y(cc.Node)], e.prototype, \"emptyNode\", void 0);\n    __decorate([y(cc.Node)], e.prototype, \"getAllNode\", void 0);\n    return __decorate([g], e);\n})(_baseUI.default);\nexports.default = m;\n"]}