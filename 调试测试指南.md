# 🎮 调试测试指南

## 🚀 一键通关测试

### 方法1：找到游戏组件并调用
进入游戏关卡后，在浏览器控制台执行：

```javascript
// 查找游戏场景中的game组件
var gameNode = cc.find("game");
if (gameNode) {
    var gameComp = gameNode.getComponent("game");
    if (gameComp) {
        // 一键通关
        gameComp.oneClickWin();
        
        // 或者直接胜利
        gameComp.directWin();
        
        // 强制现金奖励
        gameComp.forceCashReward();
    }
}
```

### 方法2：通过场景查找
```javascript
// 获取当前场景的所有节点，查找game组件
var scene = cc.director.getScene();
function findGameComponent(node) {
    var gameComp = node.getComponent("game");
    if (gameComp) {
        console.log("找到game组件！");
        return gameComp;
    }
    
    for (var i = 0; i < node.children.length; i++) {
        var result = findGameComponent(node.children[i]);
        if (result) return result;
    }
    return null;
}

var gameComp = findGameComponent(scene);
if (gameComp) {
    gameComp.directWin(); // 直接胜利
}
```

### 方法3：暴力搜索
```javascript
// 遍历所有活跃的游戏组件
var allNodes = cc.director.getScene().children;
function searchGameComp(nodes) {
    for (var i = 0; i < nodes.length; i++) {
        var node = nodes[i];
        if (node.getComponent && node.getComponent("game")) {
            console.log("🎯 找到game组件！", node.name);
            return node.getComponent("game");
        }
        if (node.children && node.children.length > 0) {
            var result = searchGameComp(node.children);
            if (result) return result;
        }
    }
    return null;
}

var gameComp = searchGameComp(allNodes);
if (gameComp) {
    console.log("执行一键通关...");
    gameComp.directWin();
}
```

## 💰 现金奖励测试

### 方法1：通过rewardMgr直接测试
```javascript
// 获取现金余额
var rewardMgr = require("rewardMgr").default;
console.log("当前余额:", rewardMgr.getCashDisplay());

// 强制添加现金（绕过随机概率）
rewardMgr.addCash(520); // 添加5.20元
console.log("新余额:", rewardMgr.getCashDisplay());

// 测试奖励计算
rewardMgr.onPuzzleComplete('expert', true);
```

### 方法2：通过top组件测试
```javascript
// 查找top组件并调用测试方法
function findTopComponent() {
    var canvas = cc.find("Canvas");
    if (canvas) {
        var topNodes = canvas.getComponentsInChildren("top");
        if (topNodes && topNodes.length > 0) {
            return topNodes[0];
        }
    }
    return null;
}

var topComp = findTopComponent();
if (topComp) {
    topComp.testCashRewardSystem();
}
```

## 🔍 调试日志检查

### 游戏完成时应该看到的日志：
```
💝 卷宝专属现金奖励系统初始化完成
🎮 游戏完成检测 - 类型: 0 关卡: 52
🔍 游戏类型检查 - 是否普通游戏: true 游戏类型值: 0 普通类型值: 0
🎯 关卡52完成，难度: expert
🎉 卷宝获得现金奖励！
💰 卷宝获得现金奖励: ¥X.XX
```

### 如果没有看到这些日志，可能的问题：
1. **游戏类型不匹配** - 检查游戏类型值
2. **rewardMgr未正确加载** - 检查模块引用
3. **随机概率未触发** - 连续测试几次

## 🎯 快速测试流程

1. **进入任意关卡**
2. **打开浏览器控制台**
3. **执行一键通关代码**：
   ```javascript
   // 最简单的方法
   cc.director.getScene().getComponentInChildren("game").directWin();
   ```
4. **观察控制台日志输出**
5. **检查topRmb区域数值变化**

## 🛠️ 如果遇到问题

### 问题1：找不到game组件
```javascript
// 列出所有节点和组件
function listAllComponents() {
    var scene = cc.director.getScene();
    function traverse(node, depth) {
        var indent = "  ".repeat(depth);
        console.log(indent + node.name, node._components.map(c => c.constructor.name));
        node.children.forEach(child => traverse(child, depth + 1));
    }
    traverse(scene, 0);
}
listAllComponents();
```

### 问题2：rewardMgr未加载
```javascript
// 检查模块是否可用
try {
    var rewardMgr = require("rewardMgr");
    console.log("✅ rewardMgr可用");
} catch (e) {
    console.log("❌ rewardMgr不可用:", e);
}
```

### 问题3：现金不更新
```javascript
// 手动触发现金更新事件
require("evts").default.opE.emit({ action: 'CASH_CHG' });
```

## 💡 小技巧

- 使用 `cc.director.pause()` 暂停游戏进行调试
- 使用 `cc.director.resume()` 恢复游戏
- 按F12打开开发者工具，在Console标签页执行代码
- 如果代码执行失败，尝试在游戏加载完成后再执行